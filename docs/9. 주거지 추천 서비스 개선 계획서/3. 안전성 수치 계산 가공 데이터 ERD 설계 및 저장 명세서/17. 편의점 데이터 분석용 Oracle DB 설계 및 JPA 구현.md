# í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ì„± ë¬¸ì„œ

**í”„ë¡œì íŠ¸ëª…:** ì•ˆì „ì„± ì ìˆ˜ ê³„ì‚° ì‹œìŠ¤í…œ - í¸ì˜ì  í†µê³„ ë¶„ì„ ë°ì´í„° ì²˜ë¦¬  
**ë²„ì „:** 1.0  
**ì‘ì„±ì¼:** 2025.09.08  
**ëª©ì :** ì „êµ­ í¸ì˜ì  ì •ë³´ë¥¼ í”¼ì–´ìŠ¨ ìƒê´€ë¶„ì„ ê³„ì‚°ì— í™œìš©í•˜ê¸° ìœ„í•œ ë¶„ì„ìš© í…Œì´ë¸” êµ¬ì¶•

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„±](#2-ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì„±)
3. [êµ¬í˜„ íŒŒì¼ ëª©ë¡](#3-êµ¬í˜„-íŒŒì¼-ëª©ë¡)
4. [ìƒì„¸ êµ¬í˜„ ì½”ë“œ](#4-ìƒì„¸-êµ¬í˜„-ì½”ë“œ)
5. [ì„¤ì • íŒŒì¼](#5-ì„¤ì •-íŒŒì¼)
6. [ì‹¤í–‰ ë°©ë²•](#6-ì‹¤í–‰-ë°©ë²•)
7. [ë°ì´í„° ê²€ì¦](#7-ë°ì´í„°-ê²€ì¦)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ì•„í‚¤í…ì²˜ êµ¬ì¡°
```
AnalysisDataProcessor (ë©”ì¸ ì§„ì…ì )
    â†“ í˜¸ì¶œ
ConvenienceStoreCoordinateProcessor (í¸ì˜ì  ì „ìš© ì²˜ë¦¬ê¸°)
    â†“ ì‚¬ìš©
â”œâ”€â”€ ConvenienceStoreDataRepository (ì›ì²œ ë°ì´í„° ì½ê¸°)
â”œâ”€â”€ KakaoConvenienceCoordinateService (ì¢Œí‘œ ê³„ì‚° ì„œë¹„ìŠ¤)
â””â”€â”€ AnalysisConvenienceStoreRepository (ë¶„ì„ìš© ë°ì´í„° ì €ì¥)
```

### 1.2 í•µì‹¬ íŠ¹ì§•
- **ì›ì²œ ë°ì´í„° ë³´í˜¸**: ì½ê¸° ì „ìš©, ì ˆëŒ€ ìˆ˜ì •/ì‚­ì œ ì—†ìŒ
- **ë°°ì¹˜ ì²˜ë¦¬**: 1000ê°œì”© ë‚˜ëˆ„ì–´ ë©”ëª¨ë¦¬ íš¨ìœ¨ì  ì²˜ë¦¬
- **í¸ì˜ì  íŠ¹í™”**: ë¸Œëœë“œëª… ì œê±° ë° ì£¼ì†Œ ì „ì²˜ë¦¬ë¡œ API ì„±ê³µë¥  í–¥ìƒ
- **ë‹¨ê³„ë³„ ì¬ì‹œë„**: 5ë‹¨ê³„ ì£¼ì†Œ ë³€í˜•ìœ¼ë¡œ ì¢Œí‘œ ê³„ì‚° ì„±ê³µë¥  ê·¹ëŒ€í™”
- **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: ì§„í–‰ë¥ , ì„±ê³µ/ì‹¤íŒ¨ í†µê³„ ì‹¤ì‹œê°„ ì¶œë ¥

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„±

### 2.1 í…Œì´ë¸” ìƒì„± DDL

```sql
-- í¸ì˜ì  ë¶„ì„ìš© í…Œì´ë¸” ë° ì‹œí€€ìŠ¤ ìƒì„± DDL

-- ê¸°ì¡´ ê°ì²´ ì‚­ì œ (ìˆëŠ” ê²½ìš°)
DROP SEQUENCE SEQ_ANALYSIS_CONVENIENCE_STORE_DATA;
DROP TABLE ANALYSIS_CONVENIENCE_STORE_DATA;

-- ë¶„ì„ìš© í…Œì´ë¸” ìƒì„±
CREATE TABLE ANALYSIS_CONVENIENCE_STORE_DATA (
    ID NUMBER NOT NULL,
    BUSINESS_NAME VARCHAR2(4000),
    DETAILED_STATUS_NAME VARCHAR2(4000),
    PHONE_NUMBER VARCHAR2(4000),
    LOT_ADDRESS VARCHAR2(4000),
    ROAD_ADDRESS VARCHAR2(4000),
    LATITUDE NUMBER(10,7),
    LONGITUDE NUMBER(10,7),
    CONSTRAINT PK_ANALYSIS_CONVENIENCE_STORE PRIMARY KEY (ID)
);

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE SEQ_ANALYSIS_CONVENIENCE_STORE_DATA
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

-- í…Œì´ë¸” ì½”ë©˜íŠ¸
COMMENT ON TABLE ANALYSIS_CONVENIENCE_STORE_DATA IS 'í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” - í”¼ì–´ìŠ¨ ìƒê´€ë¶„ì„ìš©';
COMMENT ON COLUMN ANALYSIS_CONVENIENCE_STORE_DATA.ID IS 'Primary Key';
COMMENT ON COLUMN ANALYSIS_CONVENIENCE_STORE_DATA.BUSINESS_NAME IS 'ì‚¬ì—…ì¥ëª…';
COMMENT ON COLUMN ANALYSIS_CONVENIENCE_STORE_DATA.DETAILED_STATUS_NAME IS 'ìƒì„¸ì˜ì—…ìƒíƒœëª…';
COMMENT ON COLUMN ANALYSIS_CONVENIENCE_STORE_DATA.PHONE_NUMBER IS 'ì „í™”ë²ˆí˜¸';
COMMENT ON COLUMN ANALYSIS_CONVENIENCE_STORE_DATA.LOT_ADDRESS IS 'ì§€ë²ˆì£¼ì†Œ';
COMMENT ON COLUMN ANALYSIS_CONVENIENCE_STORE_DATA.ROAD_ADDRESS IS 'ë„ë¡œëª…ì£¼ì†Œ';
COMMENT ON COLUMN ANALYSIS_CONVENIENCE_STORE_DATA.LATITUDE IS 'ìœ„ë„ (Kakao API ê³„ì‚°)';
COMMENT ON COLUMN ANALYSIS_CONVENIENCE_STORE_DATA.LONGITUDE IS 'ê²½ë„ (Kakao API ê³„ì‚°)';
```

### 2.2 í…Œì´ë¸” êµ¬ì¡° ì„¤ëª…

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | ì„¤ëª… | NULL í—ˆìš© |
|--------|-------------|------|-----------|
| ID | NUMBER | Primary Key (ìë™ìƒì„±) | NO |
| BUSINESS_NAME | VARCHAR2(4000) | ì‚¬ì—…ì¥ëª… | YES |
| DETAILED_STATUS_NAME | VARCHAR2(4000) | ìƒì„¸ì˜ì—…ìƒíƒœëª… | YES |
| PHONE_NUMBER | VARCHAR2(4000) | ì „í™”ë²ˆí˜¸ | YES |
| LOT_ADDRESS | VARCHAR2(4000) | ì§€ë²ˆì£¼ì†Œ | YES |
| ROAD_ADDRESS | VARCHAR2(4000) | ë„ë¡œëª…ì£¼ì†Œ | YES |
| LATITUDE | NUMBER(10,7) | ìœ„ë„ (Kakao API ê³„ì‚°) | YES |
| LONGITUDE | NUMBER(10,7) | ê²½ë„ (Kakao API ê³„ì‚°) | YES |

---

## 3. êµ¬í˜„ íŒŒì¼ ëª©ë¡

### 3.1 ì¶”ê°€ëœ íŒŒì¼ ëª©ë¡

1. **Entity**: `AnalysisConvenienceStoreData.java` - ë¶„ì„ìš© ë°ì´í„° ì—”í‹°í‹°
2. **Repository**: `AnalysisConvenienceStoreRepository.java` - ë¶„ì„ìš© ë°ì´í„° ì €ì¥ì†Œ
3. **Service**: `KakaoConvenienceCoordinateService.java` - Kakao API ì¢Œí‘œ ê³„ì‚° ì„œë¹„ìŠ¤
4. **Processor**: `ConvenienceStoreCoordinateProcessor.java` - ë©”ì¸ ì²˜ë¦¬ ë¡œì§

### 3.2 ìˆ˜ì •ëœ íŒŒì¼

- **ê¸°ì¡´ AnalysisDataProcessor.java**: í¸ì˜ì  ì²˜ë¦¬ê¸° í˜¸ì¶œ ë¡œì§ ì¶”ê°€
- **ê¸°ì¡´ ConvenienceStoreDataRepository.java**: ë¶„ì„ìš© ì¡°íšŒ ë©”ì„œë“œ ì¶”ê°€

---

## 4. ìƒì„¸ êµ¬í˜„ ì½”ë“œ

### 4.1 AnalysisConvenienceStoreData.java

```java
package com.WhereHouse.AnalysisData.convenience.entity;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.math.BigDecimal;

/**
 * í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© Entity
 * í”¼ì–´ìŠ¨ ìƒê´€ë¶„ì„ì—ì„œ ë…ë¦½ë³€ìˆ˜(ìƒê¶Œ ë°€ë„) ë°ì´í„°ë¡œ í™œìš©
 */
@Entity
@Table(name = "ANALYSIS_CONVENIENCE_STORE_DATA")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class AnalysisConvenienceStoreData {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "analysis_convenience_seq")
    @SequenceGenerator(name = "analysis_convenience_seq", 
                      sequenceName = "SEQ_ANALYSIS_CONVENIENCE_STORE_DATA", 
                      allocationSize = 1)
    @Column(name = "ID")
    private Long id;

    @Column(name = "BUSINESS_NAME", length = 4000)
    private String businessName;                        // ì‚¬ì—…ì¥ëª…

    @Column(name = "DETAILED_STATUS_NAME", length = 4000)
    private String detailedStatusName;                  // ìƒì„¸ì˜ì—…ìƒíƒœëª…

    @Column(name = "PHONE_NUMBER", length = 4000)
    private String phoneNumber;                         // ì „í™”ë²ˆí˜¸

    @Column(name = "LOT_ADDRESS", length = 4000)
    private String lotAddress;                          // ì§€ë²ˆì£¼ì†Œ

    @Column(name = "ROAD_ADDRESS", length = 4000)
    private String roadAddress;                         // ë„ë¡œëª…ì£¼ì†Œ

    @Column(name = "LATITUDE", precision = 10, scale = 7)
    private BigDecimal latitude;                        // ìœ„ë„ (Kakao API ê³„ì‚°)

    @Column(name = "LONGITUDE", precision = 10, scale = 7)
    private BigDecimal longitude;                       // ê²½ë„ (Kakao API ê³„ì‚°)

    /**
     * ì›ì²œ ë°ì´í„°ì—ì„œ ë¶„ì„ìš© ë°ì´í„°ë¡œ ë³€í™˜í•˜ëŠ” ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ
     * NULL ê°’ ì²˜ë¦¬ ê·œì¹™ì„ ì ìš©í•˜ì—¬ ë³€í™˜
     */
    public static AnalysisConvenienceStoreData fromSourceData(
            String businessName,
            String detailedStatusName,
            String phoneNumber,
            String lotAddress,
            String roadAddress) {
        
        return AnalysisConvenienceStoreData.builder()
                .businessName(nullToDefault(businessName, "ë°ì´í„°ì—†ìŒ"))
                .detailedStatusName(nullToDefault(detailedStatusName, "ë°ì´í„°ì—†ìŒ"))
                .phoneNumber(nullToDefault(phoneNumber, "ë°ì´í„°ì—†ìŒ"))
                .lotAddress(nullToDefault(lotAddress, "ë°ì´í„°ì—†ìŒ"))
                .roadAddress(nullToDefault(roadAddress, "ë°ì´í„°ì—†ìŒ"))
                .build();
    }

    /**
     * ì¢Œí‘œ ì •ë³´ ì„¤ì •
     */
    public void setCoordinates(BigDecimal latitude, BigDecimal longitude) {
        this.latitude = latitude;
        this.longitude = longitude;
    }

    /**
     * ì¢Œí‘œ ì •ë³´ ìœ íš¨ì„± ê²€ì¦ (í•œêµ­ ì˜ì—­ ë‚´ ì¢Œí‘œ ì—¬ë¶€)
     */
    public boolean isValidKoreanCoordinates() {
        if (latitude == null || longitude == null) {
            return false;
        }
        
        double lat = latitude.doubleValue();
        double lng = longitude.doubleValue();
        
        // í•œêµ­ ì˜ì—­: ìœ„ë„ 33.0~38.7, ê²½ë„ 124.0~132.0
        return lat >= 33.0 && lat <= 38.7 && lng >= 124.0 && lng <= 132.0;
    }

    /**
     * ì£¼ì†Œ ì •ë³´ ë°˜í™˜ (ë„ë¡œëª…ì£¼ì†Œ ìš°ì„ , ì—†ìœ¼ë©´ ì§€ë²ˆì£¼ì†Œ)
     */
    public String getPrimaryAddress() {
        if (roadAddress != null && !roadAddress.trim().isEmpty() && !"ë°ì´í„°ì—†ìŒ".equals(roadAddress)) {
            return roadAddress;
        }
        if (lotAddress != null && !lotAddress.trim().isEmpty() && !"ë°ì´í„°ì—†ìŒ".equals(lotAddress)) {
            return lotAddress;
        }
        return null;
    }

    /**
     * NULL ê°’ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ìœ í‹¸ë¦¬í‹° ë©”ì„œë“œ
     */
    private static String nullToDefault(String value, String defaultValue) {
        if (value == null || value.trim().isEmpty()) {
            return defaultValue;
        }
        return value.trim();
    }

    /**
     * ì¢Œí‘œ ì •ë³´ ë³´ìœ  ì—¬ë¶€
     */
    public boolean hasCoordinates() {
        return latitude != null && longitude != null;
    }

    /**
     * ìœ íš¨í•œ ì£¼ì†Œ ì •ë³´ ë³´ìœ  ì—¬ë¶€
     */
    public boolean hasValidAddress() {
        return getPrimaryAddress() != null;
    }

    @Override
    public String toString() {
        return String.format("AnalysisConvenienceStoreData{id=%d, businessName='%s', status='%s', hasCoordinates=%s}", 
                           id, businessName, detailedStatusName, hasCoordinates());
    }
}
```

### 4.2 AnalysisConvenienceStoreRepository.java

```java
package com.WhereHouse.AnalysisData.convenience.repository;

import com.WhereHouse.AnalysisData.convenience.entity.AnalysisConvenienceStoreData;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * í¸ì˜ì  ë¶„ì„ìš© ë°ì´í„° Repository
 * í†µê³„ ì¿¼ë¦¬ ë° ë°ì´í„° ê²€ì¦ì„ ìœ„í•œ ë©”ì„œë“œ ì œê³µ
 */
@Repository
public interface AnalysisConvenienceStoreRepository extends JpaRepository<AnalysisConvenienceStoreData, Long> {

    /**
     * ì „ì²´ ë°ì´í„° ê°œìˆ˜ ì¡°íšŒ
     */
    @Query("SELECT COUNT(a) FROM AnalysisConvenienceStoreData a")
    long getTotalCount();

    /**
     * ì¢Œí‘œ ì •ë³´ ë³´ìœ  ë°ì´í„° ê°œìˆ˜ ì¡°íšŒ
     */
    @Query("SELECT COUNT(a) FROM AnalysisConvenienceStoreData a WHERE a.latitude IS NOT NULL AND a.longitude IS NOT NULL")
    long getCoordinateCount();

    /**
     * ì¢Œí‘œ ì™„ì„±ë„ ë¹„ìœ¨ ê³„ì‚°
     */
    @Query("SELECT CAST(COUNT(CASE WHEN a.latitude IS NOT NULL AND a.longitude IS NOT NULL THEN 1 END) AS double) / CAST(COUNT(a) AS double) * 100 " +
           "FROM AnalysisConvenienceStoreData a")
    Double getCoordinateCompletionRate();

    /**
     * ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬ ì¡°íšŒ
     */
    @Query("SELECT a.detailedStatusName, COUNT(a) " +
           "FROM AnalysisConvenienceStoreData a " +
           "GROUP BY a.detailedStatusName " +
           "ORDER BY COUNT(a) DESC")
    List<Object[]> getStatusDistribution();

    /**
     * ì¢Œí‘œ ì •ë³´ê°€ ìˆëŠ” ë°ì´í„°ë§Œ ì¡°íšŒ
     */
    @Query("SELECT a FROM AnalysisConvenienceStoreData a WHERE a.latitude IS NOT NULL AND a.longitude IS NOT NULL")
    List<AnalysisConvenienceStoreData> findAllWithCoordinates();

    /**
     * íŠ¹ì • ìƒì„¸ì˜ì—…ìƒíƒœì˜ ë°ì´í„° ê°œìˆ˜ ì¡°íšŒ
     */
    @Query("SELECT COUNT(a) FROM AnalysisConvenienceStoreData a WHERE a.detailedStatusName = :statusName")
    long countByDetailedStatusName(String statusName);

    /**
     * ì˜ì—…ì¤‘ì¸ í¸ì˜ì ë§Œ ì¡°íšŒ
     */
    @Query("SELECT a FROM AnalysisConvenienceStoreData a WHERE a.detailedStatusName LIKE '%ì˜ì—…%'")
    List<AnalysisConvenienceStoreData> findActiveStores();

    /**
     * íŠ¹ì • ì§€ì—­(ì£¼ì†Œ í¬í•¨) í¸ì˜ì  ì¡°íšŒ
     */
    @Query("SELECT a FROM AnalysisConvenienceStoreData a " +
           "WHERE a.roadAddress LIKE %:region% OR a.lotAddress LIKE %:region%")
    List<AnalysisConvenienceStoreData> findByRegion(String region);

    /**
     * ì¢Œí‘œ ë²”ìœ„ë¡œ í¸ì˜ì  ì¡°íšŒ (íŠ¹ì • ì§€ì—­ ë‚´)
     */
    @Query("SELECT a FROM AnalysisConvenienceStoreData a " +
           "WHERE a.latitude BETWEEN :minLat AND :maxLat " +
           "AND a.longitude BETWEEN :minLng AND :maxLng")
    List<AnalysisConvenienceStoreData> findByCoordinateRange(
            Double minLat, Double maxLat, Double minLng, Double maxLng);

    /**
     * ë°ì´í„° í’ˆì§ˆ ê²€ì¦ì„ ìœ„í•œ í†µê³„ ì •ë³´ ì¡°íšŒ
     */
    @Query("SELECT " +
           "COUNT(a) as totalCount, " +
           "COUNT(CASE WHEN a.latitude IS NOT NULL AND a.longitude IS NOT NULL THEN 1 END) as coordinateCount, " +
           "COUNT(CASE WHEN a.businessName != 'ë°ì´í„°ì—†ìŒ' THEN 1 END) as validBusinessNameCount, " +
           "COUNT(CASE WHEN a.phoneNumber != 'ë°ì´í„°ì—†ìŒ' THEN 1 END) as validPhoneCount " +
           "FROM AnalysisConvenienceStoreData a")
    Object[] getDataQualityStats();

    /**
     * ì£¼ì†Œë³„ í¸ì˜ì  ë°€ë„ ì¡°íšŒ (ì‹œ/êµ¬ ë‹¨ìœ„)
     */
    @Query("SELECT " +
           "CASE " +
           "  WHEN a.roadAddress IS NOT NULL AND a.roadAddress != 'ë°ì´í„°ì—†ìŒ' " +
           "  THEN SUBSTRING(a.roadAddress, 1, LOCATE(' ', a.roadAddress, LOCATE(' ', a.roadAddress) + 1)) " +
           "  ELSE SUBSTRING(a.lotAddress, 1, LOCATE(' ', a.lotAddress, LOCATE(' ', a.lotAddress) + 1)) " +
           "END as region, " +
           "COUNT(a) as storeCount " +
           "FROM AnalysisConvenienceStoreData a " +
           "WHERE (a.roadAddress IS NOT NULL AND a.roadAddress != 'ë°ì´í„°ì—†ìŒ') " +
           "   OR (a.lotAddress IS NOT NULL AND a.lotAddress != 'ë°ì´í„°ì—†ìŒ') " +
           "GROUP BY " +
           "CASE " +
           "  WHEN a.roadAddress IS NOT NULL AND a.roadAddress != 'ë°ì´í„°ì—†ìŒ' " +
           "  THEN SUBSTRING(a.roadAddress, 1, LOCATE(' ', a.roadAddress, LOCATE(' ', a.roadAddress) + 1)) " +
           "  ELSE SUBSTRING(a.lotAddress, 1, LOCATE(' ', a.lotAddress, LOCATE(' ', a.lotAddress) + 1)) " +
           "END " +
           "ORDER BY COUNT(a) DESC")
    List<Object[]> getRegionalDensity();

    /**
     * ìµœê·¼ ì €ì¥ëœ ë°ì´í„° ì¡°íšŒ (ìƒìœ„ Nê°œ)
     */
    @Query("SELECT a FROM AnalysisConvenienceStoreData a ORDER BY a.id DESC")
    List<AnalysisConvenienceStoreData> findRecentData(org.springframework.data.domain.Pageable pageable);

    /**
     * ì¤‘ë³µ ì‚¬ì—…ì¥ëª… ì¡°íšŒ
     */
    @Query("SELECT a.businessName, COUNT(a) " +
           "FROM AnalysisConvenienceStoreData a " +
           "WHERE a.businessName != 'ë°ì´í„°ì—†ìŒ' " +
           "GROUP BY a.businessName " +
           "HAVING COUNT(a) > 1 " +
           "ORDER BY COUNT(a) DESC")
    List<Object[]> findDuplicateBusinessNames();
}
```

### 4.3 KakaoConvenienceCoordinateService.java

```java
package com.WhereHouse.AnalysisData.convenience.service;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.util.UriComponentsBuilder;

import java.math.BigDecimal;
import java.util.*;
import java.util.concurrent.atomic.AtomicLong;

/**
 * Kakao Local APIë¥¼ í™œìš©í•œ í¸ì˜ì  íŠ¹í™” ì¢Œí‘œ ê³„ì‚° ì„œë¹„ìŠ¤
 * í¸ì˜ì  ë¸Œëœë“œëª… ì œê±° ë° ì£¼ì†Œ ì „ì²˜ë¦¬ë¥¼ í†µí•œ API ì¸ì‹ë¥  í–¥ìƒ
 */
@Service
@Slf4j
public class KakaoConvenienceCoordinateService {

    @Value("${kakao.api.key}")
    private String kakaoApiKey;

    private final RestTemplate restTemplate;
    private final ObjectMapper objectMapper;
    
    // API í˜¸ì¶œ í†µê³„
    private final AtomicLong totalApiCalls = new AtomicLong(0);
    private final AtomicLong successfulApiCalls = new AtomicLong(0);
    private final AtomicLong failedApiCalls = new AtomicLong(0);

    // í¸ì˜ì  ë¸Œëœë“œ í‚¤ì›Œë“œ (ì œê±° ëŒ€ìƒ)
    private static final Set<String> CONVENIENCE_STORE_KEYWORDS = Set.of(
            "ì„¸ë¸ì¼ë ˆë¸", "ì„¸ë¸-ì¼ë ˆë¸", "7-ELEVEN", "7ELEVEN",
            "CU", "ì”¨ìœ ",
            "GS25", "ì§€ì—ìŠ¤25",
            "ì´ë§ˆíŠ¸24", "EMART24",
            "ë¯¸ë‹ˆìŠ¤í†±", "MINISTOP",
            "ë°”ì´ë”ì›¨ì´", "BY THE WAY",
            "í¸ì˜ì ", "ì í¬", "ë§¤ì¥", "ìŠ¤í† ì–´", "STORE"
    );

    // ì£¼ì†Œ ì •ì œ ì‹œ ì œê±°í•  íŒ¨í„´
    private static final List<String> BUILDING_PATTERNS = Arrays.asList(
            "\\d+ì¸µ", "\\d+í˜¸", "ì§€í•˜\\d+ì¸µ", "\\d+F", "B\\d+",
            "ë¹Œë”©", "íƒ€ì›Œ", "ìƒê°€", "í”Œë¼ì", "ì„¼í„°", "ëª°"
    );

    public KakaoConvenienceCoordinateService() {
        this.restTemplate = new RestTemplate();
        this.objectMapper = new ObjectMapper();
    }

    /**
     * í¸ì˜ì  ì£¼ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¢Œí‘œ ê³„ì‚°
     * í¸ì˜ì  íŠ¹í™” ì£¼ì†Œ ì „ì²˜ë¦¬ë¥¼ í†µí•´ API ì¸ì‹ë¥  í–¥ìƒ
     */
    public CoordinateResult calculateCoordinates(String roadAddress, String lotAddress, String businessName) {
        log.debug("ì¢Œí‘œ ê³„ì‚° ì‹œì‘ - ì‚¬ì—…ì¥ëª…: {}", businessName);
        
        // ì²˜ë¦¬ ìš°ì„ ìˆœìœ„: roadAddress -> lotAddress
        String primaryAddress = (roadAddress != null && !roadAddress.trim().isEmpty()) ? roadAddress : lotAddress;
        
        if (primaryAddress == null || primaryAddress.trim().isEmpty()) {
            log.debug("ìœ íš¨í•œ ì£¼ì†Œ ì •ë³´ ì—†ìŒ - ì‚¬ì—…ì¥ëª…: {}", businessName);
            return CoordinateResult.failure("ì£¼ì†Œ ì •ë³´ ì—†ìŒ");
        }

        // í¸ì˜ì  íŠ¹í™” ì£¼ì†Œ ì „ì²˜ë¦¬ ë‹¨ê³„ë³„ ì‹œë„
        List<String> addressVariants = generateAddressVariants(primaryAddress.trim(), businessName);
        
        for (int i = 0; i < addressVariants.size(); i++) {
            String processedAddress = addressVariants.get(i);
            log.debug("ì£¼ì†Œ ë³€í˜• {} ì‹œë„: {} -> {}", i + 1, primaryAddress, processedAddress);
            
            CoordinateResult result = callKakaoApi(processedAddress);
            if (result.isSuccess()) {
                log.debug("ì¢Œí‘œ ê³„ì‚° ì„±ê³µ - ì‚¬ì—…ì¥ëª…: {}, ë³€í˜•ë‹¨ê³„: {}, ì¢Œí‘œ: ({}, {})", 
                         businessName, i + 1, result.getLatitude(), result.getLongitude());
                return result;
            }
        }

        log.error("ì¢Œí‘œ ê³„ì‚° ì‹¤íŒ¨ - ì‚¬ì—…ì¥ëª…: {}, ì›ë³¸ì£¼ì†Œ: {}", businessName, primaryAddress);
        return CoordinateResult.failure("ëª¨ë“  ì£¼ì†Œ ë³€í˜• ì‹œë„ ì‹¤íŒ¨");
    }

    /**
     * í¸ì˜ì  íŠ¹í™” ì£¼ì†Œ ë³€í˜• ìƒì„±
     * ë‹¨ê³„ë³„ë¡œ ì£¼ì†Œë¥¼ ì •ì œí•˜ì—¬ API ì¸ì‹ë¥  í–¥ìƒ
     */
    private List<String> generateAddressVariants(String originalAddress, String businessName) {
        List<String> variants = new ArrayList<>();
        
        // 1ë‹¨ê³„: ì›ë³¸ ì£¼ì†Œ ê·¸ëŒ€ë¡œ
        variants.add(originalAddress);
        
        // 2ë‹¨ê³„: í¸ì˜ì  í‚¤ì›Œë“œ ì œê±°
        String withoutStoreKeywords = removeConvenienceStoreKeywords(originalAddress, businessName);
        if (!withoutStoreKeywords.equals(originalAddress)) {
            variants.add(withoutStoreKeywords);
        }
        
        // 3ë‹¨ê³„: ê±´ë¬¼ ì •ë³´ ì œê±°
        String withoutBuilding = removeBuildingInfo(withoutStoreKeywords);
        if (!withoutBuilding.equals(withoutStoreKeywords)) {
            variants.add(withoutBuilding);
        }
        
        // 4ë‹¨ê³„: ê´„í˜¸ ë‚´ìš© ì œê±°
        String withoutParentheses = removeParentheses(withoutBuilding);
        if (!withoutParentheses.equals(withoutBuilding)) {
            variants.add(withoutParentheses);
        }
        
        // 5ë‹¨ê³„: í•µì‹¬ ì£¼ì†Œë§Œ ì¶”ì¶œ (ì‹œ/ë„/êµ¬/ë™/ë²ˆì§€)
        String coreAddress = extractCoreAddress(withoutParentheses);
        if (!coreAddress.equals(withoutParentheses) && coreAddress.length() >= 5) {
            variants.add(coreAddress);
        }
        
        return variants;
    }

    /**
     * í¸ì˜ì  ë¸Œëœë“œ í‚¤ì›Œë“œ ì œê±°
     */
    private String removeConvenienceStoreKeywords(String address, String businessName) {
        String result = address;
        
        // ì‚¬ì—…ì¥ëª…ì—ì„œ ì¶”ì¶œí•œ ë¸Œëœë“œëª…ë„ ì œê±° ëŒ€ìƒì— ì¶”ê°€
        Set<String> keywordsToRemove = new HashSet<>(CONVENIENCE_STORE_KEYWORDS);
        if (businessName != null) {
            for (String keyword : CONVENIENCE_STORE_KEYWORDS) {
                if (businessName.contains(keyword)) {
                    keywordsToRemove.add(keyword);
                }
            }
        }
        
        // í‚¤ì›Œë“œ ì œê±°
        for (String keyword : keywordsToRemove) {
            result = result.replaceAll(keyword, "").trim();
        }
        
        return cleanupSpaces(result);
    }

    /**
     * ê±´ë¬¼ ì •ë³´ ì œê±°
     */
    private String removeBuildingInfo(String address) {
        String result = address;
        
        for (String pattern : BUILDING_PATTERNS) {
            result = result.replaceAll(pattern, "").trim();
        }
        
        return cleanupSpaces(result);
    }

    /**
     * ê´„í˜¸ ë‚´ìš© ì œê±°
     */
    private String removeParentheses(String address) {
        return address.replaceAll("\\([^)]*\\)", "")
                     .replaceAll("\\[[^]]*\\]", "")
                     .replaceAll("\\{[^}]*\\}", "")
                     .trim();
    }

    /**
     * í•µì‹¬ ì£¼ì†Œ ì¶”ì¶œ (ì‹œ/ë„/êµ¬/ë™/ë²ˆì§€ ìˆ˜ì¤€)
     */
    private String extractCoreAddress(String address) {
        String result = address;
        
        // íŠ¹ë³„ì‹œ/ê´‘ì—­ì‹œ í‘œê¸° í†µì¼
        result = result.replace("íŠ¹ë³„ì‹œ", "ì‹œ")
                      .replace("ê´‘ì—­ì‹œ", "ì‹œ");
        
        // ìƒì„¸ ë²ˆì§€ë‚˜ ê±´ë¬¼ëª… ì œê±° (ê¸°ë³¸ ë²ˆì§€ê¹Œì§€ë§Œ ìœ ì§€)
        result = result.replaceAll("\\s+\\d+[-~]\\d+", "")
                      .replaceAll("\\s+[ê°€-í£]+\\d+", "");
        
        return cleanupSpaces(result);
    }

    /**
     * ì—°ì† ê³µë°± ì •ë¦¬ ë° íŠ¹ìˆ˜ë¬¸ì ì œê±°
     */
    private String cleanupSpaces(String text) {
        return text.replaceAll("\\s+", " ")
                  .replaceAll("[,\\-]+$", "")
                  .trim();
    }

    /**
     * Kakao Local API í˜¸ì¶œ
     */
    private CoordinateResult callKakaoApi(String address) {
        totalApiCalls.incrementAndGet();
        
        try {
            String url = UriComponentsBuilder
                    .fromHttpUrl("https://dapi.kakao.com/v2/local/search/address.json")
                    .queryParam("query", address)
                    .build()
                    .toUriString();
            
            org.springframework.http.HttpHeaders headers = new org.springframework.http.HttpHeaders();
            headers.set("Authorization", "KakaoAK " + kakaoApiKey);
            
            org.springframework.http.HttpEntity<String> entity = new org.springframework.http.HttpEntity<>(headers);
            
            org.springframework.http.ResponseEntity<String> response = restTemplate.exchange(
                    url, org.springframework.http.HttpMethod.GET, entity, String.class);
            
            if (response.getStatusCode().is2xxSuccessful()) {
                return parseKakaoResponse(response.getBody());
            } else {
                failedApiCalls.incrementAndGet();
                return CoordinateResult.failure("API í˜¸ì¶œ ì‹¤íŒ¨: " + response.getStatusCode());
            }
            
        } catch (Exception e) {
            failedApiCalls.incrementAndGet();
            log.error("Kakao API í˜¸ì¶œ ì¤‘ ì˜ˆì™¸ ë°œìƒ - ì£¼ì†Œ: {}, ì˜¤ë¥˜: {}", address, e.getMessage());
            return CoordinateResult.failure("API í˜¸ì¶œ ì˜ˆì™¸: " + e.getMessage());
        }
    }

    /**
     * Kakao API ì‘ë‹µ íŒŒì‹±
     */
    private CoordinateResult parseKakaoResponse(String responseBody) {
        try {
            JsonNode root = objectMapper.readTree(responseBody);
            JsonNode documents = root.get("documents");
            
            if (documents == null || documents.isEmpty()) {
                failedApiCalls.incrementAndGet();
                return CoordinateResult.failure("ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ");
            }
            
            JsonNode firstResult = documents.get(0);
            
            // road_address ìš°ì„ , ì—†ìœ¼ë©´ address ì‚¬ìš©
            JsonNode roadAddress = firstResult.get("road_address");
            JsonNode address = firstResult.get("address");
            
            BigDecimal latitude = null;
            BigDecimal longitude = null;
            
            if (roadAddress != null && !roadAddress.isNull()) {
                latitude = new BigDecimal(roadAddress.get("y").asText());
                longitude = new BigDecimal(roadAddress.get("x").asText());
            } else if (address != null && !address.isNull()) {
                latitude = new BigDecimal(address.get("y").asText());
                longitude = new BigDecimal(address.get("x").asText());
            }
            
            if (latitude != null && longitude != null) {
                // í•œêµ­ ì˜ì—­ ë‚´ ì¢Œí‘œ ê²€ì¦
                if (isValidKoreanCoordinates(latitude, longitude)) {
                    successfulApiCalls.incrementAndGet();
                    return CoordinateResult.success(latitude, longitude);
                } else {
                    failedApiCalls.incrementAndGet();
                    return CoordinateResult.failure("ì¢Œí‘œê°€ í•œêµ­ ì˜ì—­ì„ ë²—ì–´ë‚¨");
                }
            } else {
                failedApiCalls.incrementAndGet();
                return CoordinateResult.failure("ì¢Œí‘œ ì •ë³´ íŒŒì‹± ì‹¤íŒ¨");
            }
            
        } catch (Exception e) {
            failedApiCalls.incrementAndGet();
            log.error("Kakao API ì‘ë‹µ íŒŒì‹± ì¤‘ ì˜¤ë¥˜: {}", e.getMessage());
            return CoordinateResult.failure("ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜: " + e.getMessage());
        }
    }

    /**
     * í•œêµ­ ì˜ì—­ ë‚´ ì¢Œí‘œ ê²€ì¦
     */
    private boolean isValidKoreanCoordinates(BigDecimal latitude, BigDecimal longitude) {
        double lat = latitude.doubleValue();
        double lng = longitude.doubleValue();
        
        // í•œêµ­ ì˜ì—­: ìœ„ë„ 33.0~38.7, ê²½ë„ 124.0~132.0
        return lat >= 33.0 && lat <= 38.7 && lng >= 124.0 && lng <= 132.0;
    }

    /**
     * API í˜¸ì¶œ í†µê³„ ë°˜í™˜
     */
    public ApiStatistics getApiStatistics() {
        return new ApiStatistics(
                totalApiCalls.get(),
                successfulApiCalls.get(),
                failedApiCalls.get()
        );
    }

    /**
     * í†µê³„ ì´ˆê¸°í™”
     */
    public void resetStatistics() {
        totalApiCalls.set(0);
        successfulApiCalls.set(0);
        failedApiCalls.set(0);
    }

    /**
     * ì¢Œí‘œ ê³„ì‚° ê²°ê³¼ í´ë˜ìŠ¤
     */
    public static class CoordinateResult {
        private final boolean success;
        private final BigDecimal latitude;
        private final BigDecimal longitude;
        private final String errorMessage;

        private CoordinateResult(boolean success, BigDecimal latitude, BigDecimal longitude, String errorMessage) {
            this.success = success;
            this.latitude = latitude;
            this.longitude = longitude;
            this.errorMessage = errorMessage;
        }

        public static CoordinateResult success(BigDecimal latitude, BigDecimal longitude) {
            return new CoordinateResult(true, latitude, longitude, null);
        }

        public static CoordinateResult failure(String errorMessage) {
            return new CoordinateResult(false, null, null, errorMessage);
        }

        public boolean isSuccess() { return success; }
        public BigDecimal getLatitude() { return latitude; }
        public BigDecimal getLongitude() { return longitude; }
        public String getErrorMessage() { return errorMessage; }
    }

    /**
     * API í˜¸ì¶œ í†µê³„ í´ë˜ìŠ¤
     */
    public static class ApiStatistics {
        private final long totalCalls;
        private final long successfulCalls;
        private final long failedCalls;

        public ApiStatistics(long totalCalls, long successfulCalls, long failedCalls) {
            this.totalCalls = totalCalls;
            this.successfulCalls = successfulCalls;
            this.failedCalls = failedCalls;
        }

        public long getTotalCalls() { return totalCalls; }
        public long getSuccessfulCalls() { return successfulCalls; }
        public long getFailedCalls() { return failedCalls; }
        public double getSuccessRate() { 
            return totalCalls > 0 ? (double) successfulCalls / totalCalls * 100 : 0.0; 
        }
    }
}
```

### 4.4 ConvenienceStoreCoordinateProcessor.java

```java
package com.WhereHouse.AnalysisData.convenience.processor;

import com.WhereHouse.AnalysisData.convenience.entity.AnalysisConvenienceStoreData;
import com.WhereHouse.AnalysisData.convenience.repository.AnalysisConvenienceStoreRepository;
import com.WhereHouse.AnalysisData.convenience.service.KakaoConvenienceCoordinateService;
import com.WhereHouse.AnalysisStaticData.ConvenienceStore.repository.ConvenienceStoreDataRepository;
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.concurrent.atomic.AtomicLong;

/**
 * í¸ì˜ì  ë°ì´í„° ë³€í™˜ ë° ì²˜ë¦¬ë¥¼ ìœ„í•œ ë©”ì¸ Processor
 * AnalysisDataProcessorì—ì„œ í˜¸ì¶œë˜ì–´ í¸ì˜ì  ë°ì´í„°ë¥¼ ë¶„ì„ìš© í…Œì´ë¸”ë¡œ ë³€í™˜
 */
@Component
@RequiredArgsConstructor
@Slf4j
public class ConvenienceStoreCoordinateProcessor {

    private final ConvenienceStoreDataRepository sourceRepository;
    private final AnalysisConvenienceStoreRepository analysisRepository;
    private final KakaoConvenienceCoordinateService coordinateService;

    @PersistenceContext
    private EntityManager entityManager;

    // ë°°ì¹˜ ì²˜ë¦¬ ì„¤ì •
    private static final int BATCH_SIZE = 1000;
    
    // ì²˜ë¦¬ í†µê³„
    private final AtomicLong totalProcessed = new AtomicLong(0);
    private final AtomicLong successfulProcessed = new AtomicLong(0);
    private final AtomicLong failedProcessed = new AtomicLong(0);
    private final AtomicLong coordinateSuccess = new AtomicLong(0);
    private final AtomicLong coordinateFailed = new AtomicLong(0);

    /**
     * í¸ì˜ì  ë°ì´í„° ì „ì²´ ì²˜ë¦¬ ì‹¤í–‰ - ë©”ì¸ ì§„ì…ì 
     * AnalysisDataProcessorì—ì„œ í˜¸ì¶œë˜ëŠ” ë©”ì¸ ë©”ì„œë“œ
     */
    @Transactional
    public void processConvenienceStoreData() {
        log.info("í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± ì‘ì—… ì‹œì‘");
        
        long startTime = System.currentTimeMillis();
        resetStatistics();
        
        try {
            // ì›ì²œ ë°ì´í„° ì´ ê°œìˆ˜ í™•ì¸
            long totalSourceCount = sourceRepository.getTotalSourceCount();
            log.info("ì›ì²œ ë°ì´í„° ì´ ê°œìˆ˜: {} ê±´", totalSourceCount);
            
            if (totalSourceCount == 0) {
                log.warn("ì²˜ë¦¬í•  ì›ì²œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            
            // ê¸°ì¡´ ë¶„ì„ìš© ë°ì´í„° ì‚­ì œ
            clearExistingAnalysisData();
            
            // ë°°ì¹˜ ì²˜ë¦¬ ì‹¤í–‰
            processBatchData(totalSourceCount);
            
            // ì²˜ë¦¬ ê²°ê³¼ ì¶œë ¥
            printFinalResults(totalSourceCount, startTime);
            
        } catch (Exception e) {
            log.error("í¸ì˜ì  ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {}", e.getMessage(), e);
            throw e;
        }
        
        log.info("í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± ì‘ì—… ì™„ë£Œ");
    }

    /**
     * ê¸°ì¡´ ë¶„ì„ìš© ë°ì´í„° ì‚­ì œ
     */
    private void clearExistingAnalysisData() {
        long existingCount = analysisRepository.count();
        if (existingCount > 0) {
            log.info("ê¸°ì¡´ ë¶„ì„ìš© ë°ì´í„° {} ê±´ ì‚­ì œ ì¤‘...", existingCount);
            analysisRepository.deleteAll();
            entityManager.flush();
            entityManager.clear();
            log.info("ê¸°ì¡´ ë¶„ì„ìš© ë°ì´í„° ì‚­ì œ ì™„ë£Œ");
        }
    }

    /**
     * ë°°ì¹˜ ë°ì´í„° ì²˜ë¦¬ ì‹¤í–‰
     */
    private void processBatchData(long totalSourceCount) {
        int totalPages = (int) Math.ceil((double) totalSourceCount / BATCH_SIZE);
        log.info("ë°°ì¹˜ ì²˜ë¦¬ ì‹œì‘ - ì´ {} í˜ì´ì§€, ë°°ì¹˜ í¬ê¸°: {}", totalPages, BATCH_SIZE);
        
        for (int page = 0; page < totalPages; page++) {
            try {
                processBatch(page, totalSourceCount);
                
                // ë©”ëª¨ë¦¬ ê´€ë¦¬
                if (page % 10 == 0) {
                    entityManager.flush();
                    entityManager.clear();
                }
                
            } catch (Exception e) {
                log.error("ë°°ì¹˜ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ - í˜ì´ì§€: {}, ì˜¤ë¥˜: {}", page, e.getMessage(), e);
                failedProcessed.addAndGet(BATCH_SIZE);
            }
        }
    }

    /**
     * ë°°ì¹˜ ë‹¨ìœ„ ì²˜ë¦¬
     */
    @Transactional
    public void processBatch(int pageNumber, long totalCount) {
        Pageable pageable = PageRequest.of(pageNumber, BATCH_SIZE);
        Page<Map<String, Object>> sourcePage = sourceRepository.findAnalysisFieldsOnly(pageable);
        
        if (sourcePage.isEmpty()) {
            log.debug("í˜ì´ì§€ {} - ì²˜ë¦¬í•  ë°ì´í„° ì—†ìŒ", pageNumber);
            return;
        }
        
        List<AnalysisConvenienceStoreData> analysisDataList = new ArrayList<>();
        
        for (Map<String, Object> sourceData : sourcePage.getContent()) {
            try {
                AnalysisConvenienceStoreData analysisData = processIndividualData(sourceData);
                if (analysisData != null) {
                    analysisDataList.add(analysisData);
                    successfulProcessed.incrementAndGet();
                } else {
                    failedProcessed.incrementAndGet();
                }
                totalProcessed.incrementAndGet();
                
            } catch (Exception e) {
                log.error("ê°œë³„ ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ - ì‚¬ì—…ì¥ëª…: {}, ì˜¤ë¥˜: {}", 
                         sourceData.get("businessName"), e.getMessage());
                failedProcessed.incrementAndGet();
                totalProcessed.incrementAndGet();
            }
        }
        
        // ë°°ì¹˜ ì €ì¥
        if (!analysisDataList.isEmpty()) {
            analysisRepository.saveAll(analysisDataList);
            entityManager.flush();
            entityManager.clear();
        }
        
        // ì§„í–‰ë¥  ë¡œê¹…
        long processed = totalProcessed.get();
        double progressRate = ((double) processed / totalCount) * 100;
        log.info("ì§„í–‰ë¥ : {}/{} ({:.1f}%) - ì„±ê³µ: {}, ì‹¤íŒ¨: {}, ì¢Œí‘œì„±ê³µ: {}", 
                processed, totalCount, progressRate, 
                successfulProcessed.get(), failedProcessed.get(), coordinateSuccess.get());
    }

    /**
     * ê°œë³„ ë°ì´í„° ì²˜ë¦¬
     */
    private AnalysisConvenienceStoreData processIndividualData(Map<String, Object> sourceData) {
        String businessName = (String) sourceData.get("businessName");
        String detailedStatusName = (String) sourceData.get("detailedStatusName");
        String phoneNumber = (String) sourceData.get("phoneNumber");
        String lotAddress = (String) sourceData.get("lotAddress");
        String roadAddress = (String) sourceData.get("roadAddress");
        
        // ë¶„ì„ìš© ë°ì´í„° ìƒì„± (NULL ê°’ ì²˜ë¦¬ í¬í•¨)
        AnalysisConvenienceStoreData analysisData = AnalysisConvenienceStoreData.fromSourceData(
                businessName, detailedStatusName, phoneNumber, lotAddress, roadAddress);
        
        // ì¢Œí‘œ ê³„ì‚° ì‹œë„
        if (analysisData.hasValidAddress()) {
            try {
                KakaoConvenienceCoordinateService.CoordinateResult coordinateResult = 
                        coordinateService.calculateCoordinates(roadAddress, lotAddress, businessName);
                
                if (coordinateResult.isSuccess()) {
                    analysisData.setCoordinates(coordinateResult.getLatitude(), coordinateResult.getLongitude());
                    coordinateSuccess.incrementAndGet();
                    
                    log.debug("ì¢Œí‘œ ê³„ì‚° ì„±ê³µ - ì‚¬ì—…ì¥ëª…: {}, ì¢Œí‘œ: ({}, {})", 
                             businessName, coordinateResult.getLatitude(), coordinateResult.getLongitude());
                } else {
                    coordinateFailed.incrementAndGet();
                    log.debug("ì¢Œí‘œ ê³„ì‚° ì‹¤íŒ¨ - ì‚¬ì—…ì¥ëª…: {}, ì˜¤ë¥˜: {}", 
                             businessName, coordinateResult.getErrorMessage());
                }
                
            } catch (Exception e) {
                coordinateFailed.incrementAndGet();
                log.error("ì¢Œí‘œ ê³„ì‚° ì¤‘ ì˜ˆì™¸ ë°œìƒ - ì‚¬ì—…ì¥ëª…: {}, ì˜¤ë¥˜: {}", businessName, e.getMessage());
            }
        } else {
            coordinateFailed.incrementAndGet();
            log.debug("ìœ íš¨í•œ ì£¼ì†Œ ì •ë³´ ì—†ìŒ - ì‚¬ì—…ì¥ëª…: {}", businessName);
        }
        
        return analysisData;
    }

    /**
     * ìµœì¢… ì²˜ë¦¬ ê²°ê³¼ ì¶œë ¥
     */
    private void printFinalResults(long totalSourceCount, long startTime) {
        long endTime = System.currentTimeMillis();
        long processingTimeMs = endTime - startTime;
        
        // ìµœì¢… ì €ì¥ëœ ë°ì´í„° í†µê³„
        long finalCount = analysisRepository.getTotalCount();
        long coordinateCount = analysisRepository.getCoordinateCount();
        Double coordinateRate = analysisRepository.getCoordinateCompletionRate();
        
        // API í†µê³„
        KakaoConvenienceCoordinateService.ApiStatistics apiStats = coordinateService.getApiStatistics();
        
        log.info("=== í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± ì‘ì—… ì™„ë£Œ ===");
        log.info("ì›ì²œ ë°ì´í„°: {} ê°œ", totalSourceCount);
        log.info("ë°ì´í„° ë³€í™˜: ì„±ê³µ {} ê°œ, ì‹¤íŒ¨ {} ê°œ", 
                successfulProcessed.get(), failedProcessed.get());
        log.info("ìµœì¢… ì €ì¥: {} ê°œ", finalCount);
        log.info("ì¢Œí‘œ ê³„ì‚°: ì„±ê³µ {} ê°œ ({:.1f}%), ì‹¤íŒ¨ {} ê°œ", 
                coordinateCount, coordinateRate != null ? coordinateRate : 0.0, coordinateFailed.get());
        
        // ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬
        List<Object[]> statusDistribution = analysisRepository.getStatusDistribution();
        log.info("ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬:");
        statusDistribution.stream()
                .limit(10) // ìƒìœ„ 10ê°œë§Œ ì¶œë ¥
                .forEach(row -> log.info("  {} : {} ê°œ", row[0], row[1]));
        
        log.info("API í˜¸ì¶œ í†µê³„: ì´ {}íšŒ, ì„±ê³µ {}íšŒ ({:.1f}%), ì‹¤íŒ¨ {}íšŒ", 
                apiStats.getTotalCalls(), apiStats.getSuccessfulCalls(), 
                apiStats.getSuccessRate(), apiStats.getFailedCalls());
        
        long seconds = processingTimeMs / 1000;
        long minutes = seconds / 60;
        log.info("ì²˜ë¦¬ ì‹œê°„: {}ë¶„ {}ì´ˆ", minutes, seconds % 60);
    }

    /**
     * í†µê³„ ì´ˆê¸°í™”
     */
    private void resetStatistics() {
        totalProcessed.set(0);
        successfulProcessed.set(0);
        failedProcessed.set(0);
        coordinateSuccess.set(0);
        coordinateFailed.set(0);
        coordinateService.resetStatistics();
    }

    /**
     * ì²˜ë¦¬ í†µê³„ ë°˜í™˜ (í…ŒìŠ¤íŠ¸ ë˜ëŠ” ëª¨ë‹ˆí„°ë§ìš©)
     */
    public ProcessingStatistics getProcessingStatistics() {
        long finalCount = analysisRepository.getTotalCount();
        long coordinateCount = analysisRepository.getCoordinateCount();
        
        return ProcessingStatistics.builder()
                .totalProcessed(totalProcessed.get())
                .successfulProcessed(successfulProcessed.get())
                .failedProcessed(failedProcessed.get())
                .coordinateSuccess(coordinateSuccess.get())
                .coordinateFailed(coordinateFailed.get())
                .finalDataCount(finalCount)
                .coordinateCount(coordinateCount)
                .build();
    }

    /**
     * ì²˜ë¦¬ í†µê³„ ë°ì´í„° í´ë˜ìŠ¤
     */
    @lombok.Builder
    @lombok.Data
    public static class ProcessingStatistics {
        private long totalProcessed;
        private long successfulProcessed;
        private long failedProcessed;
        private long coordinateSuccess;
        private long coordinateFailed;
        private long finalDataCount;
        private long coordinateCount;
    }
}
```

### 4.5 ê¸°ì¡´ AnalysisDataProcessor.java ìˆ˜ì •

```java
package com.WhereHouse.AnalysisData.main;

import com.WhereHouse.AnalysisData.banklocation.processor.BankLocationDataProcessor;
import com.WhereHouse.AnalysisData.convenience.processor.ConvenienceStoreCoordinateProcessor;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
@RequiredArgsConstructor
@Slf4j
public class AnalysisDataProcessor implements CommandLineRunner {

    private final ConvenienceStoreCoordinateProcessor convenienceStoreCoordinateProcessor;
    // í–¥í›„ 18ê°œ ERDë³„ í”„ë¡œì„¸ì„œ ì¶”ê°€ ì˜ˆì •

    @Override
    public void run(String... args) throws Exception {
        log.info("=== ì•ˆì „ì„± ë¶„ì„ìš© ë°ì´í„° ì²˜ë¦¬ ì‹œì‘ ===");

        try {
            // í¸ì˜ì  ë°ì´í„° ì²˜ë¦¬ ì‹¤í–‰
            log.info("í¸ì˜ì  ë°ì´í„° ì²˜ë¦¬ ì‹œì‘");
            convenienceStoreCoordinateProcessor.processConvenienceStoreData();
            log.info("í¸ì˜ì  ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ");
            
            // í–¥í›„ ë‹¤ë¥¸ ë°ì´í„° ì²˜ë¦¬ ì¶”ê°€
            // bankLocationDataProcessor.processBankLocationData();
            // ê¸°íƒ€ 18ê°œ ERDë³„ í”„ë¡œì„¸ì„œ í˜¸ì¶œ...
            
        } catch (Exception e) {
            log.error("ì•ˆì „ì„± ë¶„ì„ìš© ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            throw e;
        }

        log.info("=== ì•ˆì „ì„± ë¶„ì„ìš© ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ ===");
    }
}
```

---

## 5. ì„¤ì • íŒŒì¼

### 5.1 application.yml

```yaml
# í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© ì‹œìŠ¤í…œ ì„¤ì •

spring:
  # ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
  datasource:
    url: jdbc:oracle:thin:@localhost:1521:XE
    username: your_username
    password: your_password
    driver-class-name: oracle.jdbc.OracleDriver
    
    # ì»¤ë„¥ì…˜ í’€ ì„¤ì • (HikariCP)
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 20000
      idle-timeout: 300000
      max-lifetime: 1200000
      leak-detection-threshold: 60000

  # JPA ì„¤ì •
  jpa:
    hibernate:
      ddl-auto: none  # ìš´ì˜í™˜ê²½ì—ì„œëŠ” none ì‚¬ìš©
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
    show-sql: false  # ìš´ì˜í™˜ê²½ì—ì„œëŠ” false ê¶Œì¥
    properties:
      hibernate:
        dialect: org.hibernate.dialect.Oracle12cDialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          batch_size: 1000  # ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”
          batch_versioned_data: true
        order_inserts: true
        order_updates: true
        
  # ë¡œê¹… ì„¤ì •
  output:
    ansi:
      enabled: always

# Kakao API ì„¤ì •
kakao:
  api:
    key: YOUR_KAKAO_API_KEY_HERE  # ì‹¤ì œ Kakao API í‚¤ë¡œ ë³€ê²½ í•„ìš”
    
# ë¡œê¹… ì„¤ì •
logging:
  level:
    com.WhereHouse.AnalysisData.convenience: INFO
    com.WhereHouse.AnalysisStaticData.ConvenienceStore: INFO
    org.springframework.web.client.RestTemplate: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    
  file:
    name: logs/convenience-analysis.log
    max-size: 100MB
    max-history: 7

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
app:
  convenience:
    batch:
      size: 1000  # ë°°ì¹˜ ì²˜ë¦¬ í¬ê¸°
    processing:
      timeout-seconds: 300  # ê°œë³„ ì²˜ë¦¬ íƒ€ì„ì•„ì›ƒ (5ë¶„)
    coordinate:
      validation:
        enabled: true  # ì¢Œí‘œ ìœ íš¨ì„± ê²€ì¦ í™œì„±í™”
        korea-bounds:
          min-latitude: 33.0
          max-latitude: 38.7
          min-longitude: 124.0
          max-longitude: 132.0
```

---

## 6. ì‹¤í–‰ ë°©ë²•

### 6.1 ì‚¬ì „ ì¤€ë¹„

1. **ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •**
   ```sql
   -- DDL ì‹¤í–‰ (ìœ„ì˜ 2.1 í…Œì´ë¸” ìƒì„± DDL)
   ```

2. **Kakao API í‚¤ ì„¤ì •**
   ```yaml
   # application.ymlì—ì„œ ì„¤ì •
   kakao:
     api:
       key: YOUR_ACTUAL_KAKAO_API_KEY
   ```

3. **ì˜ì¡´ì„± í™•ì¸**
   - Spring Boot, JPA, Oracle Driver
   - Jackson (JSON íŒŒì‹±)
   - Lombok

### 6.2 ì‹¤í–‰ ê³¼ì •

1. **ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘**
   ```bash
   java -jar your-application.jar
   ```

2. **ìë™ ì‹¤í–‰ íë¦„**
   ```
   AnalysisDataProcessor.run() 
   â†’ ConvenienceStoreCoordinateProcessor.processConvenienceStoreData()
   â†’ ë°°ì¹˜ ì²˜ë¦¬ ì‹œì‘
   â†’ ì™„ë£Œ í›„ í†µê³„ ì¶œë ¥
   ```

3. **ì‹¤í–‰ ë¡œê·¸ ì˜ˆì‹œ**
   ```
   2025-09-08 10:00:00 [main] INFO  - === ì•ˆì „ì„± ë¶„ì„ìš© ë°ì´í„° ì²˜ë¦¬ ì‹œì‘ ===
   2025-09-08 10:00:00 [main] INFO  - í¸ì˜ì  ë°ì´í„° ì²˜ë¦¬ ì‹œì‘
   2025-09-08 10:00:01 [main] INFO  - í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± ì‘ì—… ì‹œì‘
   2025-09-08 10:00:01 [main] INFO  - ì›ì²œ ë°ì´í„° ì´ ê°œìˆ˜: 45123 ê±´
   2025-09-08 10:00:02 [main] INFO  - ê¸°ì¡´ ë¶„ì„ìš© ë°ì´í„° 0 ê±´ ì‚­ì œ ì¤‘...
   2025-09-08 10:00:02 [main] INFO  - ë°°ì¹˜ ì²˜ë¦¬ ì‹œì‘ - ì´ 46 í˜ì´ì§€, ë°°ì¹˜ í¬ê¸°: 1000
   2025-09-08 10:01:00 [main] INFO  - ì§„í–‰ë¥ : 1000/45123 (2.2%) - ì„±ê³µ: 998, ì‹¤íŒ¨: 2, ì¢Œí‘œì„±ê³µ: 856
   ```

---

## 7. ë°ì´í„° ê²€ì¦

### 7.1 ê¸°ë³¸ ê²€ì¦ ì¿¼ë¦¬

```sql
-- ì „ì²´ ë°ì´í„° ê°œìˆ˜ í™•ì¸
SELECT COUNT(*) FROM ANALYSIS_CONVENIENCE_STORE_DATA;

-- ì¢Œí‘œ ì™„ì„±ë„ í™•ì¸
SELECT 
    COUNT(*) AS TOTAL_COUNT,
    COUNT(LATITUDE) AS COORDINATE_COUNT,
    ROUND(COUNT(LATITUDE) * 100.0 / COUNT(*), 2) AS COMPLETION_RATE
FROM ANALYSIS_CONVENIENCE_STORE_DATA;

-- ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬
SELECT DETAILED_STATUS_NAME, COUNT(*) 
FROM ANALYSIS_CONVENIENCE_STORE_DATA 
GROUP BY DETAILED_STATUS_NAME 
ORDER BY COUNT(*) DESC;
```

### 7.2 í’ˆì§ˆ ê²€ì¦ ê¸°ì¤€

| ê²€ì¦ í•­ëª© | ê¸°ì¤€ | ë¹„ê³  |
|----------|-----|------|
| ë°ì´í„° ì²˜ë¦¬ìœ¨ | 95% ì´ìƒ | ì›ì²œ ë°ì´í„° ëŒ€ë¹„ |
| ì¢Œí‘œ ì™„ì„±ë„ | 85% ì´ìƒ | ì „ì²´ ë°ì´í„° ëŒ€ë¹„ |
| ì²˜ë¦¬ ì„±ëŠ¥ | 1ë§Œ ê±´ë‹¹ 30ë¶„ ì´ë‚´ | ì„±ëŠ¥ ê¸°ì¤€ |
| ì—ëŸ¬ìœ¨ | 5% ë¯¸ë§Œ | ì „ì²´ ì²˜ë¦¬ ì¤‘ |

### 7.3 ì˜ˆìƒ ì²˜ë¦¬ ê²°ê³¼

```
=== í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± ì‘ì—… ì™„ë£Œ ===
- ì›ì²œ ë°ì´í„°: 45,123 ê°œ
- ë°ì´í„° ë³€í™˜: ì„±ê³µ 44,856 ê°œ, ì‹¤íŒ¨ 267 ê°œ
- ì¢Œí‘œ ê³„ì‚°: ì„±ê³µ 38,924 ê°œ (86.8%), ì‹¤íŒ¨ 5,932 ê°œ (13.2%)
- ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬:
  ì˜ì—… : 38,245 ê°œ
  íì—… : 4,567 ê°œ
  íœ´ì—… : 1,892 ê°œ
  ê¸°íƒ€ : 152 ê°œ
- API í˜¸ì¶œ í†µê³„: ì´ 89,512íšŒ, ì„±ê³µ 38,924íšŒ (43.5%)
- ì²˜ë¦¬ ì‹œê°„: 23ë¶„ 14ì´ˆ
```

---

## 8. ì£¼ìš” ì²˜ë¦¬ ë¡œì§ íë¦„

### 8.1 ë°ì´í„° ë³€í™˜ ê³¼ì •

```
ì›ì²œ ë°ì´í„° (CONVENIENCE_STORE_DATA)
    â†“ [1000ê°œì”© ë°°ì¹˜ ì¡°íšŒ]
NULL ê°’ ì²˜ë¦¬ ("ë°ì´í„°ì—†ìŒ"ìœ¼ë¡œ ë³€í™˜)
    â†“ [ì£¼ì†Œ ì •ë³´ ì¶”ì¶œ]
í¸ì˜ì  íŠ¹í™” ì£¼ì†Œ ì „ì²˜ë¦¬ (5ë‹¨ê³„)
    â†“ [Kakao API í˜¸ì¶œ]
ì¢Œí‘œ ê³„ì‚° ë° í•œêµ­ ì˜ì—­ ê²€ì¦
    â†“ [ë¶„ì„ìš© ë°ì´í„° ìƒì„±]
ë¶„ì„ìš© í…Œì´ë¸” ì €ì¥ (ANALYSIS_CONVENIENCE_STORE_DATA)
```

### 8.2 í¸ì˜ì  íŠ¹í™” ì£¼ì†Œ ì „ì²˜ë¦¬

```
1ë‹¨ê³„: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123 ì„¸ë¸ì¼ë ˆë¸ ê°•ë‚¨ì "
2ë‹¨ê³„: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123 ê°•ë‚¨ì " (ë¸Œëœë“œëª… ì œê±°)
3ë‹¨ê³„: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123" (ê±´ë¬¼ì •ë³´ ì œê±°)
4ë‹¨ê³„: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123" (ê´„í˜¸ë‚´ìš© ì œê±°)
5ë‹¨ê³„: "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ" (í•µì‹¬ì£¼ì†Œ ì¶”ì¶œ)
```

---

## 9. í™•ì¥ ë° ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ

### 9.1 í–¥í›„ í™•ì¥ ê³„íš

- ë‹¤ë¥¸ ì—…ì¢…ë³„ í”„ë¡œì„¸ì„œ ì¶”ê°€ (ì€í–‰, ë³‘ì›, í•™êµ ë“±)
- ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ 18ê°œ ERDë³„ ì²˜ë¦¬ê¸° êµ¬í˜„
- API í˜¸ì¶œ ìµœì í™” ë° ìºì‹± ë©”ì»¤ë‹ˆì¦˜ ë„ì…

### 9.2 ì„±ëŠ¥ ìµœì í™” í¬ì¸íŠ¸

- ë°°ì¹˜ í¬ê¸° ì¡°ì • (í˜„ì¬ 1000ê°œ)
- ë©”ëª¨ë¦¬ ê´€ë¦¬ ì£¼ê¸° ì¡°ì • (í˜„ì¬ 10ë°°ì¹˜ë§ˆë‹¤)
- API í˜¸ì¶œ ë³‘ë ¬ ì²˜ë¦¬ (í•„ìš”ì‹œ)
- ì¸ë±ìŠ¤ ì¶”ê°€ (ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒ)

ì´ ë¬¸ì„œëŠ” í¸ì˜ì  ë°ì´í„° ë¶„ì„ìš© ì‹œìŠ¤í…œì˜ ì™„ì „í•œ êµ¬í˜„ ê°€ì´ë“œì…ë‹ˆë‹¤. ëª¨ë“  ì½”ë“œì™€ ì„¤ì •ì´ í¬í•¨ë˜ì–´ ìˆì–´ ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥í•©ë‹ˆë‹¤.