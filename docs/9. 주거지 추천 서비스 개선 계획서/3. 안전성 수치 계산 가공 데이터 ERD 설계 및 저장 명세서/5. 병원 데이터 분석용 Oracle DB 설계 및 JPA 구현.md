# ë³‘ì› ë°ì´í„° ë¶„ì„ìš© ì‹œìŠ¤í…œ ì™„ì „ êµ¬í˜„ ê°€ì´ë“œ

**í”„ë¡œì íŠ¸ëª…:** ì•ˆì „ì„± ì ìˆ˜ ê³„ì‚° ì‹œìŠ¤í…œ - ë³‘ì› í†µê³„ ë¶„ì„ ë°ì´í„° ì²˜ë¦¬  
**ë²„ì „:** 1.0  
**ì‘ì„±ì¼:** 2025.09.08  
**ëª©ì :** ì „êµ­ ë³‘ì› ì •ë³´ë¥¼ í”¼ì–´ìŠ¨ ìƒê´€ë¶„ì„ ê³„ì‚°ì— í™œìš©í•˜ê¸° ìœ„í•œ ë¶„ì„ìš© í…Œì´ë¸” êµ¬ì¶•

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/java/com/WhereHouse/AnalysisData/hospital/
â”œâ”€â”€ entity/
â”‚   â””â”€â”€ AnalysisHospitalData.java
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ AnalysisHospitalDataRepository.java
â”œâ”€â”€ service/
â”‚   â””â”€â”€ KakaoCoordinateService.java
â”œâ”€â”€ processor/
â”‚   â””â”€â”€ HospitalDataProcessor.java
â””â”€â”€ HospitalAnalysisMain.java

src/main/resources/
â””â”€â”€ application.yml

database/
â””â”€â”€ create_analysis_hospital_table.sql
```

---

## 1. Entity í´ë˜ìŠ¤ (AnalysisHospitalData.java)

**íŒŒì¼ ê²½ë¡œ:** `src/main/java/com/WhereHouse/AnalysisData/hospital/entity/AnalysisHospitalData.java`

```java
package com.WhereHouse.AnalysisData.hospital.entity;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.math.BigDecimal;
import java.time.LocalDateTime;

@Entity
@Table(name = "ANALYSIS_HOSPITAL_DATA")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class AnalysisHospitalData {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "analysis_hospital_data_seq")
    @SequenceGenerator(name = "analysis_hospital_data_seq", sequenceName = "SEQ_ANALYSIS_HOSPITAL_DATA", allocationSize = 1)
    private Long id;

    @Column(name = "BUSINESS_NAME", length = 4000)
    private String businessName;

    @Column(name = "BUSINESS_TYPE_NAME", length = 4000)
    private String businessTypeName;

    @Column(name = "DETAILED_STATUS_NAME", length = 4000)
    private String detailedStatusName;

    @Column(name = "PHONE_NUMBER", length = 4000)
    private String phoneNumber;

    @Column(name = "LOT_ADDRESS", length = 4000)
    private String lotAddress;

    @Column(name = "ROAD_ADDRESS", length = 4000)
    private String roadAddress;

    @Column(name = "LATITUDE", precision = 10, scale = 7)
    private BigDecimal latitude;

    @Column(name = "LONGITUDE", precision = 10, scale = 7)
    private BigDecimal longitude;

    @Column(name = "CREATED_AT", updatable = false)
    private LocalDateTime createdAt;

    @Column(name = "UPDATED_AT")
    private LocalDateTime updatedAt;

    @PrePersist
    protected void onCreate() {
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();
    }

    @PreUpdate
    protected void onUpdate() {
        this.updatedAt = LocalDateTime.now();
    }
}
```

---

## 2. Repository ì¸í„°í˜ì´ìŠ¤ (AnalysisHospitalDataRepository.java)

**íŒŒì¼ ê²½ë¡œ:** `src/main/java/com/WhereHouse/AnalysisData/hospital/repository/AnalysisHospitalDataRepository.java`

```java
package com.WhereHouse.AnalysisData.hospital.repository;

import com.WhereHouse.AnalysisData.hospital.entity.AnalysisHospitalData;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface AnalysisHospitalDataRepository extends JpaRepository<AnalysisHospitalData, Long> {

    /**
     * ì¢Œí‘œ ì™„ì„±ë„ í™•ì¸
     */
    @Query("SELECT COUNT(*) FROM AnalysisHospitalData")
    Long getTotalCount();

    @Query("SELECT COUNT(*) FROM AnalysisHospitalData a WHERE a.latitude IS NOT NULL AND a.longitude IS NOT NULL")
    Long getCoordinateCount();

    /**
     * ì—…ì¢…ë³„ ë¶„í¬ ì¡°íšŒ
     */
    @Query("SELECT a.businessTypeName, COUNT(a) FROM AnalysisHospitalData a GROUP BY a.businessTypeName ORDER BY COUNT(a) DESC")
    List<Object[]> countByBusinessType();

    /**
     * ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬ ì¡°íšŒ
     */
    @Query("SELECT a.detailedStatusName, COUNT(a) FROM AnalysisHospitalData a GROUP BY a.detailedStatusName ORDER BY COUNT(a) DESC")
    List<Object[]> countByDetailedStatus();

    /**
     * ë°ì´í„° í’ˆì§ˆ ê²€ì¦ìš© í†µê³„ ì¡°íšŒ
     */
    @Query("SELECT " +
           "COUNT(*) as totalCount, " +
           "COUNT(a.latitude) as coordinateCount, " +
           "COUNT(a.businessName) as businessNameCount, " +
           "COUNT(a.businessTypeName) as businessTypeCount " +
           "FROM AnalysisHospitalData a")
    Object[] getDataQualityStats();
}
```

---

## 3. Kakao API ì¢Œí‘œ ê³„ì‚° ì„œë¹„ìŠ¤ (KakaoCoordinateService.java)

**íŒŒì¼ ê²½ë¡œ:** `src/main/java/com/WhereHouse/AnalysisData/hospital/service/KakaoCoordinateService.java`

```java
package com.WhereHouse.AnalysisData.hospital.service;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import java.math.BigDecimal;
import java.util.Arrays;
import java.util.List;
import java.util.regex.Pattern;

@Service
@Slf4j
public class KakaoCoordinateService {

    @Value("${kakao.api.key}")
    private String kakaoApiKey;

    private final RestTemplate restTemplate = new RestTemplate();
    private final ObjectMapper objectMapper = new ObjectMapper();

    // ë³‘ì› ê´€ë ¨ í‚¤ì›Œë“œ ëª©ë¡
    private static final List<String> HOSPITAL_KEYWORDS = Arrays.asList(
        "ë³‘ì›", "ì˜ì›", "í•œì˜ì›", "ì¹˜ê³¼", "ìš”ì–‘ë³‘ì›", "ì¬í™œë³‘ì›", "ì •ì‹ ë³‘ì›",
        "í´ë¦¬ë‹‰", "ì„¼í„°", "ì˜ë£Œì„¼í„°", "ê±´ê°•ì„¼í„°", "ë³´ê±´ì†Œ", "í•œë°©",
        "ì¹˜ê³¼ì˜ì›", "ì •í˜•ì™¸ê³¼", "ë‚´ê³¼", "ì™¸ê³¼", "ì‚°ë¶€ì¸ê³¼", "ì†Œì•„ê³¼",
        "í”¼ë¶€ê³¼", "ì•ˆê³¼", "ì´ë¹„ì¸í›„ê³¼", "ì˜ë£Œ", "ì§„ë£Œì†Œ", "ìš”ì–‘ì›", "í•œë°©ì§„ë£Œì‹¤"
    );

    // íŠ¹ë³„ì‹œ/ê´‘ì—­ì‹œ í‘œê¸° í†µì¼ì„ ìœ„í•œ íŒ¨í„´
    private static final Pattern SPECIAL_CITY_PATTERN = Pattern.compile("ì„œìš¸íŠ¹ë³„ì‹œ");
    private static final Pattern METRO_CITY_PATTERN = Pattern.compile("(ë¶€ì‚°|ëŒ€êµ¬|ì¸ì²œ|ê´‘ì£¼|ëŒ€ì „|ìš¸ì‚°)ê´‘ì—­ì‹œ");

    /**
     * ì£¼ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¢Œí‘œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
     * @param roadAddress ë„ë¡œëª…ì£¼ì†Œ
     * @param lotAddress ì§€ë²ˆì£¼ì†Œ
     * @param businessName ì‚¬ì—…ì¥ëª… (ë¡œê¹…ìš©)
     * @return [ìœ„ë„, ê²½ë„] ë°°ì—´, ì‹¤íŒ¨ì‹œ null
     */
    public BigDecimal[] getCoordinates(String roadAddress, String lotAddress, String businessName) {
        // ë„ë¡œëª…ì£¼ì†Œ ìš°ì„  ì‹œë„
        if (roadAddress != null && !roadAddress.trim().isEmpty()) {
            BigDecimal[] coordinates = tryGetCoordinatesWithVariations(roadAddress, businessName);
            if (coordinates != null) {
                return coordinates;
            }
        }

        // ì§€ë²ˆì£¼ì†Œë¡œ ì¬ì‹œë„
        if (lotAddress != null && !lotAddress.trim().isEmpty()) {
            BigDecimal[] coordinates = tryGetCoordinatesWithVariations(lotAddress, businessName);
            if (coordinates != null) {
                return coordinates;
            }
        }

        log.error("ì¢Œí‘œ ê³„ì‚° ì‹¤íŒ¨ - ì‚¬ì—…ì¥ëª…: {}, ë„ë¡œëª…ì£¼ì†Œ: {}, ì§€ë²ˆì£¼ì†Œ: {}", 
                 businessName, roadAddress, lotAddress);
        return null;
    }

    /**
     * ì£¼ì†Œ ë³€í˜•ì„ í†µí•œ ì¢Œí‘œ ê³„ì‚° ì‹œë„
     */
    private BigDecimal[] tryGetCoordinatesWithVariations(String address, String businessName) {
        List<String> addressVariations = generateAddressVariations(address);
        
        for (String variation : addressVariations) {
            BigDecimal[] coordinates = callKakaoApi(variation);
            if (coordinates != null) {
                log.debug("ì¢Œí‘œ ê³„ì‚° ì„±ê³µ - ì‚¬ì—…ì¥ëª…: {}, ì‚¬ìš©ëœ ì£¼ì†Œ: {}, ìœ„ë„: {}, ê²½ë„: {}", 
                         businessName, variation, coordinates[0], coordinates[1]);
                return coordinates;
            }
        }
        
        return null;
    }

    /**
     * ì£¼ì†Œ ë³€í˜• íŒ¨í„´ ìƒì„±
     */
    private List<String> generateAddressVariations(String originalAddress) {
        String cleaned = originalAddress.trim();
        
        // 1. ì›ë³¸ ì£¼ì†Œ
        String variation1 = cleaned;
        
        // 2. ë³‘ì› í‚¤ì›Œë“œ ì œê±°
        String variation2 = removeHospitalKeywords(cleaned);
        
        // 3. ê±´ë¬¼ ì •ë³´ ì œê±° (ì¸µìˆ˜, í˜¸ìˆ˜)
        String variation3 = removeBuildingInfo(variation2);
        
        // 4. ê´„í˜¸ ë‚´ìš© ì œê±°
        String variation4 = removeParentheses(variation3);
        
        // 5. í•µì‹¬ ì£¼ì†Œ ì¶”ì¶œ (ì‹œ/ë„/êµ¬/ë™/ë²ˆì§€)
        String variation5 = extractCoreAddress(variation4);
        
        return Arrays.asList(variation1, variation2, variation3, variation4, variation5)
                .stream()
                .distinct()
                .filter(addr -> addr.length() >= 5) // ìµœì†Œ ê¸¸ì´ ë³´ì¥
                .toList();
    }

    /**
     * ë³‘ì› ê´€ë ¨ í‚¤ì›Œë“œ ì œê±°
     */
    private String removeHospitalKeywords(String address) {
        String result = address;
        for (String keyword : HOSPITAL_KEYWORDS) {
            result = result.replaceAll(keyword, "");
        }
        return normalizeAddress(result);
    }

    /**
     * ê±´ë¬¼ ì •ë³´ ì œê±° (ì¸µìˆ˜, í˜¸ìˆ˜, ê±´ë¬¼ëª…)
     */
    private String removeBuildingInfo(String address) {
        return address
                .replaceAll("\\d+ì¸µ", "")
                .replaceAll("\\d+í˜¸", "")
                .replaceAll("ì§€í•˜\\d*", "")
                .replaceAll("[ê°€-í£]+ë¹Œë”©", "")
                .replaceAll("[ê°€-í£]+íƒ€ì›Œ", "")
                .replaceAll("[ê°€-í£]+ìƒê°€", "")
                .trim();
    }

    /**
     * ê´„í˜¸ ë‚´ìš© ì œê±°
     */
    private String removeParentheses(String address) {
        return address.replaceAll("\\([^)]*\\)", "").trim();
    }

    /**
     * í•µì‹¬ ì£¼ì†Œ ì¶”ì¶œ
     */
    private String extractCoreAddress(String address) {
        // ê¸°ë³¸ì ì¸ ì£¼ì†Œ êµ¬ì„±ìš”ì†Œë§Œ ë‚¨ê¸°ê¸°
        String result = address
                .replaceAll("[,\\-]+$", "") // ëì˜ íŠ¹ìˆ˜ë¬¸ì ì œê±°
                .replaceAll("\\s+", " ") // ì—°ì† ê³µë°± ì •ë¦¬
                .trim();
        
        return normalizeAddress(result);
    }

    /**
     * ì£¼ì†Œ í‘œê¸° í†µì¼
     */
    private String normalizeAddress(String address) {
        String result = address;
        
        // íŠ¹ë³„ì‹œ/ê´‘ì—­ì‹œ í‘œê¸° í†µì¼
        result = SPECIAL_CITY_PATTERN.matcher(result).replaceAll("ì„œìš¸ì‹œ");
        result = METRO_CITY_PATTERN.matcher(result).replaceAll("$1ì‹œ");
        
        // ì—°ì† ê³µë°± ì •ë¦¬
        result = result.replaceAll("\\s+", " ").trim();
        
        return result;
    }

    /**
     * Kakao API í˜¸ì¶œ (ìˆ˜ë™ URL ì¡°í•©)
     */
    private BigDecimal[] callKakaoApi(String address) {
        try {
            // ìˆ˜ë™ìœ¼ë¡œ URL ì¡°í•© (UriComponentsBuilder ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
//            String encodedAddress = java.net.URLEncoder.encode(address, "UTF-8");
//            String url = "https://dapi.kakao.com/v2/local/search/address.json?query=" + encodedAddress;
            String url = "https://dapi.kakao.com/v2/local/search/address.json?query=" + address;

            log.debug("=== Kakao API í˜¸ì¶œ ë””ë²„ê¹… ===");
            log.debug("ì›ë³¸ ì£¼ì†Œ: {}", address);
//            log.debug("ì¸ì½”ë”©ëœ ì£¼ì†Œ: {}", encodedAddress);
//            log.debug("ìµœì¢… URL: {}", url);
            log.debug("ìµœì¢… URL: {}", address);

            HttpHeaders headers = new HttpHeaders();
            headers.set("Authorization", "KakaoAK " + kakaoApiKey);
            headers.set("Content-Type", "application/json;charset=UTF-8");

            HttpEntity<String> entity = new HttpEntity<>(headers);
            ResponseEntity<String> response = restTemplate.exchange(url, HttpMethod.GET, entity, String.class);


            log.debug("ì‘ë‹µ ìƒíƒœ ì½”ë“œ: {}", response.getStatusCode());
            log.debug("ì‘ë‹µ í—¤ë”: {}", response.getHeaders());
            log.debug("ì‘ë‹µ ë³¸ë¬¸: {}", response.getBody());
            log.debug("=============================");

            if (response.getStatusCode().is2xxSuccessful()) {
                return parseCoordinatesFromResponse(response.getBody());
            } else {
                log.warn("API í˜¸ì¶œ ì‹¤íŒ¨ - ìƒíƒœì½”ë“œ: {}, ì£¼ì†Œ: {}", response.getStatusCode(), address);
            }
        } catch (Exception e) {
            log.error("Kakao API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ - ì£¼ì†Œ: {}, ì˜¤ë¥˜: {}", address, e.getMessage(), e);
        }

        return null;
    }

    /**
     * API ì‘ë‹µì—ì„œ ì¢Œí‘œ ì¶”ì¶œ
     */
    private BigDecimal[] parseCoordinatesFromResponse(String responseBody) {
        try {
            JsonNode root = objectMapper.readTree(responseBody);
            JsonNode documents = root.get("documents");
            
            if (documents != null && documents.isArray() && documents.size() > 0) {
                JsonNode firstDoc = documents.get(0);
                
                // road_address ìš°ì„  í™•ì¸
                JsonNode roadAddress = firstDoc.get("road_address");
                if (roadAddress != null && !roadAddress.isNull()) {
                    String lat = roadAddress.get("y").asText();
                    String lon = roadAddress.get("x").asText();
                    BigDecimal[] coordinates = {new BigDecimal(lat), new BigDecimal(lon)};
                    
                    if (isValidKoreanCoordinate(coordinates)) {
                        return coordinates;
                    }
                }
                
                // address í™•ì¸
                JsonNode address = firstDoc.get("address");
                if (address != null && !address.isNull()) {
                    String lat = address.get("y").asText();
                    String lon = address.get("x").asText();
                    BigDecimal[] coordinates = {new BigDecimal(lat), new BigDecimal(lon)};
                    
                    if (isValidKoreanCoordinate(coordinates)) {
                        return coordinates;
                    }
                }
            }
        } catch (Exception e) {
            log.warn("ì¢Œí‘œ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {}", e.getMessage());
        }
        
        return null;
    }

    /**
     * í•œêµ­ ì˜ì—­ ë‚´ ì¢Œí‘œì¸ì§€ ê²€ì¦
     */
    private boolean isValidKoreanCoordinate(BigDecimal[] coordinates) {
        if (coordinates == null || coordinates.length != 2) {
            return false;
        }
        
        BigDecimal lat = coordinates[0];
        BigDecimal lon = coordinates[1];
        
        // í•œêµ­ ì˜ì—­: ìœ„ë„ 33.0~38.7, ê²½ë„ 124.0~132.0
        return lat.compareTo(new BigDecimal("33.0")) >= 0 && 
               lat.compareTo(new BigDecimal("38.7")) <= 0 &&
               lon.compareTo(new BigDecimal("124.0")) >= 0 && 
               lon.compareTo(new BigDecimal("132.0")) <= 0;
    }
}
```

---

## 4. ë°ì´í„° ì²˜ë¦¬ í”„ë¡œì„¸ì„œ (HospitalDataProcessor.java)

**íŒŒì¼ ê²½ë¡œ:** `src/main/java/com/WhereHouse/AnalysisData/hospital/processor/HospitalDataProcessor.java`

```java
package com.WhereHouse.AnalysisData.hospital.processor;

import com.WhereHouse.AnalysisData.hospital.entity.AnalysisHospitalData;
import com.WhereHouse.AnalysisData.hospital.repository.AnalysisHospitalDataRepository;
import com.WhereHouse.AnalysisData.hospital.service.KakaoCoordinateService;
import com.WhereHouse.AnalysisStaticData.HospitalSave.entity.HospitalData;
import com.WhereHouse.AnalysisStaticData.HospitalSave.repository.HospitalDataRepository;
import jakarta.persistence.EntityManager;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Component
@RequiredArgsConstructor
@Slf4j
public class HospitalDataProcessor {

    private final HospitalDataRepository hospitalDataRepository;
    private final AnalysisHospitalDataRepository analysisHospitalDataRepository;
    private final KakaoCoordinateService kakaoCoordinateService;
    private final EntityManager entityManager;

    private static final int BATCH_SIZE = 1000;

    /**
     * ë³‘ì› ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± ë©”ì¸ í”„ë¡œì„¸ìŠ¤
     */
    @Transactional
    public void processHospitalDataForAnalysis() {
        log.info("=== ë³‘ì› ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± ì‘ì—… ì‹œì‘ ===");
        LocalDateTime startTime = LocalDateTime.now();

        // ê¸°ì¡´ ë¶„ì„ìš© ë°ì´í„° ì‚­ì œ (ì„ íƒì‚¬í•­)
        log.info("ê¸°ì¡´ ë¶„ì„ìš© ë°ì´í„° ì‚­ì œ ì¤‘...");
        analysisHospitalDataRepository.deleteAll();
        entityManager.flush();
        entityManager.clear();

        // ì „ì²´ ë°ì´í„° ê°œìˆ˜ ì¡°íšŒ
        long totalCount = hospitalDataRepository.count();
        log.info("ì²˜ë¦¬ ëŒ€ìƒ ì›ì²œ ë°ì´í„°: {} ê°œ", totalCount);

        // í†µê³„ ë³€ìˆ˜ ì´ˆê¸°í™”
        ProcessingStats stats = new ProcessingStats();
        stats.totalSourceData = (int) totalCount;

        // ë°°ì¹˜ ì²˜ë¦¬
        int totalPages = (int) Math.ceil((double) totalCount / BATCH_SIZE);
        
        for (int page = 0; page < totalPages; page++) {
            processBatch(page, stats);
            
            // ë©”ëª¨ë¦¬ ê´€ë¦¬
            entityManager.flush();
            entityManager.clear();
            
            // ì§„í–‰ë¥  ë¡œê¹…
            int processed = (page + 1) * BATCH_SIZE;
            int actualProcessed = Math.min(processed, (int) totalCount);
            log.info("ì§„í–‰ë¥ : {}/{} ({:.1f}%)", 
                    actualProcessed, totalCount, 
                    (actualProcessed * 100.0 / totalCount));
        }

        // ìµœì¢… ê²°ê³¼ ì¶œë ¥
        LocalDateTime endTime = LocalDateTime.now();
        printFinalResults(stats, startTime, endTime);
    }

    /**
     * ë°°ì¹˜ ë‹¨ìœ„ ë°ì´í„° ì²˜ë¦¬
     */
    private void processBatch(int page, ProcessingStats stats) {
        PageRequest pageRequest = PageRequest.of(page, BATCH_SIZE);
        Page<HospitalData> hospitalDataPage = hospitalDataRepository.findAll(pageRequest);
        
        List<AnalysisHospitalData> batchList = new ArrayList<>();
        
        for (HospitalData sourceData : hospitalDataPage.getContent()) {
            try {
                AnalysisHospitalData analysisData = convertToAnalysisData(sourceData, stats);
                if (analysisData != null) {
                    batchList.add(analysisData);
                    stats.successfulConversions++;
                }
            } catch (Exception e) {
                stats.failedConversions++;
                log.error("ë°ì´í„° ë³€í™˜ ì‹¤íŒ¨ - ID: {}, ì‚¬ì—…ì¥ëª…: {}, ì˜¤ë¥˜: {}", 
                         sourceData.getId(), sourceData.getBusinessName(), e.getMessage());
            }
        }
        
        // ë°°ì¹˜ ì €ì¥
        if (!batchList.isEmpty()) {
            analysisHospitalDataRepository.saveAll(batchList);
        }
    }

    /**
     * ì›ì²œ ë°ì´í„°ë¥¼ ë¶„ì„ìš© ë°ì´í„°ë¡œ ë³€í™˜
     */
    private AnalysisHospitalData convertToAnalysisData(HospitalData sourceData, ProcessingStats stats) {
        AnalysisHospitalData.AnalysisHospitalDataBuilder builder = AnalysisHospitalData.builder();
        
        // ê¸°ë³¸ ì •ë³´ ë³€í™˜ (NULL ì²˜ë¦¬ ì ìš©)
        builder.businessName(processStringField(sourceData.getBusinessName()))
               .businessTypeName(processStringField(sourceData.getBusinessTypeName()))
               .detailedStatusName(processStringField(sourceData.getDetailedStatusName()))
               .phoneNumber(processStringField(sourceData.getPhoneNumber()))
               .lotAddress(processStringField(sourceData.getLotAddress()))
               .roadAddress(processStringField(sourceData.getRoadAddress()));

        // ìƒì„¸ì˜ì—…ìƒíƒœë³„ í†µê³„ ì—…ë°ì´íŠ¸
        String statusName = sourceData.getDetailedStatusName();
        stats.statusDistribution.merge(statusName != null ? statusName : "ë°ì´í„°ì—†ìŒ", 1, Integer::sum);

        // ì—…ì¢…ë³„ í†µê³„ ì—…ë°ì´íŠ¸
        String businessType = sourceData.getBusinessTypeName();
        stats.businessTypeDistribution.merge(businessType != null ? businessType : "ë°ì´í„°ì—†ìŒ", 1, Integer::sum);

        // ì¢Œí‘œ ê³„ì‚° (ê¸°ì¡´ ì¢Œí‘œëŠ” ë¬´ì‹œí•˜ê³  Kakao APIë¡œë§Œ ê³„ì‚°)
        BigDecimal[] coordinates = kakaoCoordinateService.getCoordinates(
            sourceData.getRoadAddress(),
            sourceData.getLotAddress(),
            sourceData.getBusinessName()
        );

        if (coordinates != null) {
            builder.latitude(coordinates[0])
                   .longitude(coordinates[1]);
            stats.successfulCoordinates++;
        } else {
            // ì¢Œí‘œ ê³„ì‚° ì‹¤íŒ¨ ì‹œ NULLë¡œ ì €ì¥
            builder.latitude(null)
                   .longitude(null);
            stats.failedCoordinates++;
        }

        return builder.build();
    }

    /**
     * ë¬¸ìì—´ í•„ë“œ NULL ì²˜ë¦¬
     */
    private String processStringField(String value) {
        if (value == null || value.trim().isEmpty()) {
            return "ë°ì´í„°ì—†ìŒ";
        }
        return value.trim();
    }

    /**
     * ìµœì¢… ê²°ê³¼ ì¶œë ¥
     */
    private void printFinalResults(ProcessingStats stats, LocalDateTime startTime, LocalDateTime endTime) {
        long processingTimeSeconds = java.time.Duration.between(startTime, endTime).getSeconds();
        long minutes = processingTimeSeconds / 60;
        long seconds = processingTimeSeconds % 60;

        log.info("\n=== ë³‘ì› ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± ì‘ì—… ì™„ë£Œ ===");
        log.info("- ì›ì²œ ë°ì´í„°: {} ê°œ", stats.totalSourceData);
        log.info("- ë°ì´í„° ë³€í™˜: ì„±ê³µ {} ê°œ, ì‹¤íŒ¨ {} ê°œ", 
                stats.successfulConversions, stats.failedConversions);
        
        if (stats.successfulConversions > 0) {
            double coordinateSuccessRate = (stats.successfulCoordinates * 100.0) / stats.successfulConversions;
            log.info("- ì¢Œí‘œ ê³„ì‚°: ì„±ê³µ {} ê°œ ({:.1f}%), ì‹¤íŒ¨ {} ê°œ ({:.1f}%)", 
                    stats.successfulCoordinates, coordinateSuccessRate,
                    stats.failedCoordinates, (100.0 - coordinateSuccessRate));
        }

        // ì—…ì¢…ë³„ ë¶„í¬ (ìƒìœ„ 10ê°œ)
        log.info("- ì—…ì¢…ë³„ ë¶„í¬:");
        stats.businessTypeDistribution.entrySet().stream()
                .sorted(Map.Entry.<String, Integer>comparingByValue().reversed())
                .limit(10)
                .forEach(entry -> log.info("  {} : {} ê°œ", entry.getKey(), entry.getValue()));

        // ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬
        log.info("- ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬:");
        stats.statusDistribution.entrySet().stream()
                .sorted(Map.Entry.<String, Integer>comparingByValue().reversed())
                .forEach(entry -> log.info("  {} : {} ê°œ", entry.getKey(), entry.getValue()));

        log.info("- ì²˜ë¦¬ ì‹œê°„: {}ë¶„ {}ì´ˆ", minutes, seconds);
        log.info("- ì™„ë£Œ ì‹œê°: {}", endTime.format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")));
        log.info("===========================================\n");
    }

    /**
     * ë°ì´í„° í’ˆì§ˆ ê²€ì¦ ë©”ì„œë“œ
     */
    public void validateDataQuality() {
        log.info("\n=== ë°ì´í„° í’ˆì§ˆ ê²€ì¦ ===");
        
        Long totalCount = analysisHospitalDataRepository.getTotalCount();
        Long coordinateCount = analysisHospitalDataRepository.getCoordinateCount();
        
        if (totalCount != null && coordinateCount != null) {
            double completionRate = (coordinateCount * 100.0) / totalCount;
            log.info("ì „ì²´ ë°ì´í„°: {} ê°œ", totalCount);
            log.info("ì¢Œí‘œ ë³´ìœ : {} ê°œ ({:.1f}%)", coordinateCount, completionRate);
        }

        // ì—…ì¢…ë³„ ë¶„í¬ í™•ì¸
        List<Object[]> businessTypeStats = analysisHospitalDataRepository.countByBusinessType();
        log.info("ì—…ì¢…ë³„ ë¶„í¬:");
        businessTypeStats.forEach(stat -> 
            log.info("  {} : {} ê°œ", stat[0], stat[1]));

        // ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬ í™•ì¸
        List<Object[]> statusStats = analysisHospitalDataRepository.countByDetailedStatus();
        log.info("ìƒì„¸ì˜ì—…ìƒíƒœë³„ ë¶„í¬:");
        statusStats.forEach(stat -> 
            log.info("  {} : {} ê°œ", stat[0], stat[1]));
            
        log.info("========================\n");
    }

    /**
     * ì²˜ë¦¬ í†µê³„ í´ë˜ìŠ¤
     */
    private static class ProcessingStats {
        int totalSourceData = 0;
        int successfulConversions = 0;
        int failedConversions = 0;
        int successfulCoordinates = 0;
        int failedCoordinates = 0;
        Map<String, Integer> businessTypeDistribution = new HashMap<>();
        Map<String, Integer> statusDistribution = new HashMap<>();
    }
}
```

---

## 5. ë©”ì¸ ì‹¤í–‰ í´ë˜ìŠ¤ (HospitalAnalysisMain.java)

**íŒŒì¼ ê²½ë¡œ:** `src/main/java/com/WhereHouse/AnalysisData/hospital/HospitalAnalysisMain.java`

```java
package com.WhereHouse.AnalysisData.hospital;

import com.WhereHouse.AnalysisData.hospital.processor.HospitalDataProcessor;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Profile;

@SpringBootApplication(scanBasePackages = "com.WhereHouse")
@RequiredArgsConstructor
@Slf4j
@Profile("hospital-analysis") // í”„ë¡œíŒŒì¼ì„ í†µí•œ ì‹¤í–‰ ì œì–´
public class HospitalAnalysisMain implements CommandLineRunner {

    private final HospitalDataProcessor hospitalDataProcessor;

    public static void main(String[] args) {
        System.setProperty("spring.profiles.active", "hospital-analysis");
        SpringApplication.run(HospitalAnalysisMain.class, args);
    }

    @Override
    public void run(String... args) throws Exception {
        try {
            log.info("ë³‘ì› ë°ì´í„° ë¶„ì„ìš© ì‹œìŠ¤í…œ ì‹¤í–‰ ì‹œì‘");
            
            // ë©”ì¸ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰
            hospitalDataProcessor.processHospitalDataForAnalysis();
            
            // ë°ì´í„° í’ˆì§ˆ ê²€ì¦
            hospitalDataProcessor.validateDataQuality();
            
            log.info("ë³‘ì› ë°ì´í„° ë¶„ì„ìš© ì‹œìŠ¤í…œ ì‹¤í–‰ ì™„ë£Œ");
            
        } catch (Exception e) {
            log.error("ë³‘ì› ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            throw e;
        }
    }
}
```

---

## 6. DDL ìŠ¤í¬ë¦½íŠ¸ (create_analysis_hospital_table.sql)

**íŒŒì¼ ê²½ë¡œ:** `database/create_analysis_hospital_table.sql`

```sql
-- ë³‘ì› ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” ìƒì„± DDL ìŠ¤í¬ë¦½íŠ¸
-- ì‘ì„±ì¼: 2025.09.08
-- ëª©ì : í”¼ì–´ìŠ¨ ìƒê´€ë¶„ì„ìš© ë³‘ì› ë°ì´í„° í…Œì´ë¸” êµ¬ì¶•

-- ê¸°ì¡´ í…Œì´ë¸” ë° ì‹œí€€ìŠ¤ ì‚­ì œ (í•„ìš”ì‹œ)
-- DROP TABLE ANALYSIS_HOSPITAL_DATA CASCADE CONSTRAINTS;
-- DROP SEQUENCE SEQ_ANALYSIS_HOSPITAL_DATA;

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE SEQ_ANALYSIS_HOSPITAL_DATA
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

-- ë¶„ì„ìš© ë³‘ì› ë°ì´í„° í…Œì´ë¸” ìƒì„±
CREATE TABLE ANALYSIS_HOSPITAL_DATA (
    ID NUMBER PRIMARY KEY,
    BUSINESS_NAME VARCHAR2(4000),
    BUSINESS_TYPE_NAME VARCHAR2(4000), 
    DETAILED_STATUS_NAME VARCHAR2(4000),
    PHONE_NUMBER VARCHAR2(4000),
    LOT_ADDRESS VARCHAR2(4000),
    ROAD_ADDRESS VARCHAR2(4000),
    LATITUDE NUMBER(10,7),
    LONGITUDE NUMBER(10,7),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- í…Œì´ë¸” ë° ì»¬ëŸ¼ ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON TABLE ANALYSIS_HOSPITAL_DATA IS 'ë³‘ì› ë°ì´í„° ë¶„ì„ìš© í…Œì´ë¸” - í”¼ì–´ìŠ¨ ìƒê´€ë¶„ì„ ë…ë¦½ë³€ìˆ˜(ì˜ë£Œê¸°ê´€ ë°€ë„) ë°ì´í„°';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.ID IS 'ê¸°ë³¸í‚¤ (ìë™ìƒì„±)';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.BUSINESS_NAME IS 'ì‚¬ì—…ì¥ëª…';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.BUSINESS_TYPE_NAME IS 'ì—…ì¢…ëª… (ë³‘ì›, ì˜ì›, ì¹˜ê³¼ì˜ì› ë“±)';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.DETAILED_STATUS_NAME IS 'ìƒì„¸ì˜ì—…ìƒíƒœëª… (ì˜ì—…, íì—…, íœ´ì—… ë“±)';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.PHONE_NUMBER IS 'ì „í™”ë²ˆí˜¸';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.LOT_ADDRESS IS 'ì§€ë²ˆì£¼ì†Œ';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.ROAD_ADDRESS IS 'ë„ë¡œëª…ì£¼ì†Œ';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.LATITUDE IS 'ìœ„ë„ (Kakao API ê³„ì‚°)';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.LONGITUDE IS 'ê²½ë„ (Kakao API ê³„ì‚°)';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.CREATED_AT IS 'ìƒì„±ì¼ì‹œ';
COMMENT ON COLUMN ANALYSIS_HOSPITAL_DATA.UPDATED_AT IS 'ìˆ˜ì •ì¼ì‹œ';

-- í…Œì´ë¸” ìƒì„± í™•ì¸
SELECT TABLE_NAME, COMMENTS 
FROM USER_TAB_COMMENTS 
WHERE TABLE_NAME = 'ANALYSIS_HOSPITAL_DATA';

-- ì»¬ëŸ¼ ì •ë³´ í™•ì¸
SELECT COLUMN_NAME, DATA_TYPE, NULLABLE, COMMENTS
FROM USER_COL_COMMENTS 
WHERE TABLE_NAME = 'ANALYSIS_HOSPITAL_DATA'
ORDER BY COLUMN_ID;
```

---

## 7. Application ì„¤ì • íŒŒì¼ (application.yml)

**íŒŒì¼ ê²½ë¡œ:** `src/main/resources/application.yml`

```yaml
# ë³‘ì› ë°ì´í„° ë¶„ì„ìš© ì‹œìŠ¤í…œ ì„¤ì •
spring:
  profiles:
    active: hospital-analysis
  
  # ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
  datasource:
    driver-class-name: oracle.jdbc.OracleDriver
    url: jdbc:oracle:thin:@localhost:1521:XE  # ì‹¤ì œ DB ì •ë³´ë¡œ ë³€ê²½
    username: your_username  # ì‹¤ì œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
    password: your_password  # ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½
    
    # ì»¤ë„¥ì…˜ í’€ ì„¤ì •
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 60000
      idle-timeout: 300000
      max-lifetime: 900000
      leak-detection-threshold: 60000

  # JPA ì„¤ì •
  jpa:
    hibernate:
      ddl-auto: none  # í…Œì´ë¸”ì€ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
    show-sql: false  # ìš´ì˜ ì‹œì—ëŠ” falseë¡œ ì„¤ì •
    properties:
      hibernate:
        dialect: org.hibernate.dialect.OracleDialect
        format_sql: true
        jdbc:
          batch_size: 1000  # ë°°ì¹˜ í¬ê¸°ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
        order_inserts: true
        order_updates: true
        batch_versioned_data: true
        connection:
          provider_disables_autocommit: true

# Kakao API ì„¤ì •
kakao:
  api:
    key: your_kakao_api_key  # ì‹¤ì œ Kakao API í‚¤ë¡œ ë³€ê²½
    url: https://dapi.kakao.com/v2/local/search/address.json

# ë¡œê¹… ì„¤ì •
logging:
  level:
    com.WhereHouse.AnalysisData.hospital: DEBUG
    org.springframework.web.client.RestTemplate: DEBUG
    org.hibernate.SQL: WARN  # SQL ë¡œê·¸ëŠ” í•„ìš”ì‹œì—ë§Œ DEBUGë¡œ ë³€ê²½
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/hospital-analysis.log
    max-size: 100MB
    max-history: 30

# ì‹œìŠ¤í…œ ì„±ëŠ¥ ì„¤ì •
server:
  tomcat:
    threads:
      max: 200
      min-spare: 10

# ì»¤ìŠ¤í…€ ì„¤ì •
hospital-analysis:
  batch:
    size: 1000  # ë°°ì¹˜ ì²˜ë¦¬ í¬ê¸°
    log-interval: 1000  # ë¡œê·¸ ì¶œë ¥ ê°„ê²©
  coordinate:
    retry-count: 5  # ì£¼ì†Œ ë³€í˜• ì‹œë„ íšŸìˆ˜
    validation:
      latitude:
        min: 33.0  # í•œêµ­ ìµœë‚¨ë‹¨ ìœ„ë„
        max: 38.7  # í•œêµ­ ìµœë¶ë‹¨ ìœ„ë„
      longitude:
        min: 124.0  # í•œêµ­ ìµœì„œë‹¨ ê²½ë„
        max: 132.0  # í•œêµ­ ìµœë™ë‹¨ ê²½ë„

---
# ê°œë°œí™˜ê²½ ì„¤ì •
spring:
  config:
    activate:
      on-profile: development
  jpa:
    show-sql: true
    properties:
      hibernate:
        format_sql: true

logging:
  level:
    com.WhereHouse.AnalysisData.hospital: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

---
# ìš´ì˜í™˜ê²½ ì„¤ì •
spring:
  config:
    activate:
      on-profile: production
  jpa:
    show-sql: false
    properties:
      hibernate:
        format_sql: false

logging:
  level:
    com.WhereHouse.AnalysisData.hospital: INFO
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
```

---

## ğŸ“‹ êµ¬í˜„ ìˆœì„œ ë° ì‹¤í–‰ ê°€ì´ë“œ

### **1ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •**
```bash
# DDL ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
sqlplus username/password@database < create_analysis_hospital_table.sql
```

### **2ë‹¨ê³„: ì„¤ì • íŒŒì¼ ìˆ˜ì •**
1. `application.yml`ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ ìˆ˜ì •
2. Kakao API í‚¤ ì„¤ì •

### **3ë‹¨ê³„: í”„ë¡œì íŠ¸ ë¹Œë“œ ë° ì‹¤í–‰**
```bash
# í”„ë¡œì íŠ¸ ë¹Œë“œ
./gradlew build

# ì‹¤í–‰
java -jar build/libs/your-project-name.jar --spring.profiles.active=hospital-analysis
```

### **4ë‹¨ê³„: ì‹¤í–‰ ê²°ê³¼ í™•ì¸**
1. ë¡œê·¸ íŒŒì¼ í™•ì¸: `logs/hospital-analysis.log`
2. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê²°ê³¼ í…Œì´ë¸” ì¡°íšŒ

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥ ë° íŠ¹ì§•

- **ê¸°ì¡´ ì¢Œí‘œ ë¬´ì‹œ**: COORDINATE_X, COORDINATE_Y ì™„ì „ ë¬´ì‹œí•˜ê³  Kakao APIë¡œë§Œ ê³„ì‚°
- **ë³‘ì› íŠ¹í™” ì „ì²˜ë¦¬**: ì˜ë£Œê¸°ê´€ëª…, ì§„ë£Œê³¼ëª© ì²´ê³„ì  ì œê±°ë¡œ API ì¸ì‹ë¥  í–¥ìƒ
- **5ë‹¨ê³„ ì£¼ì†Œ ë³€í˜•**: ì›ë³¸ â†’ ë³‘ì›í‚¤ì›Œë“œì œê±° â†’ ê±´ë¬¼ì •ë³´ì œê±° â†’ ê´„í˜¸ì œê±° â†’ í•µì‹¬ì£¼ì†Œì¶”ì¶œ
- **1000ê°œ ë‹¨ìœ„ ë°°ì¹˜ ì²˜ë¦¬**: ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ê³¼ ì„±ëŠ¥ ìµœì í™”
- **ìƒì„¸í•œ ë””ë²„ê¹…**: API í˜¸ì¶œ URL, ì‘ë‹µ ìƒíƒœ, ì‘ë‹µ ë³¸ë¬¸ ì „ì²´ ë¡œê·¸ ì¶œë ¥
- **í’ˆì§ˆ ê²€ì¦**: ì¢Œí‘œ ì™„ì„±ë„, ì—…ì¢…ë³„/ìƒíƒœë³„ ë¶„í¬, ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦