# 부동산 추천 시스템 Postman 컬렉션 테스트 명세서

## Postman 환경 변수 설정

**Environment Name**: Real Estate Recommendation API  
**Variables**:
- `base_url`: `http://localhost:8185/wherehouse` (application.yml의 server.port와 context-path 반영)
- `content_type`: `application/json`

---

## 1. Health Check API

### Method: GET
### URL: `{{base_url}}/api/recommendations/health`

#### Headers:
*None required*

#### Body:
*None*

#### Expected Response:
```
Status: 200 OK
Body: OK
```

---

## 2. 전세 요청 테스트 시리즈 (CHARTER)

### 2-1. 전세 가격 우선순위 테스트 (PRICE 1순위)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "CHARTER",
  "budgetMin": 25000,
  "budgetMax": 45000,
  "areaMin": 20.0,
  "areaMax": 35.0,
  "priority1": "PRICE",
  "priority2": "SAFETY",
  "priority3": "SPACE",
  "budgetFlexibility": 10,
  "minSafetyScore": 70,
  "absoluteMinArea": 18.0
}
```

#### Tests:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Response has required fields", function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('searchStatus');
    pm.expect(jsonData).to.have.property('message');
    pm.expect(jsonData).to.have.property('recommendedDistricts');
});

pm.test("PRICE priority - districts should be price-optimized", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 1) {
        console.log("Testing PRICE priority ranking logic");
        
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.include('가격');
        
        jsonData.recommendedDistricts.forEach((district, index) => {
            if (district.top_properties && district.top_properties.length > 0) {
                console.log(`District ${index + 1}: ${district.district_name}, Price range: ${district.top_properties[0].price}`);
            }
        });
    }
});

pm.test("Mixed naming convention (Root: camelCase, Nested: snake_case)", function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('searchStatus');
    pm.expect(jsonData).to.have.property('recommendedDistricts');
    
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict).to.have.property('district_name');
        pm.expect(firstDistrict).to.have.property('top_properties');
        
        if (firstDistrict.top_properties && firstDistrict.top_properties.length > 0) {
            const firstProperty = firstDistrict.top_properties[0];
            pm.expect(firstProperty).to.have.property('property_id');
            pm.expect(firstProperty).to.have.property('property_name');
            pm.expect(firstProperty).to.have.property('lease_type');
            pm.expect(firstProperty).to.have.property('final_score');
        }
    }
});

pm.test("Price priority validation", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.match(/가격.*1순위|가격.*조건/);
    }
});
```

---

### 2-2. 전세 공간 우선순위 테스트 (SPACE 1순위)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "CHARTER",
  "budgetMin": 30000,
  "budgetMax": 50000,
  "areaMin": 25.0,
  "areaMax": 40.0,
  "priority1": "SPACE",
  "priority2": "PRICE",
  "priority3": "SAFETY",
  "budgetFlexibility": 15,
  "minSafetyScore": 60,
  "absoluteMinArea": 20.0
}
```

#### Tests:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("SPACE priority - districts should be space-optimized", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        console.log("Testing SPACE priority ranking logic");
        
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.match(/공간|평수|넓이/);
        
        jsonData.recommendedDistricts.forEach((district, index) => {
            if (district.top_properties && district.top_properties.length > 0) {
                const avgArea = district.top_properties.reduce((sum, prop) => sum + prop.area, 0) / district.top_properties.length;
                console.log(`District ${index + 1}: ${district.district_name}, Avg Area: ${avgArea.toFixed(1)}평`);
            }
        });
    }
});

pm.test("Space priority validation", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.match(/공간.*1순위|공간.*조건/);
    }
});

pm.test("Area values are reasonable", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        jsonData.recommendedDistricts.forEach(district => {
            if (district.top_properties && district.top_properties.length > 0) {
                district.top_properties.forEach(property => {
                    pm.expect(property.area).to.be.at.least(18.0);
                    pm.expect(property.area).to.be.below(100.0);
                });
            }
        });
    }
});
```

---

### 2-3. 전세 안전성 우선순위 테스트 (SAFETY 1순위)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "CHARTER",
  "budgetMin": 20000,
  "budgetMax": 40000,
  "areaMin": 18.0,
  "areaMax": 35.0,
  "priority1": "SAFETY",
  "priority2": "SPACE",
  "priority3": "PRICE",
  "budgetFlexibility": 12,
  "minSafetyScore": 80,
  "absoluteMinArea": 15.0
}
```

#### Tests:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("SAFETY priority - districts should be safety-optimized", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        console.log("Testing SAFETY priority ranking logic");
        
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.match(/안전|치안/);
        
        jsonData.recommendedDistricts.forEach((district, index) => {
            console.log(`District ${index + 1}: ${district.district_name} (Safety prioritized)`);
            if (district.top_properties && district.top_properties.length > 0) {
                const avgScore = district.top_properties.reduce((sum, prop) => sum + prop.final_score, 0) / district.top_properties.length;
                console.log(`  - Average final score: ${avgScore.toFixed(1)}`);
            }
        });
    }
});

pm.test("Safety priority validation", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.match(/안전.*1순위|안전.*조건/);
    }
});

pm.test("High safety score request honored", function () {
    const jsonData = pm.response.json();
    
    if (jsonData.searchStatus === 'SUCCESS_EXPANDED') {
        pm.expect(jsonData.message).to.include('완화');
        console.log("Safety score condition was relaxed due to insufficient properties");
    } else if (jsonData.searchStatus === 'SUCCESS_NORMAL') {
        console.log("Found properties meeting high safety score requirement");
    }
});

pm.test("Final scores are valid", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        jsonData.recommendedDistricts.forEach(district => {
            if (district.top_properties && district.top_properties.length > 0) {
                district.top_properties.forEach(property => {
                    pm.expect(property.final_score).to.be.at.least(0);
                    pm.expect(property.final_score).to.be.at.most(100);
                });
            }
        });
    }
});
```

---

### 2-4. 전세 종합 비교 테스트

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "CHARTER",
  "budgetMin": 25000,
  "budgetMax": 40000,
  "areaMin": 20.0,
  "areaMax": 30.0,
  "priority1": "PRICE",
  "priority2": "SAFETY",
  "priority3": "SPACE",
  "budgetFlexibility": 10,
  "minSafetyScore": 70,
  "absoluteMinArea": 18.0
}
```

#### Tests:
```javascript
pm.test("Priority system working correctly", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 1) {
        console.log("=== Priority System Analysis ===");
        
        jsonData.recommendedDistricts.slice(0, 3).forEach((district, index) => {
            console.log(`Rank ${index + 1}: ${district.district_name}`);
            console.log(`Summary: ${district.summary}`);
            
            if (district.top_properties && district.top_properties.length > 0) {
                const topProperty = district.top_properties[0];
                console.log(`Top Property - Price: ${topProperty.price}만원, Area: ${topProperty.area}평, Score: ${topProperty.final_score}`);
            }
            console.log("---");
        });
        
        for (let i = 0; i < jsonData.recommendedDistricts.length - 1; i++) {
            const currentRank = jsonData.recommendedDistricts[i].rank;
            const nextRank = jsonData.recommendedDistricts[i + 1].rank;
            pm.expect(currentRank).to.be.below(nextRank);
        }
    }
});

pm.test("Recommendation consistency", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        jsonData.recommendedDistricts.forEach((district, index) => {
            pm.expect(district).to.have.property('rank');
            pm.expect(district).to.have.property('district_name');
            pm.expect(district).to.have.property('summary');
            pm.expect(district).to.have.property('top_properties');
            
            pm.expect(district.rank).to.equal(index + 1);
            
            pm.expect(district.top_properties).to.be.an('array');
            if (district.top_properties.length > 0) {
                pm.expect(district.top_properties.length).to.be.at.most(3);
            }
        });
    }
});

pm.test("Message clarity", function () {
    const jsonData = pm.response.json();
    
    pm.expect(jsonData.message).to.be.a('string');
    pm.expect(jsonData.message.length).to.be.above(10);
    
    if (jsonData.searchStatus === 'SUCCESS_NORMAL') {
        pm.expect(jsonData.message).to.match(/성공|찾았/);
    } else if (jsonData.searchStatus === 'SUCCESS_EXPANDED') {
        pm.expect(jsonData.message).to.include('완화');
    }
});
```

---

## 3. 월세 요청 테스트 시리즈 (MONTHLY)

### 3-1. 월세 가격 우선순위 테스트 (PRICE 1순위)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "MONTHLY",
  "budgetMin": 5000,
  "budgetMax": 15000,
  "areaMin": 15.0,
  "areaMax": 25.0,
  "priority1": "PRICE",
  "priority2": "SPACE",
  "priority3": "SAFETY",
  "budgetFlexibility": 20,
  "minSafetyScore": 60,
  "absoluteMinArea": 12.0
}
```

#### Tests:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Lease type is MONTHLY in Korean", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        const firstDistrict = jsonData.recommendedDistricts[0];
        if (firstDistrict.top_properties && firstDistrict.top_properties.length > 0) {
            const firstProperty = firstDistrict.top_properties[0];
            pm.expect(firstProperty.lease_type).to.eql("월세");
        }
    }
});

pm.test("MONTHLY PRICE priority - districts should be price-optimized", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        console.log("Testing MONTHLY PRICE priority ranking logic");
        
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.include('가격');
        
        jsonData.recommendedDistricts.forEach((district, index) => {
            if (district.top_properties && district.top_properties.length > 0) {
                district.top_properties.forEach(property => {
                    console.log(`District ${index + 1}: ${district.district_name}, Property: ${property.property_name}, Price: ${property.price}만원 (월세)`);
                    pm.expect(property.lease_type).to.eql("월세");
                });
            }
        });
    }
});
```

---

### 3-2. 월세 공간 우선순위 테스트 (SPACE 1순위)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "MONTHLY",
  "budgetMin": 8000,
  "budgetMax": 18000,
  "areaMin": 20.0,
  "areaMax": 35.0,
  "priority1": "SPACE",
  "priority2": "PRICE",
  "priority3": "SAFETY",
  "budgetFlexibility": 15,
  "minSafetyScore": 65,
  "absoluteMinArea": 18.0
}
```

#### Tests:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("MONTHLY SPACE priority - districts should be space-optimized", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        console.log("Testing MONTHLY SPACE priority ranking logic");
        
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.match(/공간|평수|넓이/);
        
        jsonData.recommendedDistricts.forEach((district, index) => {
            if (district.top_properties && district.top_properties.length > 0) {
                const avgArea = district.top_properties.reduce((sum, prop) => sum + prop.area, 0) / district.top_properties.length;
                console.log(`District ${index + 1}: ${district.district_name} (월세), Avg Area: ${avgArea.toFixed(1)}평`);
                
                district.top_properties.forEach(property => {
                    pm.expect(property.lease_type).to.eql("월세");
                    pm.expect(property.area).to.be.at.least(15.0);
                });
            }
        });
    }
});
```

---

### 3-3. 월세 안전성 우선순위 테스트 (SAFETY 1순위)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "MONTHLY",
  "budgetMin": 6000,
  "budgetMax": 16000,
  "areaMin": 16.0,
  "areaMax": 28.0,
  "priority1": "SAFETY",
  "priority2": "SPACE",
  "priority3": "PRICE",
  "budgetFlexibility": 25,
  "minSafetyScore": 75,
  "absoluteMinArea": 14.0
}
```

#### Tests:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("MONTHLY SAFETY priority - districts should be safety-optimized", function () {
    const jsonData = pm.response.json();
    if (jsonData.recommendedDistricts && jsonData.recommendedDistricts.length > 0) {
        console.log("Testing MONTHLY SAFETY priority ranking logic");
        
        const firstDistrict = jsonData.recommendedDistricts[0];
        pm.expect(firstDistrict.summary).to.match(/안전|치안/);
        
        jsonData.recommendedDistricts.forEach((district, index) => {
            console.log(`District ${index + 1}: ${district.district_name} (월세, Safety prioritized)`);
            if (district.top_properties && district.top_properties.length > 0) {
                const avgScore = district.top_properties.reduce((sum, prop) => sum + prop.final_score, 0) / district.top_properties.length;
                console.log(`  - Average final score: ${avgScore.toFixed(1)}`);
                
                district.top_properties.forEach(property => {
                    pm.expect(property.lease_type).to.eql("월세");
                    pm.expect(property.final_score).to.be.at.least(0);
                    pm.expect(property.final_score).to.be.at.most(100);
                });
            }
        });
    }
});

pm.test("High safety score for monthly rent honored", function () {
    const jsonData = pm.response.json();
    
    if (jsonData.searchStatus === 'SUCCESS_EXPANDED') {
        pm.expect(jsonData.message).to.include('완화');
        console.log("Monthly rent safety score condition was relaxed due to insufficient properties");
    } else if (jsonData.searchStatus === 'SUCCESS_NORMAL') {
        console.log("Found monthly rent properties meeting high safety score requirement");
    }
});
```

---

## 4. 확장 검색 유도 테스트 (높은 조건)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "CHARTER",
  "budgetMin": 80000,
  "budgetMax": 100000,
  "areaMin": 50.0,
  "areaMax": 70.0,
  "priority1": "PRICE",
  "priority2": "SPACE",
  "priority3": "SAFETY",
  "budgetFlexibility": 20,
  "minSafetyScore": 90,
  "absoluteMinArea": 40.0
}
```

#### Tests:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Should trigger expanded search or no results", function () {
    const jsonData = pm.response.json();
    pm.expect(['SUCCESS_EXPANDED', 'NO_RESULTS']).to.include(jsonData.searchStatus);
});

pm.test("Message should indicate condition relaxation", function () {
    const jsonData = pm.response.json();
    if (jsonData.searchStatus === 'SUCCESS_EXPANDED') {
        pm.expect(jsonData.message).to.include('완화');
    }
});
```

---

## 5. 극단적 조건 (결과 없음 유도)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "CHARTER",
  "budgetMin": 200000,
  "budgetMax": 300000,
  "areaMin": 100.0,
  "areaMax": 150.0,
  "priority1": "PRICE",
  "priority2": "SAFETY",
  "priority3": "SPACE",
  "budgetFlexibility": 0,
  "minSafetyScore": 95,
  "absoluteMinArea": 90.0
}
```

#### Tests:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Should return NO_RESULTS", function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData.searchStatus).to.eql("NO_RESULTS");
    pm.expect(jsonData.recommendedDistricts).to.be.an('array').that.is.empty;
});
```

---

## 6. 필수 필드 누락 테스트 (400 오류)

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "CHARTER",
  "budgetMin": 20000,
  "areaMin": 20.0,
  "areaMax": 30.0,
  "priority1": "PRICE",
  "priority2": "SAFETY",
  "priority3": "SPACE"
}
```

#### Tests:
```javascript
pm.test("Status code is 400", function () {
    pm.response.to.have.status(400);
});

pm.test("Error response structure", function () {
    const jsonData = pm.response.json();
    console.log("Actual error response:", JSON.stringify(jsonData, null, 2));
  
    if (jsonData.status) {
        pm.expect(jsonData.status).to.eql(400);
    }

    const hasErrorInfo = jsonData.message || jsonData.error || jsonData.errors;
    pm.expect(hasErrorInfo).to.exist;
});
```

---

## 7. 잘못된 열거형 값 테스트

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "INVALID_TYPE",
  "budgetMin": 20000,
  "budgetMax": 30000,
  "areaMin": 20.0,
  "areaMax": 30.0,
  "priority1": "INVALID_PRIORITY",
  "priority2": "SAFETY",
  "priority3": "SPACE"
}
```

#### Tests:
```javascript
pm.test("Status code is 400", function () {
    pm.response.to.have.status(400);
});

pm.test("Validation error for invalid enum", function () {
    const jsonData = pm.response.json();
});
```

---

## 8. 우선순위 중복 테스트

### Method: POST
### URL: `{{base_url}}/api/recommendations/districts`

#### Headers:
```
Content-Type: application/json
Accept: application/json
```

#### Body (raw JSON):
```json
{
  "leaseType": "CHARTER",
  "budgetMin": 20000,
  "budgetMax": 30000,
  "areaMin": 20.0,
  "areaMax": 30.0,
  "priority1": "PRICE",
  "priority2": "PRICE",
  "priority3": "SAFETY"
}
```

#### Tests:
```javascript
pm.test("Status code is 400", function () {
    pm.response.to.have.status(400);
});

pm.test("Custom validation error for duplicate priorities", function () {
    const jsonData = pm.response.json();
});
```

---
## Collection-level Pre-request Script

```javascript
// 공통 변수 설정
pm.globals.set("timestamp", new Date().toISOString());
console.log("Request started at: " + pm.globals.get("timestamp"));

// Redis 연결 상태 확인 (선택사항)
pm.globals.set("redis_host", "127.0.0.1:6379");
```

---

## 예상 응답 구조 (Mixed Naming):
```json
{
  "searchStatus": "SUCCESS_EXPANDED",
  "message": "원하시는 조건의 매물이 부족하여, 평수 조건을 18.0평으로 완화하여 찾았어요.",
  "recommendedDistricts": [
    {
      "rank": 1,
      "district_name": "양천구",
      "summary": "가격 1순위 조건에 가장 부합하며...",
      "top_properties": [
        {
          "property_id": "uuid-string",
          "property_name": "이펜하우스4단지",
          "address": "신정동 1317",
          "price": 27780,
          "area": 34.78,
          "floor": 7,
          "build_year": 2011,
          "final_score": 78.25
        }
      ]
    }
  ]
}
```