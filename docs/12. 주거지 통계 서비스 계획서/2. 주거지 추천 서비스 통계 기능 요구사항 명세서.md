# 주거지 추천 서비스 통계 기능 요구사항 명세서

## 문서 정보
- **버전**: 1.0
- **작성일**: 2025년 10월 6일
- **문서 유형**: 기능 요구사항 명세서

---

## 1단계: 서울 부동산 대시보드 (보편적 통계)

### [STAT-01] 대시보드 기본 UI/UX
**기능 ID**: FE-STAT-01

**목표**: 사용자가 서울 전체 지역구의 핵심 특징을 한눈에 비교하고 탐색의 기준점을 설정할 수 있도록 지원

**UI/UX 명세**:
- **위치**: 서비스 메인 화면의 Kakao Map 우측 상단 영역에 배치
- **동작**: '서울 부동산 대시보드' 버튼 클릭 시 지도 위에 오버레이 패널 형태로 표시. 버튼 재클릭 시 패널 토글

---

### [STAT-02] 전세/월세 데이터 동적 전환
**기능 ID**: FE-STAT-02

**목표**: 사용자가 임대 유형(전세/월세)에 따라 정확한 시세 정보를 확인할 수 있도록 지원

**UI/UX 명세**:
- 대시보드 패널 상단에 [전세 | 월세] 토글 버튼 추가

**데이터 처리 요구사항**:
- **전세 선택 시**: 대시보드 내 모든 가격 관련 지표는 '평균 전세가'를 기준으로 계산 및 표시
- **월세 선택 시**: 대시보드 내 모든 가격 관련 지표는 '평균 환산보증금'을 기준으로 재계산하여 표시

---

### [STAT-03] 지역구 비교 테이블 (수정)
**기능 ID**: FE-STAT-03

**목표**: 서울시 25개 자치구의 핵심 데이터를 정량적으로 비교하여 사용자의 초기 탐색 지원

**UI/UX 명세**:
- 테이블의 각 컬럼 헤더(통계 지표)를 클릭하면 오름차순/내림차순 정렬 기능 제공

**표시될 통계 지표**:

#### 전세 모드
| 컬럼명 | 설명 |
|--------|------|
| 지역구 | 자치구 이름 (예: 강남구) |
| 평균 전세가 | 지역구별 평균 전세 시세 |
| 안전 점수 | 기존 정의된 지역구별 안전성 점수 (0~100점) |
| 매물 공급량 | Redis에 저장된 해당 지역구의 유효 매물 총 개수 |
| 가격 대비 안전성 | [STAT-04]의 공식에 따라 계산된 '가성비' 점수 |
| 최근 5개월 가격 변동률 | 전월 데이터와 비교한 가격 변동률 (예: +1.2% ▲) |

#### 월세 모드 (수정사항)
| 컬럼명 | 설명 |
|--------|------|
| 지역구 | 자치구 이름 (예: 강남구) |
| 평균 보증금 | 지역구별 평균 보증금 |
| 평균 월세금 | 지역구별 평균 월세금 |
| 안전 점수 | 기존 정의된 지역구별 안전성 점수 (0~100점) |
| 매물 공급량 | Redis에 저장된 해당 지역구의 유효 매물 총 개수 |
| 가격 대비 안전성 | [STAT-04]의 공식에 따라 계산된 '가성비' 점수 |
| 최근 5개월 가격 변동률 | 전월 데이터와 비교한 가격 변동률 |

**테이블 UI/UX 예시 (월세 선택 시)**:
```
지역구 ▼ | 평균 보증금 ▼ | 평균 월세금 ▼ | 안전 점수 ▼ | 매물 공급량 ▼ | 가격 대비 안전성 ▼ | 최근 변동률 ▼
강남구   | 2억 5천       | 250만        | 85점        | 1,250건      | ...              | ...
관악구   | 8천          | 80만         | 72점        | 890건        | ...              | ...
```

---

### [STAT-04] '가격 대비 안전성' 점수 계산 로직 (수정)
**기능 ID**: BE-STAT-01

**목표**: 가격과 안전이라는 두 가지 핵심 요소를 균형 있게 평가하는 유의미한 종합 지표 생성

**계산 프로세스**:

#### 전세 모드
1. **가격 점수 변환**:
   - 서울시 25개구의 평균 전세가 중 최고값과 최저값을 기준으로 각 지역구의 상대적 가격 수준을 0~100점 척도로 변환
   - 공식: `가격 점수 = 100 - ((현재구 평균가 - 최저가구 평균가) / (최고가구 평균가 - 최저가구 평균가)) × 100`

2. **최종 점수 계산**:
   - 공식: `가격 대비 안전성 점수 = (안전 점수 × 0.5) + (가격 점수 × 0.5)`

#### 월세 모드 (수정사항)
1. **보증금 점수 계산**:
   - 서울시 25개구의 평균 보증금을 기준으로 0~100점 척도로 변환

2. **월세금 점수 계산**:
   - 서울시 25개구의 평균 월세금을 기준으로 0~100점 척도로 변환

3. **최종 가격 점수 산출**:
   - 공식: `최종 가격 점수 = (보증금 점수 × 0.5) + (월세금 점수 × 0.5)`

4. **가격 대비 안전성 점수 계산**:
   - 공식: `가격 대비 안전성 점수 = (안전 점수 × 0.5) + (최종 가격 점수 × 0.5)`

---

### [STAT-05] 지도 연동 및 미니 정보창 (수정)
**기능 ID**: FE-STAT-04

**목표**: 테이블의 텍스트 정보와 지도의 시각적 정보를 연결하여 사용자의 지역 이해도 향상

**동작 명세**:
1. 사용자가 대시보드 테이블의 특정 지역구 행(Row)을 클릭
2. 지도에서 해당 지역구의 경계가 하이라이트 처리
3. 동시에 하이라이트된 지역구 위에 미니 정보창 표시

**미니 정보창 표시 내용**:

#### 전세 모드
- **타이틀**: 지역구 이름 + (가격 대비 안전성 순위)
  - 예: 관악구 (가성비 4위)
- **핵심 지표 요약**:
  - 평균 전세가
  - 안전 점수
  - 매물 수
  - 가격 대비 안전성 점수

#### 월세 모드 (수정사항)
- **타이틀**: 지역구 이름 + (가격 대비 안전성 순위)
- **핵심 지표 요약**:
  - 평균 보증금
  - 평균 월세금
  - 안전 점수
  - 매물 수
  - 가격 대비 안전성 점수

---

### [STAT-06] 지역구 상세 프로파일링 (드릴 다운)
**기능 ID**: FE-STAT-05

**목표**: 사용자가 거시적 통계를 넘어, 특정 지역구의 질적 특성을 파악하고 검색 여부를 최종 결정할 수 있도록 심층 정보 제공

**UI/UX 명세**:
- **진입점**: 대시보드 테이블의 각 지역구 행 끝에 [📊 상세 분석 보기] 버튼 추가
- **표시 방식**: 버튼 클릭 시, 해당 지역구의 상세 프로파일링 정보가 담긴 모달(Modal) 창이 화면 중앙에 표시

**모달 표시 내용 (표 형태)**:
- **시세 수준**: (예: 저렴, 평균, 높음) + 서울시 내 상대적 위치 (하위 20% 등)
- **안전 수준**: (예: 평균, 우수) + 서울시 내 상대적 위치
- **매물 다양성**: (예: 매우 풍부) + 총 매물 수
- **가격 경쟁력**: "이 지역 매물의 **XX%**가 가격 경쟁력 상위 등급에 속합니다." 형태의 분석 결과
- **공간 만족도**: 주력 매물 평수 분석 (예: **'중소형 평수'(20평 미만) 매물이 XX%**를 차지)

---

## 2단계: 지역구 선택 옵션 추가 (검색 기능 확장)

### [STAT-07] 검색 패널 내 지역구 수동 선택
**기능 ID**: FE-SEARCH-01

**목표**: 특정 지역을 이미 염두에 둔 사용자가 직접 검색 범위를 한정할 수 있는 기본 필터링 기능 제공

**UI/UX 명세**:
- 기존 검색 조건 설정 패널에 '지역구 선택' 드롭다운 메뉴 추가
- 드롭다운의 기본값은 '서울 전체'로 설정하여 기존 검색 경험 유지

**기능 요구사항**:
- 드롭다운에서 특정 지역구(예: 마포구)를 선택하고 검색을 실행하면, 추천 결과는 해당 지역구 내의 매물로만 한정

---

### [STAT-08] 대시보드 연동을 통한 지역구 자동 선택
**기능 ID**: FE-STAT-06

**목표**: 대시보드에서 얻은 탐색적 인사이트를 실제 검색 행동으로 매끄럽게 연결

**UI/UX 명세**:
- '지역구 상세 프로파일링' 모달([STAT-06]) 내에 [🔍 이 지역으로 검색 범위 한정하기] 버튼 추가

**동작 명세**:
1. 사용자가 해당 버튼을 클릭하면 모달 창이 닫힘
2. 동시에 검색 패널의 '지역구 선택' 드롭다운([STAT-07]) 값이 해당 지역구로 자동 변경 및 선택

---

## 3단계: 맞춤형 분석 정보 기능 (개인화 통계)

### Part 1: 개인화 추천 리포트 (상대적 위치 분석)

#### [STAT-09] 지역구 단위 상대적 위치 분석
**기능 ID**: FE-RESULT-01

**목표**: 추천된 지역구가 서울 전체에서 어느 수준인지 객관적, 상대적 위치 정보를 제공하여 추천 결과의 가치를 명확히 인지

**UI/UX 명세**:
- 추천 결과 페이지의 각 지역구 카드에 [📊 상대적 위치 분석 보기] 버튼 추가
- 버튼 클릭 시 해당 지역구의 상세 분석 모달 표시

**모달 표시 내용**:
각 항목별 분석 (시세, 안전, 매물 공급량 각각):
- **절대값 및 순위**: (예: 평균 전세가: 3억 2천만원 (전체 21위, 하위 20%))
- **인접 순위 비교**: (예: 강북구(20위), 관악구(21위), 구로구(22위))
- **양극단 비교**: (예: 1위 강남구(8억 5천) | 25위 도봉구(2억 8천))

---

#### [STAT-10] 매물 단위 상대적 위치 분석
**기능 ID**: FE-RESULT-02

**목표**: 특정 매물이 추천된 다른 매물들과 비교하여 어느 수준인지 상세 정보를 제공하여 사용자의 최종 의사결정 지원

**UI/UX 명세**:
- 매물 상세 정보 모달 내에 [📊 상대적 위치 분석 보기] 버튼(또는 확장 가능한 섹션) 추가

**모달 표시 내용**:
- **분석 범위**: 추천된 동일 '지역구' 내 모든 매물을 기준으로 분석

각 항목별 분석 (가격, 공간, 최종 점수 각각):
- **절대값 및 순위**: (예: 전세가: 3억 5천만원 (전체 267위, 상위 30%))
- **인접 순위 비교**: (예: B오피스텔(3억 4.5천), A빌라(3억 5천), C다세대(3억 5.5천))
- **양극단 비교**: (예: 최고가 매물(5억 2천) | 최저가 매물(2억 1천))
- **종합 분석**: (예: 이 매물은 추천 매물 중 가격, 공간, 우선순위 부합도 모든 면에서 최상위권입니다.)

---

### Part 2: 대안 탐색 (새로운 발견)

#### [STAT-11] 유사 지역 찾기
**기능 ID**: BE-STAT-02, FE-RESULT-03

**목표**: 사용자가 만족한 추천 지역구와 통계적 프로필이 유사한 다른 대안 지역구를 제시하여 탐색 범위를 합리적으로 확장

**UI/UX 명세**:
- '지역구 단위 상대적 위치 분석' 모달([STAT-09]) 하단에 [📊 '관악구'와 비슷한 지역 찾기] 버튼 추가
- 클릭 시 '요약 + 상세' 구조의 분석 결과 모달 표시
- 초기에는 종합 유사도 점수만 보이고, '상세 비교 보기'를 누르면 상세 테이블이 펼쳐짐

**유사도 판단 로직 (Backend)**:
- **기준**: 각 지역구의 핵심 지표(가격 점수, 안전 점수, 공급량 점수 등) 벡터 간 코사인 유사도 측정
- **조건**: 코사인 유사도 점수가 0.90 이상인 지역 중 상위 2~3곳 선정

**표시 내용**:
- **요약**: 1. 구로구 (종합 유사도: 85%)
- **상세**: 원본 지역구와 비교 지역구의 개별 분석 항목(가격 점수, 안전 점수 등)을 나란히 비교하는 테이블과 간단한 텍스트 분석

---

#### [STAT-12] 유사 매물 찾기
**기능 ID**: BE-STAT-03, FE-RESULT-04

**목표**: 사용자가 마음에 들어하는 특정 매물과 조건이 유사한 다른 매물을 제시하여 예비 선택지 확보 지원

**UI/UX 명세**:
- '매물 단위 상대적 위치 분석' 모달([STAT-10]) 하단에 [🔍 'A빌라'와 비슷한 매물 찾기] 버튼 추가
- 클릭 시 '요약 + 상세' 구조의 유사 매물 목록 표시

**유사도 판단 로직 (Backend)**:
- **검색 범위**: 원본 매물과 동일한 '지역구' 내로 한정
- **필터링 규칙**:
  - 원본 매물과 동일 '읍/면/동'에 위치
  - 가격이 원본 매물의 ±15% 범위 내
  - 평수가 원본 매물의 ±15% 범위 내

**표시 내용**:
- **요약**: 1. B오피스텔 (종합 유사도: 92%)
- **상세**: 원본 매물과 비교 매물의 핵심 조건(가격, 평수, '동' 위치)을 비교하는 테이블