# Redis Pipeline 미적용 구간 Phase 1 (Before) 성능 측정 분석 보고서

## 문서 정보

| 항목 | 내용 |
|------|------|
| 보고서 목적 | `findValidMonthlyPropertiesInDistrict()` 메서드의 순차 Redis 호출 구조에 대한 Before 성능 실측 및 병목 정량 분석 |
| 대상 병목 | 2.3.1 Redis Pipeline 미적용 구간 (RTT 낭비) |
| 측정 일시 | 2026-02-12 15:49:06 ~ 15:49:12 |
| 작성 버전 | v1.0 (Phase 1 Before 단독) |
| 관련 계획서 | `Redis_Pipeline_미적용_구간_병목_해결_계획서_v2.md` |

---

## 1. 측정 환경

### 1.1 하드웨어 및 네트워크 구성

| 구성 요소 | 사양 |
|-----------|------|
| 클라이언트 | 172.20.10.2 (로컬 개발 머신) |
| Redis 서버 | 61.75.54.208:6379 (원격 서버) |
| 네트워크 경로 | 클라이언트 → 인터넷 → 원격 Redis 서버 (loopback이 아닌 실제 원격 구간) |

### 1.2 소프트웨어 구성

| 항목 | 값 |
|------|-----|
| JDK | Java 17 |
| Framework | Spring Boot 3.x, Spring Data Redis (Lettuce 기반) |
| Redis Client | Lettuce (Netty 기반 비동기 드라이버, 동기 API 사용) |
| 실행 스레드 | `http-nio-8185-exec-1` (단일 스레드, 순차 처리) |

### 1.3 측정 도구

| 계층 | 도구 | 정밀도 | 측정 대상 |
|------|------|--------|-----------|
| Layer 1 (애플리케이션) | `System.nanoTime()` | 나노초 | Command Latency, Method Time, I/O 비율 |
| Layer 2 (네트워크) | Wireshark (pcapng) | 나노초 | TCP 패킷 타임스탬프 기반 Req-Resp Latency, Total Transfer |

### 1.4 테스트 요청 조건

| 항목 | 값 | 설계 의도 |
|------|-----|-----------|
| 임대료 형태 | 월세 | — |
| 보증금 범위 | 500 ~ 10,000 만원 | 넓은 범위로 25개 지역구 전체 순회 보장 |
| 월세 범위 | 10 ~ 150 만원 | 동일 |
| 평수 범위 | 10.0 ~ 60.0 평 | 동일 |
| 우선순위 | 1순위 PRICE(60%), 2순위 SAFETY(30%), 3순위 SPACE(10%) | — |
| 예산 유연성 | 0% | 폴백(S-03) 미발생 보장 |
| 최소 안전 점수 | 0점 | 안전 점수 필터링 비활성화 |
| 절대 최소 평수 | 0평 | 제한 없음 |

이 조건은 `performMonthlyStrictSearch()`의 단일 호출에서 25개 지역구 모두에서 3개 ZRANGEBYSCORE Command가 실행되도록 설계한 것이다. 실측 결과 25개 지역구 전체에서 `status=SUCCESS`(Early Return 0건)로 확인되었으므로, 75개 Command 전체에 대한 완전한 측정 데이터셋이 확보되었다.

---

## 2. 측정 대상 코드 구조

### 2.1 측정 대상 메서드

`MonthlyRecommendationService.findValidMonthlyPropertiesInDistrict(String district, MonthlyRecommendationRequestDto request)`

이 메서드는 단일 지역구에 대해 3개의 Redis Sorted Set(ZSet)에 대한 `ZRANGEBYSCORE` 조회를 순차적 동기 호출로 실행한 뒤, Java 측에서 교집합을 계산한다.

```java
// Command #1: 보증금 범위 검색
Set<Object> depositValidObjects = redisHandler.redisTemplate.opsForZSet()
        .rangeByScore("idx:deposit:" + district, budgetMin, budgetMax);
// → 응답 수신 완료 후 Early Termination 체크

// Command #2: 월세금 범위 검색
Set<Object> monthlyRentValidObjects = redisHandler.redisTemplate.opsForZSet()
        .rangeByScore("idx:monthlyRent:" + district + ":월세", monthlyRentMin, monthlyRentMax);
// → 응답 수신 완료 후 Early Termination 체크

// Command #3: 평수 범위 검색
Set<Object> areaValidObjects = redisHandler.redisTemplate.opsForZSet()
        .rangeByScore("idx:area:" + district + ":월세", areaMin, areaMax);
// → 응답 수신 완료 후

// Java 측 교집합: retainAll() × 2
```

### 2.2 호출 컨텍스트

`performMonthlyStrictSearch()` 내부에서 서울시 25개 자치구를 `for` 루프로 순차 순회하며, 각 지역구마다 위 메서드를 1회 호출한다. 전체 루프에서 발생하는 Redis 왕복 횟수는 `25 지역구 × 3 Command = 75회`이다.

### 2.3 측정 계측 방식

각 Command 호출 전후로 `System.nanoTime()`을 측정하여 개별 Command Latency(cmd1, cmd2, cmd3)를 산출하고, 메서드 진입~종료 구간의 Method Time, 그리고 `(총 Command Latency / Method Time) × 100`으로 I/O 비율을 산출한다. 로그 포맷은 `[Metrics-Sequential]` 태그로 출력된다.

---

## 3. Layer 1 측정 결과 (애플리케이션 레벨: Command Latency)

### 3.1 전체 루프 요약

| 지표 | 값 |
|------|---:|
| 대상 지역구 수 | 25개 |
| 3개 Command 모두 실행된 지역구 (SUCCESS) | 25개 (100%) |
| 조기종료 (Early Return) | 0건 |
| 검색된 총 매물 ID 수 (교집합 합계) | 13,942건 |
| 루프 총 소요 시간 | 6,540.59 ms |
| 지역구 평균 소요 시간 | 261.62 ms |

### 3.2 지역구별 상세 데이터 (원본)

아래 표는 `[Metrics-Sequential]` 로그에서 추출한 25개 지역구 전체의 측정 원본이다. MethodTime 내림차순 정렬.

| # | 지역구 | MethodTime (ms) | 총CmdLatency (ms) | I/O비율 (%) | NonIO (ms) | Cmd1 (ms) | Cmd1건수 | Cmd2 (ms) | Cmd2건수 | Cmd3 (ms) | Cmd3건수 | 교집합 |
|---|--------|----------------:|-------------------:|------------:|----------:|----------:|---------:|----------:|---------:|----------:|---------:|-------:|
| 1 | **강남구** | **3,428.54** | **3,413.32** | **99.56** | **15.23** | **466.41** | **16,008** | **1,203.89** | **36,251** | **1,743.02** | **51,211** | **11,287** |
| 2 | 중구 | 160.37 | 160.08 | 99.82 | 0.29 | 42.65 | 160 | 60.26 | 166 | 57.17 | 168 | 18 |
| 3 | 강북구 | 154.05 | 153.87 | 99.88 | 0.18 | 36.06 | 122 | 79.16 | 143 | 38.64 | 104 | 40 |
| 4 | 종로구 | 151.69 | 150.68 | 99.33 | 1.01 | 57.49 | 91 | 47.93 | 139 | 45.26 | 128 | 12 |
| 5 | 서초구 | 136.16 | 135.87 | 99.79 | 0.28 | 37.35 | 219 | 51.23 | 423 | 47.30 | 801 | 97 |
| 6 | 서대문구 | 135.39 | 135.17 | 99.84 | 0.22 | 39.48 | 194 | 37.82 | 293 | 57.88 | 325 | 70 |
| 7 | 송파구 | 134.37 | 133.96 | 99.70 | 0.41 | 47.91 | 367 | 40.86 | 638 | 45.19 | 973 | 194 |
| 8 | 도봉구 | 132.29 | 132.06 | 99.82 | 0.23 | 43.72 | 214 | 48.09 | 286 | 40.24 | 264 | 182 |
| 9 | 용산구 | 131.09 | 130.79 | 99.77 | 0.30 | 40.40 | 134 | 48.88 | 174 | 41.51 | 265 | 29 |
| 10 | 강서구 | 130.31 | 129.94 | 99.72 | 0.36 | 45.29 | 434 | 42.74 | 656 | 41.92 | 599 | 291 |
| 11 | 성동구 | 129.86 | 129.32 | 99.58 | 0.54 | 38.56 | 190 | 43.61 | 293 | 47.15 | 494 | 24 |
| 12 | 은평구 | 127.56 | 127.25 | 99.76 | 0.31 | 35.47 | 240 | 50.47 | 362 | 41.31 | 309 | 95 |
| 13 | 구로구 | 126.51 | 126.21 | 99.76 | 0.30 | 44.14 | 289 | 42.62 | 469 | 39.44 | 388 | 163 |
| 14 | 영등포구 | 126.21 | 125.92 | 99.77 | 0.29 | 40.36 | 223 | 43.55 | 406 | 42.01 | 405 | 70 |
| 15 | 마포구 | 125.77 | 125.30 | 99.62 | 0.48 | 41.92 | 319 | 42.08 | 422 | 41.30 | 600 | 117 |
| 16 | 노원구 | 124.98 | 124.50 | 99.62 | 0.48 | 43.81 | 623 | 39.40 | 816 | 41.29 | 752 | 496 |
| 17 | 강동구 | 124.05 | 123.49 | 99.55 | 0.56 | 41.88 | 354 | 42.10 | 648 | 39.50 | 662 | 172 |
| 18 | 동대문구 | 122.59 | 122.31 | 99.78 | 0.27 | 43.41 | 295 | 38.10 | 404 | 40.81 | 342 | 80 |
| 19 | 동작구 | 121.05 | 120.78 | 99.77 | 0.27 | 32.69 | 178 | 46.73 | 322 | 41.36 | 346 | 41 |
| 20 | 중랑구 | 120.77 | 120.22 | 99.54 | 0.55 | 39.37 | 255 | 42.28 | 434 | 38.57 | 295 | 132 |
| 21 | 성북구 | 117.86 | 117.64 | 99.81 | 0.22 | 32.51 | 224 | 46.33 | 347 | 38.79 | 372 | 97 |
| 22 | 양천구 | 117.39 | 117.04 | 99.70 | 0.35 | 31.86 | 179 | 46.28 | 393 | 38.90 | 489 | 123 |
| 23 | 광진구 | 116.47 | 116.19 | 99.76 | 0.28 | 37.12 | 97 | 42.51 | 223 | 36.57 | 228 | 10 |
| 24 | 금천구 | 114.68 | 114.54 | 99.87 | 0.15 | 36.53 | 95 | 38.26 | 181 | 39.74 | 113 | 35 |
| 25 | 관악구 | 113.43 | 113.14 | 99.75 | 0.29 | 34.24 | 200 | 43.96 | 290 | 34.93 | 229 | 67 |

### 3.3 통계 요약

#### 전체 25개 지역구

| 지표 | 값 |
|------|---:|
| 총 Command Latency (합계) | 6,499.58 ms |
| 평균 MethodTime (지역구당) | 260.94 ms |
| 평균 총 CmdLatency (지역구당) | 259.98 ms |
| 평균 I/O 비율 | 99.71% |
| 총 RTT 발생 횟수 | 75회 |

#### 강남구 제외 24개 지역구

| 지표 | 값 |
|------|---:|
| 평균 MethodTime | 128.95 ms |
| 중앙값 MethodTime | 126.36 ms |
| 최소 MethodTime | 113.43 ms (관악구) |
| 최대 MethodTime | 160.37 ms (중구) |
| 표준편차 | 12.10 ms |
| 평균 I/O 비율 | 99.72% |

#### Command별 Latency 통계 (강남구 제외 24개 지역구)

| Command | 대상 Key 패턴 | 평균 (ms) | 중앙값 (ms) | 최소 (ms) | 최대 (ms) |
|---------|--------------|----------:|----------:|----------:|----------:|
| Cmd1 (보증금) | `idx:deposit:{district}` | 40.18 | 39.92 | 31.86 | 57.49 |
| Cmd2 (월세) | `idx:monthlyRent:{district}:월세` | 46.05 | 43.58 | 37.82 | 79.16 |
| Cmd3 (평수) | `idx:area:{district}:월세` | 42.37 | 41.30 | 34.93 | 57.88 |

#### NonIO 시간 통계 (강남구 제외 24개 지역구)

| 지표 | 값 |
|------|---:|
| 평균 | 0.36 ms |
| 최소 | 0.15 ms |
| 최대 | 1.01 ms |

NonIO 시간은 Java 측 `retainAll()` 교집합 연산, `Stream.map(Object::toString)`, `Collectors.toSet()` 등의 처리 비용이다. 전체 MethodTime(113–160ms) 대비 0.1–0.8% 수준이므로 무시할 수 있다.

### 3.4 강남구 이상치 분석

강남구 MethodTime(3,428.54ms)은 나머지 24개 지역구 평균(128.95ms)의 약 26.6배다.

| 지역구 | Cmd1 반환건수 | Cmd2 반환건수 | Cmd3 반환건수 | 총 반환건수 | MethodTime (ms) |
|--------|------------:|------------:|------------:|-----------:|---------------:|
| 강남구 | 16,008 | 36,251 | 51,211 | 103,470 | 3,428.54 |
| 노원구 (최대 반환건수 2위) | 623 | 816 | 752 | 2,191 | 124.98 |
| 관악구 (최소 MethodTime) | 200 | 290 | 229 | 719 | 113.43 |

강남구의 ZSet 반환 건수는 노원구의 약 47.2배이다. `ZRANGEBYSCORE` 명령의 응답을 RESP 프로토콜로 직렬화하여 네트워크 전송하고, 역직렬화하여 `Set<Object>`로 변환하는 전 과정에서 데이터 건수에 비례하는 비용이 발생한다. 강남구의 높은 Latency는 RTT 횟수 문제가 아니라 단일 Command의 payload 크기 문제이며, Pipeline은 RTT 횟수를 줄이는 기법이므로 강남구에 대한 개선 효과는 제한적이다.

이후 모든 통계에서 전체 25개 지역구 통계와 강남구 제외 24개 지역구 통계를 병기한다.

---

## 4. Layer 2 측정 결과 (네트워크 레벨: Wireshark 패킷 분석)

### 4.1 측정 목적

Layer 1의 Command Latency는 `System.nanoTime()` 기반 값으로, 순수 네트워크 왕복 시간(RTT) 외에 Resp 직렬화/역직렬화 비용이 혼재되어 있다. Pipeline이 제거하는 것은 네트워크 왕복 횟수이므로, Command Latency 내에서 순수 네트워크 왕복이 차지하는 비중을 분리해야 Pipeline 적용 효과를 정확하게 예측할 수 있다.

Layer 2에서는 Wireshark로 TCP 패킷 송수신 타임스탬프를 캡처하여, Java 런타임 오버헤드가 포함되지 않은 순수 네트워크 계층 시간 데이터를 확보한다.

### 4.2 캡처 환경

| 항목 | 값 |
|------|-----|
| 캡처 도구 | Wireshark (pcapng) |
| 캡처 지점 | 클라이언트 측 네트워크 인터페이스 |
| 캡처 필터 | `tcp.port == 6379 && tcp.len > 0` (데이터 패킷만, ACK-only 제외) |
| 클라이언트 | 172.20.10.2:51680 |
| Redis 서버 | 61.75.54.208:6379 |

### 4.3 캡처 패킷 통계

| 항목 | 값 |
|------|---:|
| 총 데이터 패킷 | 4,027개 |
| ZRANGEBYSCORE 요청 패킷 | 75개 (25 지역구 × 3 Command) |
| 응답 패킷 (ZRANGEBYSCORE 응답에 매핑) | 3,852개 |
| 총 응답 바이트 | 5,238,203 bytes (약 5.0 MB) |
| 미매핑 패킷 (heartbeat/PING 등) | 50개 (측정 대상 외) |

### 4.4 측정 지표 정의

Layer 2에서 산출하는 3개 시간 지표:

**Req-Resp Latency**: ZRANGEBYSCORE 요청 패킷 전송 시점 ~ 첫 번째 응답 패킷 도착 시점. 네트워크 편도 전파(Client→Server) + Redis 서버 Command 처리 + 네트워크 편도 전파(Server→Client)를 포함한다. 응답 데이터 크기와 무관하게 거의 일정한 값을 보인다.

**Total Transfer**: 요청 패킷 전송 시점 ~ 해당 Command 응답의 마지막 TCP 세그먼트 도착 시점. 응답이 TCP MTU(약 1,460 bytes)를 초과하면 여러 세그먼트로 분할 전송되기 때문에 모든 세그먼트 수신 완료 시점 또한 기록 하였다.

**첫 응답~마지막 응답 도착 간격**: `Total Transfer - Req-Resp Latency`. TCP 분할 패킷의 물리적 전송 시간이다.

세 지표 간 관계: `Total Transfer = Req-Resp Latency + 첫 응답~마지막 응답 도착 간격`

Pipeline이 절감하는 비용은 **Req-Resp Latency**이다. 3개 Command를 Pipeline으로 묶으면 Req-Resp Latency가 3회분에서 1회분으로 감소한다. 첫 응답~마지막 응답 도착 간격은 동일한 데이터를 수신하는 것이므로 Pipeline 적용 여부와 무관하다.

### 4.5 Req-Resp Latency 통계

75개 ZRANGEBYSCORE Command의 Req-Resp Latency 대표값:

| 지표 | 전체 75개 Command | 강남구 제외 72개 Command |
|------|------------------:|------------------------:|
| 평균 | 38.492 ms | 38.518 ms |
| 중앙값 | 37.237 ms | 37.157 ms |
| 최소 | 30.368 ms | 30.368 ms |
| 최대 | 78.542 ms | 78.542 ms |

#### Command 유형별 Req-Resp Latency 대표값 (강남구 제외 72개 → 24개 지역구 × 3 유형)

| Command | 평균 (ms) |
|---------|----------:|
| Cmd1 (보증금) | 36.905 |
| Cmd2 (월세) | 41.068 |
| Cmd3 (평수) | 37.579 |

3개 Command 간 Req-Resp Latency 차이는 최대 4.2ms이다. Layer 1에서 관측된 Cmd2 Latency가 다소 높은 현상(평균 46.05ms)은 네트워크 왕복 시간 차이(4.2ms)보다 역직렬화 처리 시간 차이에 기인한 것으로 판단된다.

### 4.6 강남구 전송 시간 상세

| Command | Req-Resp Latency (ms) | Total Transfer (ms) | 도착 간격 (ms) | 응답 패킷 수 | 응답 바이트 |
|---------|---------------------:|-------------------:|--------------:|------------:|----------:|
| Cmd1 (보증금) | 35.215 | 451.844 | 416.629 | 481 | 656,336 |
| Cmd2 (월세) | 37.242 | 1,179.239 | 1,141.997 | 1,084 | 1,486,299 |
| Cmd3 (평수) | 41.176 | 1,698.979 | 1,657.803 | 1,533 | 2,099,864 |
| **합계** | **113.633** | **3,330.062** | **3,216.429** | **3,098** | **4,242,499** |

강남구 Total Transfer 합계(3,330ms) 중 96.6%인 3,216ms가 응답 패킷의 물리적 도착 시간이다. Cmd3의 응답 2.0MB가 1,533개 TCP 세그먼트로 분할 전송되었으며, 이 패킷 도착에 1,658ms가 소요되었다. 이는 RTT와 별개로 대역폭과 TCP 흐름 제어에 의해 결정되는 비용이다.

---

### 4.7 Req-Resp Latency 원본 패킷 샘플 (Packet_Dump 근거)

4.5절의 통계 대표값(평균, 중앙값, 최소, 최대)이 도출된 근거를 제시하기 위해, `Wireshark_Analysis_Phase1_Before.xlsx`의 `Packet_Dump` 시트에서 75개 ZRANGEBYSCORE Command의 Req-Resp Latency를 백분위 기준으로 20개 샘플 추출하였다. 각 샘플은 실제 Wireshark 캡처의 Frame 번호, 타임스탬프, TCP Payload 크기를 포함하며, 원본 pcapng 파일에서 추적 가능하다.

#### Req-Resp Latency 백분위별 대표 패킷 (20개)

| # | 백분위 | 지역구/Command | Req Frame# | Req Time(s) | Req Payload(B) | Resp Frame# | Resp Time(s) | Resp Payload(B) | Req-Resp Latency(ms) |
|---|--------|---------------|------------|-------------|----------------|-------------|--------------|-----------------|---------------------:|
| 1 | P0% (최소) | 은평구/Cmd1 | 481 | 7.377033 | 76 | 482 | 7.407401 | 1,390 | 30.368 |
| 2 | P5% | 동작구/Cmd1 | 888 | 8.385748 | 76 | 889 | 8.417464 | 1,390 | 31.716 |
| 3 | P10% | 서대문구/Cmd2 | 537 | 7.544679 | 86 | 538 | 7.577558 | 1,390 | 32.879 |
| 4 | P15% | 양천구/Cmd3 | 660 | 7.846103 | 76 | 661 | 7.879567 | 1,390 | 33.464 |
| 5 | P20% | 관악구/Cmd3 | 955 | 8.585769 | 76 | 956 | 8.619643 | 1,390 | 33.874 |
| 6 | P25% (Q1) | 노원구/Cmd3 | 446 | 7.334931 | 76 | 447 | 7.369669 | 1,390 | 34.738 |
| 7 | P30% | 동작구/Cmd3 | 914 | 8.465450 | 76 | 915 | 8.500538 | 1,390 | 35.088 |
| 8 | P35% | 중랑구/Cmd2 | 240 | 6.763869 | 83 | 241 | 6.799655 | 1,390 | 35.786 |
| 9 | P40% | 은평구/Cmd3 | 511 | 7.463417 | 76 | 512 | 7.499680 | 1,390 | 36.263 |
| 10 | P45% | 마포구/Cmd2 | 583 | 7.683025 | 83 | 584 | 7.719620 | 1,390 | 36.595 |
| 11 | P50% (중앙값) | 광진구/Cmd2 | 155 | 6.520232 | 83 | 156 | 6.557469 | 1,390 | 37.237 |
| 12 | P55% | 성동구/Cmd2 | 113 | 6.390155 | 83 | 114 | 6.427551 | 1,390 | 37.396 |
| 13 | P60% | 영등포구/Cmd2 | 850 | 8.299280 | 86 | 851 | 8.337493 | 1,390 | 38.213 |
| 14 | P65% | 도봉구/Cmd1 | 341 | 7.118860 | 76 | 342 | 7.157425 | 1,390 | 38.565 |
| 15 | P70% | 금천구/Cmd3 | 832 | 8.218175 | 76 | 833 | 8.257300 | 1,390 | 39.125 |
| 16 | P75% (Q3) | 서초구/Cmd3 | 997 | 8.709568 | 76 | 998 | 8.749470 | 1,390 | 39.902 |
| 17 | P80% | 강동구/Cmd1 | 5774 | 12.321427 | 76 | 5775 | 12.361913 | 1,390 | 40.486 |
| 18 | P85% | 강남구/Cmd3 | 3383 | 10.432640 | 76 | 3384 | 10.473816 | 1,390 | 41.176 |
| 19 | P90% | 종로구/Cmd3 | 36 | 6.011772 | 76 | 37 | 6.055438 | 1,388 | 43.666 |
| 20 | P100% (최대) | 강북구/Cmd2 | 326 | 7.000258 | 83 | 327 | 7.078800 | 1,390 | 78.542 |

#### Req-Resp Latency 분포 히스토그램

| 구간 (ms) | Command 수 | 비율 |
|-----------|----------:|-----:|
| 30 ~ 32 | 6 | 8.0% |
| 32 ~ 34 | 9 | 12.0% |
| 34 ~ 36 | 13 | 17.3% |
| 36 ~ 38 | 16 | 21.3% |
| 38 ~ 40 | 12 | 16.0% |
| 40 ~ 42 | 8 | 10.7% |
| 42 ~ 44 | 3 | 4.0% |
| 44 ~ 50 | 4 | 5.3% |
| 50 ~ 60 | 3 | 4.0% |
| 60 ~ 80 | 1 | 1.3% |

75개 Command 중 74.6%(56개)가 30–40ms 구간에 집중되어 있다. 40ms 이상은 전체의 25.3%이며, 50ms 이상의 고지연 패킷은 5.3%(4개)로 소수다.

#### 사분위수 및 이상치

| 지표 | 값 |
|------|---:|
| Q1 (25th percentile) | 34.738 ms |
| Q3 (75th percentile) | 40.111 ms |
| IQR (Q3 − Q1) | 5.373 ms |
| Lower Fence (Q1 − 1.5×IQR) | 26.679 ms |
| Upper Fence (Q3 + 1.5×IQR) | 48.170 ms |
| 이상치 (Upper Fence 초과) | 4개 |

Upper Fence(48.170ms)를 초과하는 이상치 4개: 52.924ms, 56.066ms, 59.197ms, 78.542ms. 최대값 78.542ms(강북구/Cmd2)는 중앙값 37.237ms의 2.1배이며, 네트워크 경로상의 일시적 지연(jitter)으로 판단된다. 이상치를 제외한 71개 Command의 Req-Resp Latency 범위는 30.368–44.242ms로, 변동 폭 13.9ms 이내에서 안정적으로 분포한다.


---

## 5. 분석 종합

### 5.1 I/O 바운드 확정

전 지역구에서 I/O 비율이 99.33% ~ 99.88%로 측정되었다. 계획서에서 정의한 "I/O 비율 80% 이상이면 Pipeline 개선 효과가 크다"의 기준을 모든 지역구가 초과한다. `findValidMonthlyPropertiesInDistrict()` 메서드는 전형적인 I/O 바운드 워크로드이다.

### 5.2 RTT 누적 구조 확인

강남구 제외 24개 지역구에서 3개 Command의 평균 개별 Latency 합계(40.18 + 46.05 + 42.37 = 128.60ms)와 평균 총 CmdLatency(128.59ms)가 일치한다. 명령 간 추가 오버헤드 없이 순수하게 3회의 순차 호출이 Latency를 누적시키는 구조이다.

### 5.3 Command Latency 균등 분포

3개 Command가 총 CmdLatency에서 차지하는 비중은 Cmd1 31.3%, Cmd2 35.8%, Cmd3 32.9%로 거의 균등하다. 특정 Command에 Latency가 편중되지 않으므로, 3개를 Pipeline으로 묶는 것이 구조적으로 타당하다.

### 5.4 강남구 특이성

강남구의 병목은 RTT 횟수가 아닌 응답 payload 크기(총 103,470건, 4.2MB)에 있다. Pipeline 적용 시 Req-Resp Latency 2회분(약 76ms)이 절감되지만, 이는 전체 MethodTime(3,428ms) 대비 2.2%에 불과하다. 강남구에 대한 근본적 해결은 payload 볼륨을 줄일 수 있는 알고리즘을 별도로 고민해야 한다.

---

## 부록 A. 용어 정의

| 용어 | 정의 |
|------|------|
| Command Latency | `rangeByScore()` 호출 시작~반환까지의 총 소요 시간. 직렬화, syscall, 네트워크, Redis 처리, 역직렬화 포함 |
| 총 Command Latency | 3개 Redis Command의 개별 Command Latency 합계 |
| I/O 비율 | `(총 Command Latency / Method Time) × 100`. I/O 바운드 정도를 나타내는 지표 |
| Req-Resp Latency | Wireshark 기준 요청 패킷 전송~첫 응답 패킷 도착 시간. 순수 네트워크 왕복 + Redis 서버 처리 시간 |
| Total Transfer | Wireshark 기준 요청 패킷 전송~마지막 응답 패킷 도착 시간 |
| NonIO 시간 | Method Time에서 총 Command Latency를 뺀 값. Java 측 교집합 연산 등의 비용 |

## 부록 B. 원본 데이터 출처

| 데이터 | 파일명 | 위치 |
|--------|--------|------|
| Layer 1 (애플리케이션 로그) | `Application_Log_Test_Phase1_result.xlsx` | 병목실측데이터/1차테스트/ |
| Layer 2 (Wireshark 캡처) | `Wireshark_Analysis_Phase1_Before.xlsx` | 병목실측데이터/1차테스트/ |
| 계획서 | `Redis_Pipeline_미적용_구간_병목_해결_계획서_v2.md` | 병목실측계획서/ |
| 측정 대상 소스코드 | `MonthlyRecommendationService.java` | wherehouse/src/main/java/com/wherehouse/recommand/service/ |