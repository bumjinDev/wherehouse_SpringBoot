# 주거지 추천 서비스 사용자 경험 반영 개선 기획서

## 프로젝트 개요

**목표**: 실거주자의 경험을 수집하여 추천 시스템의 정확도를 높이고, 대규모 리뷰 데이터 축적 상황에서도 실시간 추천 성능을 유지한다.

**핵심 질문**: "정량적 공공데이터만으로는 반영할 수 없는 실제 거주 경험을 어떻게 추천 시스템에 통합할 것인가?"

**접근 방식**: 매물별 리뷰 시스템을 구축하여 실거주자의 정성적 평가를 수집하고, 키워드 추출 및 점수화를 통해 기존 정량적 데이터와 통합한다.

---

## 현재 상태 분석

### 기존의 구체적 문제점

| 구현 부분 | 현재 로직 | 문제점 | 비즈니스 영향 |
|-----------|-----------|--------|---------------|
| **데이터 기반 추천** | 서울시 공공데이터(CCTV, 범죄통계, 교통, 인구밀도)만으로 지역구 추천 | 실제 거주 경험 데이터 부재 | 사용자가 체감하는 실제 거주 환경과 추천 결과의 괴리 발생 |
| **평가 항목** | 안전성, 교통, 편의시설 점수만 산출 | 소음, 채광, 이웃 등 정성적 요소 반영 불가 | 실거주 만족도에 영향을 주는 핵심 요소들이 추천에서 누락됨 |
| **점수 산출** | 정량적 데이터만으로 점수 계산 후 사용자 우선순위 가중치 반영 | 데이터와 실제 체감의 괴리 | 추천 시스템에 대한 신뢰도 저하 및 사용자 만족도 감소 |

### 기존의 기술적 한계점

**데이터 유형의 제한**
- 정량적 공공데이터만 활용 가능한 구조
- 비정형 텍스트 데이터 처리 기능 부재

**데이터 저장소의 구조적 한계**
- 국토부 실거래가 데이터를 Redis(In-Memory)에만 적재하여 데이터 휘발성 위험 존재
- 리뷰 데이터와 같은 복잡한 관계형 데이터의 참조 무결성 보장이 어려운 구조
- 조회 성능과 데이터 안정성을 동시에 확보하는 메커니즘 부재

**배치 처리 로직의 강결합**
- BatchScheduler 내에 데이터 수집 로직이 강하게 결합되어 있어 확장성 저해
- 새로운 저장소 적재 로직 추가 시 기존 배치 프로세스의 안정성을 저해할 위험 존재
- 관심사 분리 원칙이 적용되지 않은 구조

**피드백 루프 부재**
- 사용자의 실제 거주 경험이 시스템에 반영되지 않음
- 추천 결과에 대한 검증 및 개선 메커니즘 부재

**평가 차원의 단순성**
- 공공데이터로 측정 가능한 항목으로만 평가 제한
- 실거주자가 중요하게 생각하는 정성적 요소 배제

### 개선 목표

**1차 목표: 사용자 경험 데이터 수집 체계 구축**
- 매물별 리뷰 작성 기능 구현
- 별점(1~5점) 평가 시스템 구축
- 거주 기간 정보 수집

**2차 목표: 리뷰 데이터 기반 추천 정확도 향상**
- 리뷰 텍스트에서 키워드 자동 추출
- 키워드 기반 점수 산출 로직 개발
- 기존 공공데이터 점수와 리뷰 점수 통합

**3차 목표: 시스템 아키텍처 고도화**
- 하이브리드 데이터 저장소 전략 적용 (Redis + RDB)
- 이벤트 기반 파이프라인 구축으로 배치 로직 유연성 확보
- 대용량 데이터 환경에서의 성능 최적화 및 동시성 제어

---

## 새로운 비즈니스 로직 설계

### 리뷰 기반 추천 점수 통합 상세 설명

**단계 1: 리뷰 데이터 수집**
매물에 대한 실거주자의 별점 평가(1~5점), 자유 형식의 텍스트 리뷰, 거주 기간 정보를 수집한다.

**결과 판단 기준**: 매물당 리뷰 5개 이상 축적 여부

**성공 케이스 처리 (리뷰 5개 이상)**
리뷰 점수를 산출하여 기존 점수와 통합한다. 최종 점수 = (기존 점수 × 50%) + (리뷰 점수 × 50%)

**실패 케이스 처리 (리뷰 5개 미만)**
소수 리뷰로 인한 편향을 방지하기 위해 리뷰 점수를 추천에 반영하지 않고 기존 점수를 그대로 사용한다.

**단계 2: 키워드 추출 및 점수화**
리뷰 텍스트에서 교통, 소음, 채광, 편의시설 관련 키워드를 추출하여 긍정 키워드는 +1점, 부정 키워드는 -1점으로 점수화한다.

**결과 판단 기준**: 추출된 키워드가 사전에 정의된 '평가 대상 키워드 셋(Traffic, Noise 등)'에 포함되는지 유효성을 검증하고, 유효 키워드가 1개 이상 포함된 경우에만 점수화 로직을 수행한다.

**단계 3: 추천 점수 통합**
기존 검색 및 필터링 로직(예산, 평수, 지역 조건에 따른 1차 검색 및 2단계 폴백 검색)은 그대로 유지한다. 필터링이 완료된 최종 후보 매물에 대해서만 점수 산출 방식을 변경한다.

- AS-IS: `최종점수 = (가격점수 + 평수점수 + 안전점수)`
- TO-BE: `최종점수 = (기존 로직 결과 × 50%) + (리뷰 점수 × 50%)`

리뷰 점수 = (평균 별점 / 5) × 100 공식으로 산출한 점수를 기존 공공데이터 기반 점수와 통합한다.

**결과 판단 기준**: 리뷰 5개 이상 여부에 따라 리뷰 가중치 반영 결정

### 핵심 비즈니스 규칙

**규칙 1: 최소 리뷰 수 기준 및 실시간 통계 갱신**
매물당 리뷰 5개 미만일 경우 추천 점수에 미반영하며, 리뷰 5개 이상일 경우에만 리뷰 점수를 50% 비율로 반영한다. 이는 소수 리뷰로 인한 편향을 방지하고 통계적 신뢰도를 확보하기 위함이다. 리뷰 작성 시 평균 별점과 리뷰 개수는 실시간으로 갱신되어야 하며, 다수의 사용자가 동시에 리뷰를 남기는 상황에서도 통계 데이터의 정합성이 보장되어야 한다.

**규칙 2: 키워드 점수화 규칙**
긍정 키워드("조용하다", "밝다", "가깝다", "편리하다")는 +1점, 부정 키워드("시끄럽다", "어둡다", "불편하다", "멀다")는 -1점, 특정 키워드 없이 사실만 나열한 중립 리뷰는 0점으로 처리한다.

**규칙 3: 리뷰 점수 산출 공식**
리뷰 점수 = (평균 별점 / 5) × 100으로 계산하여 0~100점 범위의 점수로 정규화한다.

**규칙 4: 최종 점수 통합 공식**
기존 추천 로직의 검증된 점수 산출 방식을 유지하면서 리뷰 점수를 제한적으로 통합한다.

- AS-IS: `최종점수 = (가격점수 + 평수점수 + 안전점수)`
- TO-BE: `최종점수 = (기존 로직 결과 × 50%) + (리뷰 점수 × 50%)`

리뷰 5개 미만인 경우에는 리뷰 가중치를 0으로 처리하여 기존 로직의 점수를 100% 반영함으로써 서비스의 연속성을 보장한다. 이를 통해 리뷰 데이터가 부족한 초기 단계에도 기존 사용자 경험이 저하되지 않도록 한다.

### 데이터 모델 설계

**Review (매물 리뷰)**
```json
{
  "reviewId": "리뷰 고유 ID",
  "propertyId": "매물 ID (외래키)",
  "userId": "작성자 ID",
  "rating": "별점 (1~5)",
  "reviewText": "텍스트 리뷰 내용",
  "residencePeriod": "거주 기간 (예: 2년)",
  "createdAt": "작성 시각",
  "keywords": {
    "traffic": "교통 관련 점수 (+1/-1/0)",
    "noise": "소음 관련 점수 (+1/-1/0)",
    "lighting": "채광 관련 점수 (+1/-1/0)",
    "convenience": "편의시설 관련 점수 (+1/-1/0)"
  }
}
```

**PropertyScore (매물별 통합 점수)**
```json
{
  "propertyId": "매물 ID",
  "baseScore": "공공데이터 기반 기존 점수",
  "reviewCount": "리뷰 개수",
  "averageRating": "평균 별점",
  "reviewScore": "리뷰 점수 ((평균 별점 / 5) × 100)",
  "finalScore": "최종 통합 점수",
  "isReviewApplied": "리뷰 점수 반영 여부 (리뷰 5개 이상 여부)"
}
```

### 시스템 아키텍처 전략

본 프로젝트는 기존의 검증된 추천 로직을 유지하면서, 대규모 리뷰 데이터 처리를 위한 안정성과 확장성을 확보하기 위해 다음과 같은 기술적 전략을 채택한다.

**하이브리드 데이터 저장소 전략 (Hybrid Persistence Strategy)**

조회 성능과 데이터 무결성이라는 두 가지 상충되는 요구사항을 만족시키기 위해 Redis(Cache)와 Oracle RDB(Persistence)를 병행 운영하는 이원화된 저장소 구조를 수립한다.

**Redis (Read-Optimized Layer)**
기존과 동일하게 실시간 추천 및 필터링 트래픽을 전담하여 밀리초(Millisecond) 단위의 응답 속도를 보장한다. 국토부 실거래가 데이터와 리뷰 통계 데이터(reviewCount, avgRating)를 캐싱하여 빈번한 조회 요청에 대해 즉각적인 응답을 제공한다. 리뷰 통계 데이터는 비동기적으로 Redis에 동기화되어 조회 성능 저하를 방지한다.

**Oracle RDB (Write-Optimized Layer)**
데이터의 영속성(Persistence)을 보장하고, 리뷰 데이터와 매물 데이터 간의 참조 무결성(Referential Integrity)을 관리한다. 리뷰 작성, 수정, 삭제와 같은 트랜잭션 작업은 RDB에서 우선 처리되어 ACID 속성을 준수한다. 이를 통해 데이터 휘발성 위험을 제거하고 복잡한 관계형 데이터의 정합성을 보장한다.

**이벤트 기반 데이터 파이프라인 (Event-Driven Data Pipeline)**

기존 배치 시스템(BatchScheduler)의 안정성을 해치지 않고 RDB 적재 로직을 확장하기 위해, 관심사 분리(SoC) 원칙에 기반한 느슨한 결합 구조를 적용한다.

**배치 로직과 RDB 적재의 분리**
BatchScheduler는 데이터 수집 및 Redis 적재 후 DataCollectionCompletedEvent를 발행하며 종료된다. RDB 적재 로직을 직접 호출하지 않음으로써 배치 로직의 의존성을 최소화하고, 기존 검증된 배치 프로세스의 안정성을 유지한다.

**비동기 적재 처리**
별도의 이벤트 리스너(RdbSyncListener)가 DataCollectionCompletedEvent를 구독하여 RDB 적재(Upsert)를 비동기적으로 수행한다. 이는 향후 알림 발송이나 로그 적재 등 후속 작업이 추가되더라도 기존 배치 로직에 영향을 주지 않는 확장 가능한 구조이다.

**기존 추천 로직과의 통합**

리뷰 시스템 도입이 기존의 복잡한 '2단계 폴백 검색' 및 '필터링 로직'에 영향을 주지 않도록, 점수 산출 단계에서의 가중치 적용 방식으로만 제한적으로 통합한다.

**검색 및 필터링 로직 유지**
사용자의 예산, 평수, 지역 조건에 따른 1차 검색 및 매물 부족 시 수행되는 폴백(Fallback) 로직은 기존 Redis 인덱스를 그대로 활용하여 성능을 유지한다. 리뷰 시스템은 검색 및 필터링 단계에 개입하지 않으며, 필터링이 완료된 최종 후보 매물에 대해서만 점수 보정을 수행한다.

**최종 점수 산출식 고도화**
필터링이 완료된 최종 후보 매물에 대해서만 보정된 점수 산출식을 적용한다.
- AS-IS: `최종점수 = (가격점수 + 평수점수 + 안전점수)`
- TO-BE: `최종점수 = (기존 로직 결과 × 50%) + (리뷰 기반 점수 × 50%)`

**리뷰 데이터 부족 시 대응 방안**
리뷰 데이터가 없거나 부족한(5개 미만) 매물의 경우, 리뷰 가중치를 0으로 처리하여 기존 로직의 점수를 100% 반영함으로써 서비스의 연속성을 보장한다. 이를 통해 리뷰 시스템 도입 초기에도 기존 사용자 경험이 저하되지 않도록 한다.

**대용량 데이터 처리 최적화**

단순 기능 구현을 넘어, 대규모 데이터 환경에서도 안정적인 성능을 유지하는 엔터프라이즈급 품질을 목표로 한다.

**배치 단위 데이터 적재 최적화**
100만 건 이상의 데이터를 RDB로 이관 시 발생할 수 있는 병목 현상을 방지하기 위해, 개별 INSERT 쿼리 대신 배치 단위로 데이터를 한 번에 적재하여 배치 처리 시간을 단축한다. 이를 통해 네트워크 왕복 횟수와 트랜잭션 오버헤드를 최소화한다.

**DB 레벨 동시성 제어**
리뷰 작성 등 빈번한 쓰기 작업 발생 시 데이터 오염(Lost Update)을 방지하기 위해, 애플리케이션 레벨이 아닌 DB 레벨의 잠금(Lock) 메커니즘을 도입하여 데이터의 절대적 정합성을 보장한다. 평균 별점과 리뷰 개수 갱신 시 비관적 락(Pessimistic Lock) 또는 낙관적 락(Optimistic Lock)을 적용하여 동시성 문제를 원천적으로 차단한다.

---

## UI/UX 연동 방식 및 정보 표시 전략

지도 기반의 직관적인 탐색 경험을 유지하면서, 리뷰 데이터의 입력과 조회를 효율적으로 처리하기 위해 진입 경로를 이원화하고 모달 인터페이스와 독립 페이지를 전략적으로 혼용한다.

### 리뷰 작성 진입 경로 (이원화 전략)

사용자 편의성과 데이터 바인딩(Binding) 정확도를 동시에 확보하기 위해 진입점을 두 가지로 분리하여 설계한다.

| 구분 | 경로 및 동작 흐름 | 기술적 의의 및 구현 목표 |
|------|------------------|------------------------|
| **1. 지도 연동형 (Context-Aware)** | 지도 내 매물 상세 모달 → `[리뷰 작성]` 버튼 클릭 → URL 파라미터(`propertyId`)를 통해 매물 정보 자동 바인딩 | 사용자가 보고 있던 매물에 대해 즉시 리뷰를 작성할 수 있도록 문맥을 유지하며, 입력 오류를 시스템적으로 차단한다. |
| **2. 독립 탐색형 (Search-Driven)** | 리뷰 메인 페이지 → `[리뷰 작성]` 버튼 클릭 → 매물명 검색 모달 팝업 → 자동 완성(Autocomplete) 검색 후 선택 | 매물 데이터에 대한 고속 검색 인덱싱(Indexing) 및 자동 완성 API 구현 성능을 증명한다. |

### 리뷰 작성 프로세스 (Page-Based Writing)

리뷰 작성은 집중도가 요구되는 작업이므로, 지도 화면의 간섭을 받지 않는 **독립된 작성 페이지(Dedicated Page)**를 제공한다. 기존 게시판 작성 UI 구조를 계승하되, 리뷰 데이터 특성에 맞춰 입력 필드를 최적화한다.

**상단 정보 영역 (Read-Only)**
URL 파라미터 또는 검색을 통해 선택된 매물 정보(아파트명, 평수, 층수)를 상단에 고정 노출하여 작성 대상을 명확히 인지시킨다.

**정량 평가 영역**
별점: 1~5점 척도의 직관적인 선택 UI를 제공하여 정량적 만족도를 수집한다.

**정성 평가 영역 (Keyword Extraction Source)**
- 상세 리뷰: 사용자가 실제 거주 경험을 자유롭게 기술할 수 있는 텍스트 에디터를 제공한다.
- 자동 분석 연동: 사용자가 작성한 이 텍스트 본문은 백엔드의 키워드 추출 로직의 입력 데이터로 활용되어, '소음', '교통' 등의 핵심 키워드가 자동으로 분석 및 점수화된다. (사용자 수동 태그 선택 없음)

**저장 프로세스**
작성 완료 시 RDB에 저장되며, 트랜잭션 내에서 `Property` 테이블의 통계 데이터(`reviewCount`, `avgRating`)를 즉시 갱신한다.

### 리뷰 조회 시스템 (Modal Overlay)

사용자가 지도 탐색 흐름을 끊지 않고 리뷰를 확인할 수 있도록, 페이지 이동 없는 모달 오버레이 방식을 채택한다.

**진입**
지도 상의 매물 카드 또는 리스트에서 `[리뷰 보기]` 버튼 클릭 시, 별도의 페이지로 이동하지 않고 화면 위에 모달창이 레이어로 즉각 표시된다. 해당 모달 내에서는 선택된 매물에 대한 리뷰만 조회되며, 페이지네이션을 통해 대용량 리뷰 데이터를 효율적으로 탐색할 수 있다. 모달 내에서는 검색 등의 추가 기능은 제공되지 않는다.

**모달 구조**
- 헤더: 매물명, 평균 별점(4.5/5.0), 총 리뷰 수.
- 키워드 배지: 리뷰 본문 분석을 통해 추출된 상위 대표 키워드(예: #조용함, #채광좋음)를 배지(Badge) 형태로 노출하여 매물 특징을 요약 제공한다.
- 리스트: 최신순으로 정렬된 개별 리뷰 카드 리스트 표시.
- 페이지네이션: 스크롤 압박을 해소하고 대용량 데이터 조회 성능을 시각적으로 증명하기 위해 **번호 기반 페이지네이션(1, 2, 3...)**을 적용한다.

### 리뷰 시스템 메인 페이지 (Integrated Management)

서비스 내 축적된 모든 리뷰를 통합 조회하고 검색할 수 있는 독립된 페이지를 제공하여, 지도 탐색 외의 정보 접근 경로를 확보한다.

**통합 목록 조회**
전체 리뷰를 최신순으로 나열하며, 게시판 형태의 페이지네이션을 제공하여 대량의 데이터 처리 능력을 보여준다.

**통합 검색 기능**
제목, 내용, 또는 두 가지 조합 옵션을 선택하여 검색할 수 있는 기능을 제공한다. 이는 백엔드에서 `Property` 테이블과 `Review` 테이블 간의 조인(JOIN) 쿼리 최적화 역량을 증명하는 주요 기능이다.

---

## 기대 효과

### 서비스 개선 효과
- 실거주자 피드백 반영으로 추천 시스템 신뢰도 향상
- 정량 데이터와 정성 데이터 통합 제공으로 사용자 의사결정 지원 강화
- 데이터와 실제 체감의 괴리 감소
- 기존 검증된 추천 로직(2단계 폴백 검색, 필터링)을 그대로 유지하여 시스템 안정성 보장
- 리뷰 데이터 부족 시에도 기존 로직을 100% 활용하여 사용자 경험 저하 없이 서비스 제공
- 매물별 리뷰 데이터베이스 축적을 통한 데이터 자산 확보
- 향후 AI 분석 가능한 텍스트 데이터 확보

### 기술적 효과

**대용량 데이터 처리 성능**
- 수백만 건의 리뷰 데이터가 축적된 상황에서도 매물별 리뷰 조회 시 200ms 이내 응답 보장
- 배치 단위 데이터 적재를 통한 대량 데이터 이관 시 처리 시간 단축
- Redis 캐시 레이어와 RDB 영속성 레이어의 이원화 구조를 통한 조회 성능과 데이터 안정성 동시 확보

**데이터 정합성 및 동시성 제어**
- 빈번한 쓰기(리뷰 작성)와 읽기(조회) 트래픽이 공존하는 환경에서의 데이터 정합성 확보
- DB 레벨 Lock 메커니즘(비관적/낙관적) 적용을 통한 동시성 문제 해결 경험
- 실시간 통계 갱신 시 데이터 오염 방지를 위한 트랜잭션 관리 경험

**시스템 아키텍처 설계**
- 하이브리드 데이터 저장소 전략 수립 및 구현 경험
- 이벤트 기반 파이프라인을 통한 느슨한 결합 구조 설계 경험
- 관심사 분리 원칙 적용을 통한 확장 가능한 시스템 구축 경험

**복잡도 증가**
- N:M 관계 모델링 및 비정형 데이터 처리 경험 축적
- 참조 무결성 보장을 위한 외래키 설계 및 관리 경험

**성능 최적화**
- 읽기 성능 개선 전략 학습 및 비동기 처리 경험 확보
- 대용량 데이터 인덱싱 전략 수립 및 쿼리 튜닝 경험
- 캐시 무효화(Cache Invalidation) 전략 수립 경험

---

### 작성자 정보
- 작성자: 정범진 (Back-end Engineer)
- 연락처: bumjin.dev@gmail.com