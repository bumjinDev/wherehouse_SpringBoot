# 부동산 추천 시스템 '안전성 점수' 아키텍처 설계서

**버전**: 1.0  
**작성일**: 2025.08.21  
**상태**: 아키텍처 설계 완료, 기술 검증(PoC) 진행 필요

---

## 1. 프로젝트 개요

### 1.1 문제 정의
**초기 상태**: 기존 포트폴리오의 추천 시스템은 실제 비즈니스 로직이 부재한 정적 데이터 정렬 기능에 머물러 있음

**프로젝트 목표**: 사용자가 실제로 중요하게 생각하는 '안전성'을 중심으로, **1인 가구**를 위한 유의미하고 동적인 주거지 추천 로직을 설계하고 구현

### 1.2 핵심 타겟
- **대상**: 1인 가구
- **중점 요소**: 체감 안전성
- **접근 방식**: 데이터 기반 객관적 안전성 평가

---

## 2. 문제 심화 분석 및 기술적 난관

### 2.1 사용자 체감 안전의 실제 기준
사용자가 실제로 체감하는 안전은 다음과 같은 구체적 기준에 의해 결정됨:
- **아파트/빌라별 거주지 기준**: 개별 주거 단위의 환경적 특성
- **지역구 범용적 수치**: 광역적 치안 수준
- **주변 상가/환경 기준**: 반경 500m 내 시설물과 공터 등의 요소

### 2.2 이상적 모델과 현실적 제약
**이상적 접근**: 특정 주거지 좌표를 기준으로 주변 반경 내 시설물별 범죄 횟수 및 검거율 분석
- KAKAO MAP API로 좌표 획득 가능
- 반경 미터 크기 제한 수식 도출 필요
- 시설물 기점별 범죄 발생 통계 및 시설물 유형별 위험도 분류

**현실적 한계**: 구 단위 통계의 한계성
- 강서구, 영등포구 등 광역 단위 산출은 통계적 의미 부족
- 동별 발생율/검거율도 여전히 체감 안전과 거리 존재

### 2.3 핵심 난관: '체감 안전'과 '통계 데이터'의 간극

초기 설계는 공공데이터(범죄율, CCTV 등)를 조합하여 안전 점수를 산출하는 방향으로 시작되었으나, 기술 검증(PoC) 및 데이터 심층 분석 과정에서 근본적인 한계에 도달:

#### 2.3.1 데이터 입도(Granularity) 불일치
- **사용자 체감 안전**: 집 주변 500m 반경과 같은 **초지역적(Hyper-local)** 수준
- **확보 가능한 데이터**: **경찰서 관할 단위 혹은 구 단위**로 집계된 **거시적(Macro)** 통계

#### 2.3.2 이상적 데이터의 부재
- 'A 아파트' 또는 'B 상가'와 같이 특정 좌표나 건물 단위로 발생한 범죄 통계는 개인정보보호 및 수사 기밀 등의 사유로 공공데이터로 제공되지 않음

#### 2.3.3 결론 및 데이터 재수집 시도
사용자가 원하는 수준의 '초지역적 안전도'를 데이터로 직접 계산하는 것은 **불가능**

**데이터 재수집 가능성 탐색**:
- **공공데이터포털**: 경찰서 관할 단위 혹은 구 단위 공개가 한계로, 이것이 공식적으로 제공되는 가장 세분화된 범죄 통계
- **생활안전지도**: 행정안전부의 시각화 서비스이나 개발자용 원본 데이터 API 미제공
- **민간 데이터**: 보안업체/부동산 분석기업의 상업적 데이터는 비용 및 접근성 제약
- **최종 결론**: 이상적인 데이터는 존재하지 않으므로, 보유 데이터를 최대한 정교하게 활용하는 Proxy 모델이 최선

### 2.4 해결 전략: Proxy 모델 기반 하이브리드 접근
**핵심 철학**: 간접적인 데이터로 실제 안전 요인을 '추론(Proxy)'하는 하이브리드 모델 아키텍처 채택

> 거시적 데이터로 객관적인 지역 순위를 정하고, 미시적 데이터로 개별 주거지의 체감 위험도를 보정한다.

---

## 3. 학술적 근거: 지역 안전 지수 설계 프레임워크

### 3.1 CPTED 이론 기반 접근
기존 연구에서 널리 사용되는 지역 안전 지수(Community Safety Index) 구축 방법론을 적용하여 객관적 근거 확보

#### 3.1.1 환경설계를 통한 범죄예방(CPTED) 이론
**핵심 개념**: 범죄에 영향을 미치는 환경적 요인들을 종합적으로 고려

**지표 분류**:
- **공식적 감시(Formal Surveillance)**: 공권력에 의한 직접적 감시 수준
- **환경적 위험 요인(Environmental Risk Factors)**: 범죄 발생 가능성을 높이는 물리적 환경
- **사회적 무질서(Social Disorder)**: 지역의 관리 수준을 보여주는 간접 지표
- **실제 범죄 발생률(Crime Rate)**: 객관적 범죄 통계

### 3.2 1인 가구 맞춤형 안전성 지표 설계

#### 3.2.1 야간 보행 안전 (Nighttime Walking Safety)
**측정 목표**: "늦은 밤, 지하철역에서 집까지 걸어가는 길이 안전한가?"

| 측정 지표 | 데이터 소스 | 안전도 기여 |
|:---|:---|:---|
| 유흥업소 밀도 | KAKAO MAP API | 낮을수록 안전 (Negative) |
| 가로등 밀도 | 공공데이터포털 (지자체별) | 높을수록 안전 (Positive) |
| 대로변과의 거리 | KAKAO MAP API | 가까울수록 안전 (Positive) |
| 24시간 편의점/가게 수 | KAKAO MAP API | 많을수록 안전 (Positive) |

#### 3.2.2 주거 침입 안전 (Home Invasion Safety)
**측정 목표**: "내가 사는 집 자체가 외부 위협으로부터 안전한가?"

| 측정 지표 | 데이터 소스 | 안전도 기여 |
|:---|:---|:---|
| 건물 유형 | 국토교통부 API | 아파트 > 오피스텔 > 빌라 순 |
| 지역 내 CCTV 밀도 | 공공데이터포털 | 높을수록 안전 (Positive) |
| 저층(1~3층) 여부 | 국토교통부 API | 저층이 아닐수록 안전 |

#### 3.2.3 범죄 노출도 (General Crime Exposure)
**측정 목표**: "이 지역의 전반적인 범죄 위험 수준은 어떠한가?"

| 측정 지표 | 데이터 소스 | 안전도 기여 |
|:---|:---|:---|
| 성범죄/강도 발생률 | 경찰청 통계 | 낮을수록 안전 (Negative) |
| 절도 발생률 | 경찰청 통계 | 낮을수록 안전 (Negative) |
| 파출소/지구대와의 거리 | KAKAO MAP API | 가까울수록 안전 (Positive) |

---

## 4. 최종 아키텍처: 2단계 레이어 모델

### 4.1 Layer 1: 거시적 안전도 (Macro-Safety Score)

**목표**: 지역(구)의 전반적인 치안 수준을 나타내는 기본 점수(Baseline Score) 산출

**사용 데이터**: 경찰서별 혹은 구별 5대범죄 발생 현황 데이터

**산출 방식**: 
- 31개 경찰서 데이터를 25개 자치구와 매핑 (경찰서 관할 단위 혹은 구 단위 기준)
- 인구수 대비 범죄 발생률을 정규화
- 0~100점 사이의 점수로 변환

### 4.2 Layer 2: 미시적 위험도 (Micro-Risk Modifier)

**목표**: 개별 주거지(좌표) 주변 환경을 분석하여 기본 점수를 보정하는 가감점(Modifier) 산출

**사용 데이터**: 
- KAKAO MAP API
- 지자체별 공공데이터
- 장소별 5대범죄 발생 현황 데이터

#### 4.2.1 핵심 지표 (1인 가구 맞춤)

**야간 보행 안전**:
- 유흥업소 밀도 (감점 요인)
- 가로등 밀도 (가점 요인)
- 24시간 편의점 수 (가점 요인)
- 대로변과의 거리 (가점 요인)

**주거 침입 안전**:
- CCTV 밀도 (가점 요인)
- 파출소/지구대와의 거리 (가점 요인)
- 저층(1~3층) 여부 (감점 요인)

---

## 5. 점수 산출 방법론

### 5.1 AHP 기법 기반 4단계 체계적 프로세스

#### 5.1.1 지표 선정
앞서 명시된 '거시' 및 '미시' 지표들을 최종 측정 항목으로 확정

#### 5.1.2 데이터 정규화 (Normalization)
- **방식**: Min-Max 정규화
- **적용**: 모든 지표(CCTV 개수, 유흥업소까지의 거리 등)를 0~1 사이의 공통된 척도로 변환

#### 5.1.3 가중치 부여 (Weighting)
- **기준**: 1인 가구의 특성 고려
- **방법론**: AHP(Analytic Hierarchy Process) 기법을 간소화하여 서비스 핵심 타겟 유저에게 가장 중요한 요소에 높은 가중치 부여
- **예시**: 야간 보행 안전(40%) 등 체감 안전에 중요한 영향을 미치는 요소에 더 높은 가중치 부여
- **정책**: 가설 기반의 정책 수립

**가중치 설정 가설**:
- **야간 보행 안전**: 40% (1인 가구 여성의 주요 관심사)
- **주거 침입 안전**: 30% (직접적 위험 요소)
- **범죄 노출도**: 30% (객관적 지역 안전도)

#### 5.1.4 지수 산출 (Aggregation)
**모델**: 선형 가중 합산 모델 (Linear Weighted Sum Model)

```
최종 점수 = (거시 점수) - (위험 인자 가중합) + (안전 인자 가중합)
```

**세부 산출식**:
```
최종 안전 점수 = (야간 보행 점수 × 0.4) + (주거 침입 점수 × 0.3) + (범죄 노출도 점수 × 0.3)
```

---

## 6. 시설물별 안전성 지표 정의

### 6.1 정책 수립 필요성
시스템의 현실적인 제약(성능, 비용, 안정성)을 고려하여 단순한 기획을 넘어 실제 동작하는 시스템을 구축하는 아키텍트 관점으로 전환

### 6.2 Facility Safety Score 테이블
장소별 5대범죄 발생 현황 데이터를 근거로 한 가설 기반 정책

| 시설물 카테고리 (KAKAO API 기준) | 안전성 기여도 (Score) | 근거 |
|:---|:---:|:---|
| **SW8** (지하철역) | +0.5 | 24시간 유동인구, 공식적 감시 |
| **CS2** (편의점) | +0.2 | 24시간 운영, 비공식적 감시 |
| **PO3** (파출소, 지구대) | +3.0 | 직접적인 치안 유지 기능 |
| **FD6** (음식점) / **CE7** (카페) | 0.0 | 중립 |
| **AT4** (관광/숙박) / **AD5** (숙박) | -1.0 | 익명성, 외부인 유입 |
| **HP8** (병원) | +1.0 | 필수 공공시설, 야간 운영 |
| **PS3** (유치원) / **SC4** (학교) | +1.5 | 아동 보호 구역 |
| **PK6** (주차장) / 공터 | -0.5 | 감시 취약, CPTED상 위험지역 |
| **유흥업소** (주점/노래방) | -2.0 | 장소별 데이터상 높은 폭력 발생률 |

**📝 선행 과제**: 위 정책 테이블 확정이 모든 계산의 전제 조건

---

## 7. 시스템 아키텍처 설계: 실시간 vs 배치

### 7.1 아키텍처 비교 분석

#### 7.1.1 계획 1: 실시간 동적 분석 모델 (비권장)

**동작 흐름**:
1. 사용자 요청 발생 → 매물 좌표 획득
2. KAKAO MAP API 호출 (좌표 반경 500m 내 시설물 검색)
3. 반환된 시설물 목록과 Facility Safety Score 테이블 매칭하여 '미시적 위험도' 실시간 계산
4. '거시적 안전도'와 결합하여 최종 점수 반환

**치명적 문제점**:
- **성능**: 사용자 요청마다 외부 API 호출로 응답 시간 최소 수 초 이상 소요, 사용자 경험 극도로 저하
- **비용**: 사용자가 스크롤하며 수십 개의 매물을 보는 순간마다 API 호출, API 이용료 기하급수적 증가, AWS 리소스 비용 동반 상승
- **안정성**: KAKAO MAP API의 일시적 장애나 속도 저하가 서비스 전체 장애로 직결되는 매우 취약한 구조

#### 7.1.2 계획 2: 배치 기반 사전 처리 모델 (최종 권장 아키텍처)

**핵심 개념**: 사용자 요청 시점과 데이터 수집/계산 시점을 완전히 분리
**특징**: 성능, 비용, 안정성을 모두 만족시키는 현실적 절충안

### 7.2 최종 아키텍처 구성

#### 7.2.1 A. 오프라인 배치 시스템 (Offline Batch System)

**실행 주기**: Spring @Scheduled 등을 이용해 매일 새벽 또는 주 1회 등 주기적으로 실행

**동작 흐름**:
1. 서울시 전체를 일정한 크기의 격자(Grid, 예: 100m x 100m)로 분할
2. 각 격자의 중심 좌표를 기준으로 KAKAO MAP API를 단 한 번 호출하여 주변 시설물 정보 수집
3. 수집된 시설물 정보와 Facility Safety Score를 이용해 해당 격자의 '미시적 위험도' 점수를 미리 계산
4. 계산된 결과를 격자 ID - 위험도 점수 형태로 Redis나 DB에 저장

#### 7.2.2 B. 온라인 추천 시스템 (Online Recommendation System)

**동작 흐름**:
1. 사용자 요청 발생 → 매물 좌표 획득
2. 해당 좌표가 속한 격자 ID를 계산 (간단한 좌표 변환 로직)
3. Redis/DB에서 해당 격자 ID의 미리 계산된 '미시적 위험도' 점수를 조회 (수십 밀리초 내외로 매우 빠름)
4. '거시적 안전도'와 결합하여 최종 점수를 즉시 반환

---

## 8. 데이터 소스 및 기술 스택

### 8.1 주요 데이터 소스
- **KAKAO MAP API**: '카테고리로 장소 검색' 기능
  - **파라미터**: (x, y, radius, category_group_code)
  - **기능**: 특정 좌표 반경 내의 특정 카테고리(편의점, 은행 등) 시설물 목록과 개수 조회
- **경찰청 통계**: 경찰서 관할 단위 혹은 구 단위로 집계된 5대범죄 발생 현황 데이터
- **지자체별 공공데이터** (CCTV, 가로등 등)

### 8.2 기술적 고려사항
**격자 크기 결정**: 트레이드오프 존재
- **100m x 100m**: 정밀하지만 계산량 많음
- **250m x 250m**: 계산량은 적지만 정밀도 낮음

### 8.3 아키텍처 채택 근거
**최종 결론**: 계획 2(배치 기반 사전 처리 모델) 채택
- **초기 개발 복잡도**: 약간 높음
- **장기적 우위**: 서비스 안정성과 비용 효율성 측면에서 비교할 수 없는 우위

---

## 9. 실행 계획

### 9.1 가장 시급한 과제
제안된 아키텍처의 기술적 실현 가능성 검증

### 9.2 우선순위별 기술 검증 계획

#### 9.2.1 1순위 과제
공공데이터포털에서 '가로등 설치 정보' API 또는 데이터셋 확보 가능성 확인

#### 9.2.2 2순위 과제
KAKAO MAP API의 '키워드로 장소 검색' 기능을 사용하여 특정 좌표 반경 내 '유흥주점', '24시간 편의점' 등의 개수를 정확히 카운트하는 기술 검증(PoC) 수행

### 9.3 구체적 행동 계획
KAKAO MAP API를 사용하여 다음 항목들의 기술 검증(PoC) 코드를 우선적으로 작성:
- 특정 좌표 반경 내 '유흥주점', '24시간 편의점' 등의 개수 정확 카운트
- '파출소', '대로변'까지의 거리 계산

### 9.4 선행 결정 사항
1. **Facility Safety Score 정책 테이블 확정**
2. **서울시를 나눌 격자(Grid) 크기 결정**
   - 예시: 100m x 100m vs 250m x 250m 트레이드오프 고려

### 9.5 다음 단계
상기 두 가지 결정을 바탕으로 단일 격자에 대한 '미시적 위험도'를 계산하는 배치 작업 PoC 코드 작성

---

## 10. 결론

본 아키텍처는 **배치 기반 사전 처리 모델**을 최종 권장안으로 채택함으로써:

- **성능**: 실시간 응답 보장 (수십 밀리초 내외)
- **비용**: API 호출 최적화를 통한 운영비용 절약
- **안정성**: 외부 API 의존성 최소화를 통한 서비스 안정성 확보

시스템의 현실적 제약사항을 모두 고려한 실제 동작 가능한 아키텍처로서, 단순한 기획을 넘어 아키텍트 관점에서 설계된 현실적이고 실용적인 솔루션임.

---

## 참고문헌

1. CPTED 발전방향 정책보고서 - 한국셉테드학회
   - URL: https://crimeprevention.joins.com/files/%EB%A7%81%ED%81%AC%EC%9E%90%EB%A3%8C1-%EC%85%89%ED%85%8C%EB%93%9C%20%EB%B0%9C%EC%A0%84%EB%B0%A9%ED%96%A5%20%EC%A0%95%EC%B1%85%EB%B3%B4%EA%B3%A0%EC%84%9C.pdf

2. 환경설계를 통한 범죄예방 방안 - 경찰청
   - URL: https://crimeprevention.joins.com/files/%EB%A7%81%ED%81%AC%EC%9E%90%EB%A3%8C2-%ED%99%98%EA%B2%BD%EC%84%A4%EA%B3%84%EB%A5%BC%20%ED%86%B5%ED%95%9C%20%EB%B2%94%EC%A3%84%EC%98%88%EB%B0%A9%20%EB%B0%A9%EC%95%88(%EA%B2%BD%EC%B0%B0%EC%B2%AD).pdf