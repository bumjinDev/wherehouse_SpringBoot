# 부동산 추천 시스템 - 안전성 점수 데이터 연동 명세서 (완전판)

**프로젝트명:** Phase 2 추천 엔진 비즈니스 로직 설계 - 안전성 점수 데이터 연동 부문  
**버전:** 3.3 (경찰시설 데이터 추가)  
**작성일:** 2025.08.21  
**업데이트:** 모든 실제 사용 가능한 API 및 데이터 소스 완전 반영  

---

## 목차

1. [데이터 연동 전략 개요](#1-데이터-연동-전략-개요)
2. [실제 사용 가능한 안전성 점수 데이터 소스](#2-실제-사용-가능한-안전성-점수-데이터-소스)
3. [실제 API 연동 기술 명세](#3-실제-api-연동-기술-명세)
4. [실제 구현시 주의사항](#4-실제-구현시-주의사항)
5. [마무리](#5-마무리)

---

## 1. 데이터 연동 전략 개요

### 1.1 현재 상황 분석

**핵심 비즈니스 요구사항**: 배치 기반 2단계 레이어 안전성 점수 계산을 위한 실제 데이터 수집

```
📊 완전한 안전성 점수 데이터 수집 범위
├── Layer 1: 거시적 안전도 데이터
│   ├── 공공데이터포털 파일 다운로드 (경찰청 5대범죄 통계)
│   └── 서울시 열린데이터광장 (구별 범죄통계)
├── Layer 2: 미시적 위험도 데이터
│   ├── KAKAO MAP API 시설물 정보 (실제 사용 가능)
│   ├── 공공데이터 표준 파일 (전국CCTV, 가로등)
│   ├── 한국형사법무정책연구원 API (범죄통계)
│   └── 경찰청 경찰시설 표준데이터 (지구대/파출소)

🎯 최종 수집 목표: 격자별 완전한 환경 데이터 확보
└── 배치 처리용 원시 데이터 수집 후 DB/Redis 저장
```

### 1.2 실제 데이터 연동 원칙

| 원칙 | 내용 | 구현 방법 |
|------|------|-----------|
| **혼합 수집 방식** | API + 파일 다운로드 병행 | 데이터 소스별 최적 방법 적용 |
| **공공데이터 우선** | 신뢰성 있는 공식 통계 활용 | 공공데이터포털/서울시 중심 |
| **API 호출 최적화** | 비용 및 성능 최적화 | 무료 API 우선, 유료 API 최소화 |
| **데이터 품질 관리** | 수집 데이터 검증 및 정제 | 파일 파싱 + API 검증 |

---

## 2. 실제 사용 가능한 안전성 점수 데이터 소스

### 2.1 경찰청 범죄 통계 데이터 (파일 기반)

#### A. 공공데이터포털 - 경찰청 5대범죄 발생건수

* **URL**: https://www.data.go.kr/data/15083810/fileData.do
* **제공방식**: Excel/CSV 파일 다운로드 (무료)
* **갱신주기**: 연 1회 (매년 업데이트)
* **설명**: 2018년~2023년 5대범죄 발생건수 통계

**📊 실제 제공 데이터 항목**
| 항목 | 파일 컬럼명 | 데이터 타입 | 수집 용도 |
|------|-----------|------------|----------|
| **연도** | year | String | 시계열 분석 |
| **지역명** | region_name | String | 지역 매핑 |
| **살인** | murder | Integer | 범죄 통계 |
| **강도** | robbery | Integer | 범죄 통계 |
| **강간/강제추행** | sexual_crime | Integer | 범죄 통계 |
| **절도** | theft | Integer | 범죄 통계 |
| **폭력** | violence | Integer | 범죄 통계 |

#### B. 서울시 열린데이터광장 - 5대범죄 발생현황

* **URL**: https://data.seoul.go.kr/dataList/316/S/2/datasetView.do
* **제공방식**: 통계 조회 및 다운로드
* **갱신주기**: 연 1회
* **설명**: 서울시 구별 5대범죄 발생/검거 현황

### 2.2 KAKAO MAP API (실제 사용 가능)

#### A. API 정보
* **URL**: https://developers.kakao.com/docs/latest/ko/local/dev-guide
* **인증방식**: REST API 키 (무료 제한: 일 300,000회)
* **응답형식**: JSON
* **실제 사용 가능한 엔드포인트**:
  - 카테고리 검색: `/v2/local/search/category`
  - 키워드 검색: `/v2/local/search/keyword`

#### B. 실제 수집 가능한 시설물 정보

**📊 KAKAO API 실제 제공 카테고리**
| 시설물 유형 | KAKAO 코드 | 수집 방법 | 실제 획득 정보 |
|:---|:---:|:---|:---|
| **편의점** | CS2 | 카테고리 검색 | 개수, 좌표, 거리, 상호명 |
| **지하철역** | SW8 | 카테고리 검색 | 개수, 좌표, 노선정보 |
| **은행** | BK9 | 카테고리 검색 | 개수, 좌표, 지점명 |
| **병원** | HP8 | 카테고리 검색 | 개수, 좌표, 병원명 |
| **유흥업소** | - | 키워드 검색<br/>("유흥주점") | 개수, 좌표, 상호명 |
| **파출소** | - | 키워드 검색<br/>("파출소") | 개수, 좌표, 거리 |

### 2.3 전국CCTV 표준데이터 (파일 기반)

#### A. 데이터 소스 정보
* **URL**: https://www.data.go.kr/data/15013094/standard.do
* **제공방식**: Excel 파일 다운로드 (무료)
* **제공기관**: 행정안전부 (개인정보보호위원회)
* **갱신주기**: 월 1회 (매월 초 업데이트)

#### B. 실제 제공 데이터 구조

**📊 전국CCTV 표준데이터 실제 컬럼**
| 컬럼명 | 데이터 타입 | 설명 | 활용 방안 |
|--------|-----------|------|----------|
| **관리기관명** | String | CCTV 관리 기관 | 데이터 품질 확인 |
| **소재지도로명주소** | String | 설치 위치 주소 | 주소 → 좌표 변환 |
| **소재지지번주소** | String | 지번 주소 | 주소 매칭 |
| **설치목적구분** | String | 생활방범/교통/시설물관리 등 | 목적별 분류 |
| **카메라대수** | Integer | 해당 지점 카메라 수 | 집계 데이터 |
| **카메라화소수** | String | 화소 정보 | 품질 지표 |
| **촬영방면정보** | String | 촬영 방향 | 커버리지 분석 |
| **설치연월** | String | 설치 시기 | 시계열 분석 |
| **위도** | Double | GPS 위도 | 공간 분석 |
| **경도** | Double | GPS 경도 | 공간 분석 |

### 2.4 전국스마트가로등 표준데이터 (파일 기반)

#### A. 데이터 소스 정보
* **URL**: https://www.data.go.kr/data/15028205/standard.do
* **제공방식**: Excel 파일 다운로드 (무료)
* **갱신주기**: 기관별 상이 (분기별~연별)

#### B. 실제 제공 데이터 구조

**📊 스마트가로등 표준데이터 실제 컬럼**
| 컬럼명 | 데이터 타입 | 설명 | 활용 방안 |
|--------|-----------|------|----------|
| **관리기관명** | String | 가로등 관리 기관 | 관리 주체 확인 |
| **소재지주소** | String | 가로등 설치 위치 | 위치 기반 분석 |
| **설치년도** | Integer | 설치 연도 | 시설 노후도 분석 |
| **전력용량** | String | 전력 사양 | 조도 추정 |
| **위도** | Double | GPS 위도 | 공간 분석 |
| **경도** | Double | GPS 경도 | 공간 분석 |

### 2.5 한국형사법무정책연구원 범죄통계 API

#### A. API 정보
* **URL**: https://www.crimestats.or.kr/portal/openapi/openApiListPage.do
* **인증방식**: 인증키 발급 (무료)
* **제공데이터**: 범죄분석(대검찰청), 범죄통계(경찰청), 사법연감 등
* **응답형식**: JSON/XML

#### B. 실제 제공 API 목록

**📊 CCJS Open API 실제 제공 서비스**
| API명 | 엔드포인트 | 제공 데이터 | 활용 목적 |
|-------|-----------|-----------|----------|
| **범죄통계 조회** | `/statistics/crime` | 범죄유형별 발생/검거 통계 | 지역별 범죄율 계산 |
| **지역별 범죄현황** | `/statistics/region` | 시도별/시군구별 범죄 현황 | 공간적 범죄 분포 |
| **시계열 범죄통계** | `/statistics/timeseries` | 연도별 범죄 추이 | 트렌드 분석 |

### 2.6 경찰서/지구대/파출소 표준데이터 (파일 기반)

#### A. 데이터 소스 정보
* **URL**: https://www.data.go.kr/data/15077036/fileData.do
* **제공방식**: Excel 파일 다운로드 (무료) 
* **제공기관**: 경찰청 범죄예방대응국 지역경찰운영과
* **갱신주기**: 연 1회 (매년 12월 업데이트)
* **설명**: 전국 지구대 및 파출소 주소 현황

#### B. 실제 제공 데이터 구조

**📊 경찰서/지구대/파출소 표준데이터 실제 컬럼**
| 컬럼명 | 데이터 타입 | 설명 | 활용 방안 |
|--------|-----------|------|----------|
| **시도청** | String | 관할 시도 | 지역 분류 |
| **경찰서** | String | 소속 경찰서명 | 상위 기관 |
| **관서명** | String | 지구대/파출소명 | 시설 식별 |
| **구분** | String | 지구대/파출소 구분 | 시설 유형 분류 |
| **전화번호** | String | 대표 전화번호 | 연락처 정보 |
| **주소** | String | 소재지 주소 | 위치 기반 분석 |

#### C. 서울시 경찰시설 현황 (2024년 기준)

**📊 서울시 경찰시설 분포**
| 구분 | 개수 | 특징 | 관할 범위 |
|------|------|------|----------|
| **경찰서** | 31개 | 자치구별 설치 | 구 단위 |
| **지구대** | 약 150개 | 대규모 시설 (40-60명) | 2-3개 동 |
| **파출소** | 약 200개 | 소규모 시설 (20-30명) | 1-2개 동 |
| **치안센터** | 약 50개 | 상담 전용 (주간만 운영) | 특정 지역 |

#### D. 안전성 점수 활용 방안

**수집 방법**
1. 경찰청 공공데이터에서 Excel 파일 다운로드
2. 서울시 데이터만 필터링 (시도청 = "서울특별시")  
3. 주소 → 좌표 변환 (지오코딩)
4. 격자별 최근접 경찰시설 매핑

**안전성 점수 활용**
- **접근성 지수**: 격자에서 가장 가까운 경찰시설까지의 거리
- **치안 밀도**: 격자 주변 500m 내 경찰시설 개수
- **대응력 지수**: 지구대(고) vs 파출소(중) vs 치안센터(저) 가중치 적용
- **24시간 접근성**: 치안센터는 야간 비운영으로 가중치 조정

---

## 3. 실제 API 연동 기술 명세

### 3.1 기술 스택 및 의존성

#### A. 실제 구현 기술 스택

```xml
<!-- pom.xml (Maven 기준) -->
<dependencies>
    <!-- Spring Boot Batch (배치 처리) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-batch</artifactId>
    </dependency>
    
    <!-- Redis (데이터 저장) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>
    
    <!-- WebClient (API 호출) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webflux</artifactId>
    </dependency>
    
    <!-- Excel 파싱 (Apache POI) -->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-ooxml</artifactId>
    </dependency>
    
    <!-- CSV 파싱 (OpenCSV) -->
    <dependency>
        <groupId>com.opencsv</groupId>
        <artifactId>opencsv</artifactId>
        <version>5.7.1</version>
    </dependency>
    
    <!-- HTTP 파일 다운로드 -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
</dependencies>
```

#### B. 환경 설정

```yaml
# application.yml 실제 설정
data-collection:
  batch:
    grid-size: 250  # 격자 크기 (m)
    seoul-bounds:
      min-lat: 37.413294
      max-lat: 37.715133
      min-lng: 126.734086
      max-lng: 127.269311
  
  file-storage:
    local-path: "./data/downloads/"
    max-file-size: 50MB
  
# 실제 API 설정
kakao:
  api:
    rest-api-key: ${KAKAO_REST_API_KEY:your-api-key}
    base-url: https://dapi.kakao.com
    rate-limit: 300000  # 일일 호출 제한 (무료 플랜)

ccjs:
  api:
    auth-key: ${CCJS_AUTH_KEY:your-auth-key}
    base-url: https://www.crimestats.or.kr/portal/api
    rate-limit: 1000  # 일일 호출 제한

redis:
  host: localhost
  port: 6379
  database: 0
  timeout: 3000ms
```

### 3.2 공공데이터 파일 다운로더 (완전판)

```java
/**
 * 공공데이터 파일 다운로드 및 파싱 서비스 (완전판)
 */
@Service
@Slf4j
public class PublicDataFileService {
    
    private final RestTemplate restTemplate;
    private final RedisTemplate<String, Object> redisTemplate;
    
    @Value("${data-collection.file-storage.local-path}")
    private String localStoragePath;
    
    public PublicDataFileService() {
        this.restTemplate = new RestTemplate();
    }
    
    /**
     * 경찰청 5대범죄 Excel 파일 다운로드 및 파싱
     */
    public List<CrimeStatistics> downloadAndParseCrimeData() {
        try {
            String fileUrl = "https://www.data.go.kr/cmm/fms/FileDown.do?atchFileId=FILE_000000_경찰청5대범죄&fileSn=1";
            String fileName = "police_crime_stats_" + LocalDate.now().toString() + ".xlsx";
            String filePath = downloadFile(fileUrl, fileName);
            
            List<CrimeStatistics> crimeStats = parseExcelCrimeData(filePath);
            
            String redisKey = "crime_stats:police:" + LocalDate.now().getYear();
            redisTemplate.opsForValue().set(redisKey, crimeStats, Duration.ofDays(30));
            
            log.info("경찰청 범죄통계 데이터 수집 완료: {} 건", crimeStats.size());
            return crimeStats;
            
        } catch (Exception e) {
            log.error("경찰청 범죄통계 파일 처리 실패", e);
            return Collections.emptyList();
        }
    }
    
    /**
     * 전국CCTV 표준데이터 다운로드 및 파싱
     */
    public List<CctvInfo> downloadAndParseCctvData() {
        try {
            String fileUrl = "https://www.data.go.kr/cmm/fms/FileDown.do?atchFileId=FILE_000000_전국CCTV&fileSn=1";
            String fileName = "national_cctv_" + LocalDate.now().toString() + ".xlsx";
            String filePath = downloadFile(fileUrl, fileName);
            
            List<CctvInfo> cctvList = parseExcelCctvData(filePath);
            
            List<CctvInfo> seoulCctvList = cctvList.stream()
                    .filter(cctv -> cctv.getAddress().contains("서울"))
                    .collect(Collectors.toList());
            
            String redisKey = "cctv_data:seoul:" + LocalDate.now().toString();
            redisTemplate.opsForValue().set(redisKey, seoulCctvList, Duration.ofDays(7));
            
            log.info("서울시 CCTV 데이터 수집 완료: {} 개", seoulCctvList.size());
            return seoulCctvList;
            
        } catch (Exception e) {
            log.error("CCTV 데이터 파일 처리 실패", e);
            return Collections.emptyList();
        }
    }
    
    /**
     * 전국 경찰시설 표준데이터 다운로드 및 파싱
     */
    public List<PoliceStationInfo> downloadAndParsePoliceStationData() {
        try {
            String fileUrl = "https://www.data.go.kr/cmm/fms/FileDown.do?atchFileId=FILE_000000_전국지구대파출소&fileSn=1";
            String fileName = "national_police_stations_" + LocalDate.now().toString() + ".xlsx";
            String filePath = downloadFile(fileUrl, fileName);
            
            List<PoliceStationInfo> policeStationList = parseExcelPoliceStationData(filePath);
            
            List<PoliceStationInfo> seoulPoliceStationList = policeStationList.stream()
                    .filter(station -> station.getProvince().contains("서울"))
                    .collect(Collectors.toList());
            
            String redisKey = "police_station_data:seoul:" + LocalDate.now().toString();
            redisTemplate.opsForValue().set(redisKey, seoulPoliceStationList, Duration.ofDays(30));
            
            log.info("서울시 경찰시설 데이터 수집 완료: {} 개", seoulPoliceStationList.size());
            return seoulPoliceStationList;
            
        } catch (Exception e) {
            log.error("경찰시설 데이터 파일 처리 실패", e);
            return Collections.emptyList();
        }
    }
    
    /**
     * 파일 다운로드 공통 메서드
     */
    private String downloadFile(String url, String fileName) throws IOException {
        Path targetPath = Paths.get(localStoragePath, fileName);
        Files.createDirectories(targetPath.getParent());
        
        ResponseEntity<byte[]> response = restTemplate.getForEntity(url, byte[].class);
        Files.write(targetPath, response.getBody());
        
        return targetPath.toString();
    }
    
    /**
     * Excel 범죄통계 파싱
     */
    private List<CrimeStatistics> parseExcelCrimeData(String filePath) throws IOException {
        List<CrimeStatistics> result = new ArrayList<>();
        
        try (FileInputStream fis = new FileInputStream(filePath);
             Workbook workbook = WorkbookFactory.create(fis)) {
            
            Sheet sheet = workbook.getSheetAt(0);
            Iterator<Row> rowIterator = sheet.iterator();
            
            if (rowIterator.hasNext()) rowIterator.next(); // 헤더 스킵
            
            while (rowIterator.hasNext()) {
                Row row = rowIterator.next();
                
                CrimeStatistics stats = CrimeStatistics.builder()
                        .year(getCellValueAsString(row.getCell(0)))
                        .regionName(getCellValueAsString(row.getCell(1)))
                        .murder(getCellValueAsInteger(row.getCell(2)))
                        .robbery(getCellValueAsInteger(row.getCell(3)))
                        .sexualCrime(getCellValueAsInteger(row.getCell(4)))
                        .theft(getCellValueAsInteger(row.getCell(5)))
                        .violence(getCellValueAsInteger(row.getCell(6)))
                        .build();
                        
                result.add(stats);
            }
        }
        
        return result;
    }
    
    /**
     * Excel CCTV 데이터 파싱
     */
    private List<CctvInfo> parseExcelCctvData(String filePath) throws IOException {
        List<CctvInfo> result = new ArrayList<>();
        
        try (FileInputStream fis = new FileInputStream(filePath);
             Workbook workbook = WorkbookFactory.create(fis)) {
            
            Sheet sheet = workbook.getSheetAt(0);
            Iterator<Row> rowIterator = sheet.iterator();
            
            if (rowIterator.hasNext()) rowIterator.next(); // 헤더 스킵
            
            while (rowIterator.hasNext()) {
                Row row = rowIterator.next();
                
                CctvInfo cctvInfo = CctvInfo.builder()
                        .managementOrg(getCellValueAsString(row.getCell(0)))
                        .address(getCellValueAsString(row.getCell(1)))
                        .installPurpose(getCellValueAsString(row.getCell(3)))
                        .cameraCount(getCellValueAsInteger(row.getCell(4)))
                        .latitude(getCellValueAsDouble(row.getCell(8)))
                        .longitude(getCellValueAsDouble(row.getCell(9)))
                        .build();
                        
                result.add(cctvInfo);
            }
        }
        
        return result;
    }
    
    /**
     * Excel 경찰시설 데이터 파싱
     */
    private List<PoliceStationInfo> parseExcelPoliceStationData(String filePath) throws IOException {
        List<PoliceStationInfo> result = new ArrayList<>();
        
        try (FileInputStream fis = new FileInputStream(filePath);
             Workbook workbook = WorkbookFactory.create(fis)) {
            
            Sheet sheet = workbook.getSheetAt(0);
            Iterator<Row> rowIterator = sheet.iterator();
            
            if (rowIterator.hasNext()) rowIterator.next(); // 헤더 스킵
            
            while (rowIterator.hasNext()) {
                Row row = rowIterator.next();
                
                PoliceStationInfo stationInfo = PoliceStationInfo.builder()
                        .province(getCellValueAsString(row.getCell(0)))        // 시도청
                        .policeStation(getCellValueAsString(row.getCell(1)))   // 경찰서
                        .stationName(getCellValueAsString(row.getCell(2)))     // 관서명
                        .stationType(getCellValueAsString(row.getCell(3)))     // 구분(지구대/파출소)
                        .phoneNumber(getCellValueAsString(row.getCell(4)))     // 전화번호
                        .address(getCellValueAsString(row.getCell(5)))         // 주소
                        .build();
                        
                result.add(stationInfo);
            }
        }
        
        return result;
    }
    
    // Cell 값 추출 유틸리티 메서드들
    private String getCellValueAsString(Cell cell) {
        if (cell == null) return "";
        return switch (cell.getCellType()) {
            case STRING -> cell.getStringCellValue();
            case NUMERIC -> String.valueOf((int) cell.getNumericCellValue());
            default -> "";
        };
    }
    
    private Integer getCellValueAsInteger(Cell cell) {
        if (cell == null) return 0;
        return switch (cell.getCellType()) {
            case NUMERIC -> (int) cell.getNumericCellValue();
            case STRING -> {
                try {
                    yield Integer.parseInt(cell.getStringCellValue());
                } catch (NumberFormatException e) {
                    yield 0;
                }
            }
            default -> 0;
        };
    }
    
    private Double getCellValueAsDouble(Cell cell) {
        if (cell == null) return 0.0;
        return switch (cell.getCellType()) {
            case NUMERIC -> cell.getNumericCellValue();
            case STRING -> {
                try {
                    yield Double.parseDouble(cell.getStringCellValue());
                } catch (NumberFormatException e) {
                    yield 0.0;
                }
            }
            default -> 0.0;
        };
    }
}
```

### 3.3 KAKAO MAP API 클라이언트

```java
/**
 * KAKAO MAP API 실제 구현
 */
@Component
@Slf4j
public class KakaoMapApiClient {
    
    private final WebClient webClient;
    
    @Value