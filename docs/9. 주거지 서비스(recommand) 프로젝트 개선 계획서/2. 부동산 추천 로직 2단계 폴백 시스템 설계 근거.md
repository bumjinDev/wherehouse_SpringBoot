# 부동산 추천 로직 2단계 폴백 시스템 설계 근거.md

## 개요

본 백서는 사용자 맞춤형 부동산 추천 시스템의 핵심 알고리즘 설계 과정에서 도출된 "2단계 폴백 하이브리드 접근법"의 채택 배경과 기술적 근거를 체계적으로 분석한다. 기존 단순 우선순위 기반 추천 방식의 한계를 극복하고, 매물 부족 상황에서도 지속적인 서비스 제공이 가능한 적응형 추천 시스템 구축을 목표로 한다.

---

## 1. 문제 상황 분석

### 1.1 기존 시스템의 구조적 한계

현재 운영 중인 부동산 추천 시스템은 사용자가 입력한 안전 점수와 편의 점수의 단순 비교를 통해 추천 기준을 결정하는 방식을 채택하고 있다. 이러한 접근법은 다음과 같은 근본적 제약을 내포한다.

**사용자 의도 파악의 한계**  
현재 시스템은 사용자가 입력한 점수의 크기 비교만으로 우선순위를 판단한다. 그러나 사용자가 안전에 70점, 편의에 65점을 부여한 경우, 이것이 단순히 "안전 우선"을 의미하는지, 아니면 "안전과 편의 모두 중요하되 안전에 약간 더 비중을 둔다"는 의미인지 구분할 수 없다.

**매물 부족 상황에 대한 대응 부재**  
사용자가 설정한 조건을 만족하는 매물이 충분하지 않을 경우, 시스템은 단순히 빈 결과를 반환하거나 임의의 매물을 제시한다. 이는 사용자의 우선순위를 고려하지 않은 일률적 대응으로, 서비스 만족도 저하와 직결된다.

**추천 근거의 불투명성**  
현재 시스템은 추천 결과만을 제시할 뿐, 왜 해당 지역이나 매물을 추천했는지에 대한 명확한 설명을 제공하지 않는다. 이는 사용자의 신뢰도 저하와 의사결정 지원 부족으로 이어진다.

### 1.2 시장 환경 변화와 새로운 요구사항

**부동산 시장의 공급 불균형**  
최근 부동산 시장은 지역별, 가격대별 공급 불균형이 심화되고 있다. 특정 조건을 만족하는 매물이 절대적으로 부족한 상황이 빈번히 발생하며, 이에 대한 시스템적 대응이 필수가 되었다.

**사용자 기대 수준의 상승**  
단순한 조건 매칭을 넘어서, 개인의 생활 패턴과 가치관을 반영한 지능적 추천에 대한 사용자 요구가 증가하고 있다. 특히 "왜 이 매물을 추천하는가"에 대한 명확한 설명을 원하는 사용자가 늘어나고 있다.

---

## 2. 대안 접근법 분석

### 2.1 검토된 접근법들의 특성 분석

부동산 추천 시스템의 개선을 위해 세 가지 주요 접근법이 검토되었다.

**접근법 A: 개별 요소 세분화 방식**  
사용자로부터 가격, 안전, 평수, 교통, 편의시설 등 모든 요소에 대한 개별 가중치를 입력받아 정교한 개인화 점수를 계산하는 방식이다. 이론적으로는 가장 정확한 개인화가 가능하나, 사용자 인터페이스의 복잡도가 급격히 증가하여 실용성이 떨어진다.

**접근법 B: 패턴 기반 분류 시스템**  
사용자를 사전 정의된 패턴(극단적 가격 민감형, 균형 가격 중시형, 안전 최소선형, 가성비 추구형, 프리미엄 지향형)으로 분류하고, 각 패턴별 고정 가중치를 적용하는 방식이다. 일정 수준의 개인화와 구현 편의성을 제공하나, 패턴 정의를 위한 충분한 데이터 확보가 어렵고 사용자가 패턴 경계에 위치할 경우 부정확한 분류가 발생할 수 있다.

**접근법 C: 통일 조건 기반 우선순위 정렬**  
모든 사용자에게 동일한 기본 조건을 적용하여 매물을 필터링한 후, 개별 우선순위에 따라 서로 다른 단순 요소별 재정렬을 적용하는 방식이다. 구현이 단순하고 예측 가능한 결과를 제공하나, 개인화 수준이 상대적으로 낮다.

### 2.2 각 접근법의 한계점

**공통적 한계: 매물 부족 상황 미고려**  
검토된 모든 접근법은 "충분한 매물이 존재한다"는 전제 하에 설계되었다. 실제 서비스 환경에서 빈번히 발생하는 매물 부족 상황에 대한 체계적 대응 방안이 부재했다.

**개발 일정과 기술적 제약**  
2주라는 제한된 개발 기간 내에서 복잡한 패턴 분석 시스템이나 세분화된 가중치 시스템을 구축하는 것은 기술적으로 실현 가능성이 낮다. 또한 패턴 정의를 위한 대규모 사용자 데이터가 현재로서는 확보되지 않은 상태다.

---

## 3. 하이브리드 솔루션: 2단계 폴백 시스템

### 3.1 설계 철학

**적응적 복잡도 관리**  
시스템의 복잡도를 상황에 따라 적응적으로 조절한다. 매물이 충분할 때는 단순하고 빠른 처리를, 매물이 부족할 때만 복잡한 확장 로직을 적용하여 성능과 정확성을 동시에 확보한다.

**사용자 중심 양보 전략**  
매물 부족 상황에서 시스템이 임의로 조건을 완화하는 것이 아니라, 사용자가 명시한 우선순위에 따라 덜 중요한 조건부터 순차적으로 완화하는 지능적 접근을 취한다.

**투명성과 설명 가능성**  
모든 추천 결과에 대해 명확한 근거를 제시하고, 특히 조건이 확장된 경우 어떤 조건이 어느 정도 완화되었는지 투명하게 공개한다.

### 3.2 시스템 구조

**1단계: 기본 조건 매물 확보**  
사용자가 입력한 기본 조건(예산 범위, 평수 범위, 지역구, 건물 유형, 임대 유형)을 모든 우선순위 유형에 동일하게 적용하여 초기 매물 후보군을 확보한다. 이 단계에서는 복잡한 개인화 로직을 적용하지 않고 공통 조건만으로 검색한다.

**매물 충분성 판단 및 분기**  
1단계에서 확보된 매물이 최소 추천 기준(예: 3개 이상)을 만족하는지 확인한다. 
- **매물 충분할 경우**: 바로 우선순위별 재정렬하여 결과 제공
- **매물 부족할 경우**: 2단계 확장 검색 실행

**2단계: 상황별 처리**

**(A) 매물 충분 시: 우선순위별 단순 요소별 재정렬**  
동일한 매물 후보군에 대해 사용자의 우선순위에 따라 각각 다른 단일 요소를 기준으로 재정렬한다. 가격 우선형은 가격순으로, 안전 우선형은 안전점수순으로, 평수 우선형은 평수순으로 단순하게 정렬하여 최종 순위를 결정한다.

**(B) 매물 부족 시: 우선순위별 확장 검색**  
사용자의 우선순위 설정에 따라 확장 순서를 결정한다. 3순위(가장 덜 중요한 조건)부터 완화를 시작하여, 충분한 매물이 확보될 때까지 단계적으로 조건을 확장한다.

### 3.3 우선순위별 확장 전략

**가격 우선형 사용자**  
가격을 가장 중요하게 여기는 사용자의 경우, 예산 범위는 절대 확장하지 않고 안전성과 평수 조건을 우선적으로 완화한다. 이는 "예산은 절대 초과할 수 없지만 다소 불편하거나 좁아도 괜찮다"는 가격 우선형 사용자의 심리를 반영한다.

**안전 우선형 사용자**  
안전을 최우선으로 하는 사용자의 경우, 안전 관련 기준은 절대 완화하지 않고 예산이나 평수, 지역 범위에서 양보한다. "안전을 위해서라면 더 많은 비용을 지불하거나 좁은 공간도 감수한다"는 안전 우선형 사용자의 가치관을 존중한다.

**평수 우선형 사용자**  
공간의 넓이를 중시하는 사용자의 경우, 절대 최소 평수는 유지하면서 예산이나 위치 조건에서 타협점을 찾는다. "좁은 곳은 절대 안 되지만 멀거나 비싸도 괜찮다"는 평수 우선형 사용자의 특성을 고려한다.

---

## 4. 기술적 구현 전략

### 4.1 점진적 개발 방법론

**위험 분산을 통한 안정적 구현**  
전체 시스템을 한 번에 구축하는 대신, 1단계 시스템을 먼저 완성하여 기본적인 서비스 제공이 가능한 상태를 확보한다. 이후 2단계 확장 시스템을 추가하여 점진적으로 고도화한다.

**모듈화된 설계**  
1단계 기본 검색 로직과 2단계 확장 로직을 독립적인 모듈로 분리하여 개발 및 유지보수의 효율성을 확보한다. 이를 통해 향후 더 복잡한 개인화 알고리즘 추가 시에도 기존 시스템에 미치는 영향을 최소화할 수 있다.

### 4.2 성능 최적화 전략

**캐싱 전략**  
구별 기본 정보와 매물 기본 정보에 대해서는 캐싱을 적용하여 반복 검색 시 성능을 향상시킨다. 특히 1단계 기본 검색에서는 자주 요청되는 조건 조합에 대해 결과를 캐싱하여 응답 속도를 개선한다.

---

## 5. 비즈니스 영향 분석

### 5.1 사용자 경험 개선 효과

**개인화 수준 향상**  
동일한 기본 조건이라도 사용자의 우선순위에 따라 서로 다른 추천 결과를 제공함으로써 개인화 수준을 크게 향상시킨다. 특히 매물 부족 상황에서도 개인의 가치관을 반영한 차별적 대안을 제시할 수 있다.

**의사결정 지원 강화**  
모든 추천 결과에 대해 명확한 근거를 제시하고, 조건 확장이 적용된 경우 구체적인 변경 사항을 안내하여 사용자의 합리적 의사결정을 지원한다.

---

## 6. 구현 전략

### 6.1 단계별 개발 접근법

**1주차: 핵심 기능 구현**  
기본 조건 필터링과 우선순위별 단순 요소별 재정렬 기능을 구현하여 최소 기능 제품을 완성한다. 이 단계에서는 매물이 충분할 때의 정상적인 추천 흐름을 완전히 구현한다.

**2주차: 확장 시스템 추가**  
매물 부족 상황에 대응하는 우선순위별 확장 검색 로직을 추가한다. 기존 핵심 기능에 영향을 주지 않도록 독립적인 모듈로 설계하여 안정성을 확보한다.

### 6.2 모듈화 설계 원칙

**기본 검색과 확장 검색의 분리**  
1단계 기본 검색 로직과 2단계 확장 검색 로직을 완전히 독립된 모듈로 구현한다. 이를 통해 기본 기능의 안정성을 보장하면서 확장 기능을 점진적으로 추가할 수 있다.

**우선순위별 확장 전략 모듈화**  
가격 우선형, 안전 우선형, 평수 우선형 각각의 확장 전략을 별도 모듈로 구현하여 유지보수성을 확보하고 향후 새로운 우선순위 추가를 용이하게 한다.

---

## 7. 기존 시스템 분석 및 개선 필요성

### 7.1 현재 시스템의 구체적 문제점

**중복된 조건문 로직 오류**  
전세 서비스(`RecommandCharterService`)의 조건 분기에서 동일한 조건(`safe_score > cvt_score`)이 중복 검사되는 논리적 오류가 발견되었다. 이로 인해 편의 점수가 더 높은 경우의 분기가 실행되지 않아 사용자 의도와 다른 결과가 제공될 수 있다.

**하드코딩된 매직 넘버**  
쿼리 내에 `ROWNUM <= 3`, `*10 < 60`, `*10 < 50` 등의 매직 넘버가 하드코딩되어 있어 비즈니스 로직의 의미를 파악하기 어렵고, 향후 기준 변경 시 코드 전반의 수정이 필요하다.

**획일적 결과 제한**  
모든 상황에서 최대 3개의 추천 결과만 제공하도록 고정되어 있어, 매물이 부족한 상황에서는 의미 있는 대안을 제시할 수 없다. 조건을 만족하는 구가 1개뿐이라면 사용자에게는 선택권이 거의 제공되지 않는다.

**사용자 우선순위 해석의 한계**  
현재 시스템은 안전 점수와 편의 점수의 단순 크기 비교만으로 사용자 우선순위를 판단한다. 그러나 사용자가 안전 75점, 편의 70점을 입력한 경우, 이것이 "안전 절대 우선"인지 "안전 약간 선호"인지 구분할 수 없어 세밀한 개인화가 불가능하다.

**추천 근거 부재**  
시스템이 특정 구를 추천하는 이유에 대한 설명이 전혀 제공되지 않아, 사용자는 왜 해당 지역이 추천되었는지 알 수 없다. 이는 사용자의 의사결정을 지원하지 못하고 서비스 신뢰도를 저하시킨다.

### 7.2 개선을 통한 기대 효과

**논리적 일관성 확보**  
조건문 오류를 수정하고 명확한 우선순위 처리 로직을 구현하여 사용자 입력에 대한 정확하고 예측 가능한 응답을 보장한다.

**매물 부족 상황 해결**  
2단계 폴백 시스템을 통해 기본 조건을 만족하는 매물이 부족한 경우에도 사용자의 우선순위를 고려한 대안을 제시하여 서비스 완성도를 크게 향상시킨다.

**개인화 수준 향상**  
단순한 점수 비교를 넘어서 사용자가 명시적으로 설정한 1순위, 2순위, 3순위 우선순위를 기반으로 한 차별화된 추천을 제공한다.

**투명한 추천 근거 제공**  
모든 추천 결과에 대해 "왜 이 지역을 추천하는가"에 대한 명확한 근거를 제시하여 사용자의 합리적 선택을 지원한다.

### 7.3 최종 설계 목표

본 2단계 폴백 하이브리드 시스템은 현재 시스템의 근본적 한계를 해결하면서도 "현실적 완성도"와 "의미 있는 차별화"를 동시에 달성할 수 있는 최적의 접근법이다. 

기존의 단순한 점수 비교 방식의 안정성은 유지하면서, 매물 부족 상황과 개인화 요구에 대한 지능적 대응 능력을 추가하여 완성도 높은 추천 서비스를 구현한다. 특히 "필요할 때만 복잡하게, 평상시에는 단순하게"라는 적응적 복잡도 관리 원칙을 통해 성능과 사용자 만족도를 균형있게 확보할 수 있다.