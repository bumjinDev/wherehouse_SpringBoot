# RDBMS와 Elasticsearch 역할 분담 계획서

## 1. 데이터베이스 역할 및 기능 범위 (확정안)

WhereHouse 프로젝트는 각기 다른 목적을 가진 두 개의 데이터 저장소를 함께 사용하는 폴리글랏 퍼시스턴스(Polyglot Persistence) 구조를 채택한다.

### 1.1 RDBMS (e.g., MySQL, PostgreSQL)

**핵심 역할**: 트랜잭션과 데이터 정합성이 중요한 핵심 데이터를 관리한다.

**기능 범위**:

- **사용자 정보 관리**: 회원 가입, 로그인, 인증/인가(JWT 리프레시 토큰 등) 관련 데이터
- **사용자 활동 데이터**: 게시판(리뷰) 기능, 사용자가 '찜'한 매물(북마크) 목록 등 사용자의 상호작용 결과를 저장
- **시스템 메타데이터**: 서비스 운영에 필요한 각종 코드나 설정 값 등을 관리

**선택 근거**: 데이터의 일관성과 무결성을 보장하는 ACID 트랜잭션이 필수적인 영역이므로 관계형 데이터베이스가 가장 적합하다.

### 1.2 Elasticsearch

**핵심 역할**: 대용량 데이터의 빠른 검색, 필터링, 통계 분석을 전담하는 검색 엔진이다.

**기능 범위**:

- **매물 데이터 검색**: 외부 API로부터 수집한 대규모 부동산 매물 데이터를 저장하고, 사용자의 복합적인 조건(가격, 평수, 지역 등)에 맞춰 빠르게 검색 결과를 제공한다.

- **안전 점수 계산**: **지리 공간 쿼리(Geo-spatial Query)**를 사용하여 사용자가 지정한 위치 기반의 안전 요소(e.g., CCTV 밀도, 파출소 거리)를 실시간으로 계산한다.

- **통계 데이터 생성**: 집계(Aggregations) 기능을 활용하여 '지역별 평균 시세', '가격 변동성', '시장 동향' 등 서비스에 필요한 모든 통계 데이터를 실시간으로 생성한다.

**선택 근거**: RDBMS로는 처리하기 어려운 비정형 데이터 검색, 위치 기반 계산, 실시간 통계 분석에 특화되어 있어 서비스의 핵심 경쟁력을 확보하는 데 필수적이다.

## 2. RDBMS 초안 ERD 계획

북마크, 리뷰 등 신규 기능을 고려하여 다음과 같은 기본 ERD를 계획한다.

| Table Name | Description | Key Columns | Relationships |
|------------|-------------|-------------|---------------|
| MEMBER | 회원 정보 | member_id (PK), email, password, nickname | REVIEW, BOOKMARK와 1:N 관계 |
| REVIEW | 매물 리뷰 | review_id (PK), member_id (FK), property_id (FK), content, rating | MEMBER, PROPERTY와 N:1 관계 |
| PROPERTY | 매물 기본 정보 | property_id (PK), address, property_type | REVIEW, BOOKMARK와 1:N 관계. Elasticsearch의 Document ID와 매핑 |
| BOOKMARK | 사용자 북마크(찜) | bookmark_id (PK), member_id (FK), property_id (FK) | MEMBER, PROPERTY와 N:1 관계 |

### 2.1 PROPERTY 테이블의 역할

이 테이블은 Elasticsearch에 저장된 수많은 매물 정보 중, 사용자와 상호작용(리뷰, 북마크)이 발생한 매물의 **핵심 식별 정보(ID, 주소 등)**만을 RDBMS에 저장하여 관계를 맺기 위한 연결고리 역할을 한다. 전체 매물 데이터를 RDBMS에 저장하지 않음으로써 중복을 피하고 각 저장소의 역할을 명확히 한다.

이 ERD를 기반으로 API를 개발하면서 필요한 컬럼(e.g., 생성일, 수정일 등)을 추가해나가면 된다.

## 3. 추천 시스템에서의 역할 분담

### 3.1 Elasticsearch: 추천 후보군 생성 및 랭킹

**1단계**: 사용자의 입력 조건(예산, 지역, 평수 등)에 맞는 매물 수천, 수만 건을 실시간으로 검색하고 필터링한다.

**2단계**: 필터링된 매물들을 대상으로 복합 안전 점수와 우선순위별 가중치를 실시간으로 계산하여 순위(랭킹)를 매긴다.

**3단계**: 매물이 부족할 경우, 경계 확장(Fallback) 로직을 적용하여 후보군을 다시 찾는다.

이 모든 과정, 즉 '추천할 매물 목록을 만들고 순위를 매기는' 핵심적인 연산은 모두 Elasticsearch 내부에서 처리된다.

### 3.2 RDBMS: 추천 결과의 저장 및 관리

**역할**: Elasticsearch가 생성한 추천 결과를 사용자가 특정 행동을 했을 때 그 기록을 저장하는 역할을 한다.

**예시**:
1. 사용자가 추천받은 'A 오피스텔'을 보고 '찜(북마크)' 버튼을 누른다.
2. 이때, MEMBER 테이블의 'user1'과 PROPERTY 테이블의 'A 오피스텔' 정보가 BOOKMARK 테이블에 한 줄(Row)로 저장된다.
3. 나중에 사용자가 '마이페이지'에서 '내 찜 목록'을 볼 때, RDBMS는 BOOKMARK 테이블을 조회하여 결과를 보여준다.