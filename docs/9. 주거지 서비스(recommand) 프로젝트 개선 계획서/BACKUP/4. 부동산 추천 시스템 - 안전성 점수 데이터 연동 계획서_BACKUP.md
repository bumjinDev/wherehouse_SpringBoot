# 부동산 추천 시스템 - 안전성 점수 데이터 연동 명세서

**프로젝트명:** Phase 2 추천 엔진 비즈니스 로직 설계 - 안전성 점수 데이터 연동 부문  
**버전:** 2.3  
**작성일:** 2025.08.21  
**기반 문서:** 프로젝트 개선 기획서 3.1항목 (사용자 입력 데이터 처리 설계)  

---

## 목차

1. [데이터 연동 전략 개요](#1-데이터-연동-전략-개요)
2. [안전성 점수 데이터 소스](#2-안전성-점수-데이터-소스)
3. [API 연동 기술 명세](#3-api-연동-기술-명세)

---

## 1. 데이터 연동 전략 개요

### 1.1 현재 상황 분석

**핵심 비즈니스 요구사항**: 전월세 매물의 **안전성 점수** 계산을 위한 4개 영역 데이터 확보

```
📊 안전성 점수 구성 요소 (100점 만점)
├── 범죄율 데이터: 40% (한국형사법무정책연구원)
├── 교통안전 데이터: 25% (TAAS 교통사고분석시스템)  
├── CCTV 밀도 데이터: 15% (행안부 전국CCTV + 국토부 교통CCTV)
└── 공공시설 접근성 데이터: 20% (소방서, 병원, 학교)

🎯 최종 산출물: 지역별 안전성 점수 (0-100점)
└── 전월세 추천 시 안전우선 옵션에 활용
```

### 1.2 데이터 연동 원칙

| 원칙 | 내용 | 구현 방법 |
|------|------|-----------|
| **공공데이터 우선** | 신뢰성 있는 공식 통계 활용 | 공공데이터포털 중심 |
| **배치 처리 방식** | 정적 데이터 특성 고려 | 주기적 업데이트 (월/분기) |
| **지역코드 기준** | 시군구 단위 안전성 산출 | 법정동코드 매핑 |

---

## 2. 안전성 점수 데이터 소스

### 한국형사법무정책연구원 범죄통계 API (40% 가중치)

* **공공데이터포털**: https://www.data.go.kr/data/15015477/openapi.do
* **범죄통계 전용 포털**: https://www.crimestats.or.kr/portal/openapi/openApiIntroPage.do
* **API 종류**: 
  - 범죄통계 통합 DB 정보 (`/getCrimeStatsInfo`)
* **설명**: 한국형사법무정책연구원이 운영하는 국내 유일의 범죄통계포털 Open API입니다. 지역별 범죄 통계를 조회할 수 있습니다.

#### A. 제공 데이터 항목 및 활용 방안

**📊 핵심 안전성 계산 데이터**
| 항목 | API 필드명 | 활용 용도 | 가중치 |
|------|-----------|----------|--------|
| **지역코드** | areaCode | 지역 매핑 | - |
| **지역명** | areaName | 지역 식별 | - |
| **살인발생** | murderCases | 강력범죄 점수 | 50점 |
| **강도발생** | robberyCases | 강력범죄 점수 | 30점 |
| **성범죄발생** | sexualCrimeCases | 강력범죄 점수 | 35점 |
| **절도발생** | theftCases | 일반범죄 점수 | 10점 |
| **폭력발생** | violenceCases | 일반범죄 점수 | 20점 |
| **인구수** | population | 범죄율 정규화 | - |

### TAAS 교통사고분석시스템 API (25% 가중치)

* **TAAS 공식 홈페이지**: https://taas.koroad.or.kr/web/shp/adi/initOpenApi.do
* **공공데이터포털**: https://www.data.go.kr/data/15059126/openapi.do
* **API 종류**:
  - 사망교통사고 정보 (`/getRestTrafficAccidentDeath`)
* **설명**: 한국도로교통공단에서 제공하는 교통사고 분석 전용 Open API입니다. 지역별 교통사고 통계를 실시간으로 조회할 수 있습니다.

#### A. 제공 데이터 항목
| 항목 | API 필드명 | 활용 용도 | 가중치 |
|------|-----------|----------|--------|
| **사고일시** | accidentDateTime | 사고 발생 시점 | - |
| **사고위치위도** | latitude | GPS 좌표 | - |
| **사고위치경도** | longitude | GPS 좌표 | - |
| **사고유형** | accidentType | 사고 심각도 분류 | 60% |
| **사망자수** | deathCount | 치명도 계산 | 25% |
| **부상자수** | injuryCount | 사고 영향도 | 10% |
| **가해차량** | vehicleType | 차량별 위험도 | 5% |

### 전국CCTV표준데이터 + 교통CCTV API (15% 가중치)

* **행안부 전국CCTV표준데이터**: https://www.data.go.kr/data/15013094/standard.do
* **국토교통부 교통CCTV API**: https://www.data.go.kr/data/3068943/openapi.do
* **제공 형태**: 
  - 전국CCTV: Excel 파일 다운로드 (월 1회 업데이트)
  - 교통CCTV: REST API 실시간 조회
* **설명**: 행안부에서 전국 자치단체 CCTV 정보를 통합 제공하고, 국토교통부에서 교통 전용 CCTV API를 별도 제공합니다.

#### A. 제공 데이터 항목
| 항목 | 파일/API 필드명 | 활용 용도 |
|------|---------------|----------|
| **설치위치위도** | latitude / LAT | GPS 좌표 |
| **설치위치경도** | longitude / LNG | GPS 좌표 |
| **설치목적** | purpose / CCTV_PURPS | 용도별 가중치 적용 |
| **관리기관명** | manageOrg / MANAGE_ORG | 신뢰도 평가 |
| **카메라대수** | cameraCount / CAMERA_CNT | 밀도 계산 |
| **소재지도로명주소** | roadAddress / ROAD_ADDR | 위치 확인 |

### 공공시설 위치정보 데이터 (20% 가중치)

* **공공데이터포털**: https://www.data.go.kr
* **검색 키워드**: '전국 소방서 현황', '전국 병원 현황', '전국 학교 현황'
* **제공 형태**: 각 기관별 개별 파일 또는 API
* **설명**: ⚠️ **실제 API 명세 미확인 상태 - 아래는 예상 구조입니다**

#### A. 예상 공공시설 데이터 구조
| 시설 유형 | 가중치 | 최적거리 | 예상 필드명 |
|----------|--------|----------|------------|
| **소방서** | 40% | 1km 이내 | stationName, latitude, longitude |
| **병원** | 40% | 500m 이내 | hospitalName, latitude, longitude |
| **학교** | 20% | 300m 이내 | schoolName, latitude, longitude |

---

## 3. API 연동 기술 명세

### 한국형사법무정책연구원 범죄통계 API 연동 명세

#### A. API 기본 설정 및 환경 구성

**필수 라이브러리 및 의존성:**
```xml
<!-- pom.xml (Maven 기준) -->
<dependencies>
    <!-- Spring Boot Web (HTTP 통신용) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webflux</artifactId>
    </dependency>
    
    <!-- Spring Boot Batch (배치 처리용) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-batch</artifactId>
    </dependency>
    
    <!-- Excel 파싱용 -->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-ooxml</artifactId>
    </dependency>
</dependencies>
```

**주요 Import 라이브러리:**
```java
// Spring 관련
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import org.springframework.scheduling.annotation.Scheduled;

// HTTP 통신 관련
import org.springframework.web.reactive.function.client.WebClient;
import org.springframework.web.client.RestTemplate;

// JSON 파싱 관련
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;

// Excel 파싱 관련 
import org.apache.poi.ss.usermodel.*;

// 시간 처리 (JDK 8+)
import java.time.LocalDate;

// 컬렉션 (JDK 기본 제공)
import java.util.*;
import java.util.stream.Collectors;
```

```yaml
# application.yml 설정
crime:
  api:
    service-key: ${CRIME_API_SERVICE_KEY:your-api-key}
    base-url: https://www.crimestats.or.kr/portal/openapi

taas:
  api:
    service-key: ${TAAS_API_SERVICE_KEY:your-api-key}
    base-url: http://apis.data.go.kr/B552061/AccidentDeath

traffic:
  cctv:
    service-key: ${TRAFFIC_CCTV_SERVICE_KEY:your-api-key}
    base-url: http://apis.data.go.kr/3068943/openapi/TrafficCCTV
```

#### B. 범죄통계 API 호출 구현

```java
/**
 * 한국형사법무정책연구원 범죄통계 API 호출
 */
@Component
public class CrimeStatsApiClient {
    
    private final WebClient webClient;
    
    @Value("${crime.api.service-key}")
    private String serviceKey;
    
    public CrimeStatsApiClient() {
        this.webClient = WebClient.builder()
                .baseUrl("https://www.crimestats.or.kr/portal/openapi")
                .build();
    }
    
    /**
     * 지역별 범죄통계 조회
     */
    public CrimeStatsResponse getCrimeStatistics(String areaCode, String year) {
        return webClient.get()
                .uri(uriBuilder -> uriBuilder
                        .path("/getCrimeStatsInfo")
                        .queryParam("serviceKey", serviceKey)
                        .queryParam("areaCode", areaCode)
                        .queryParam("year", year)
                        .queryParam("dataType", "JSON")
                        .build())
                .retrieve()
                .bodyToMono(CrimeStatsResponse.class)
                .block();
    }
}

/**
 * 범죄통계 API 응답 모델
 */
@Data
@JsonIgnoreProperties(ignoreUnknown = true)
public class CrimeStatsResponse {
    @JsonProperty("areaCode")
    private String areaCode;
    
    @JsonProperty("areaName") 
    private String areaName;
    
    @JsonProperty("murderCases")
    private int murderCases;
    
    @JsonProperty("robberyCases")
    private int robberyCases;
    
    @JsonProperty("sexualCrimeCases")
    private int sexualCrimeCases;
    
    @JsonProperty("theftCases")
    private int theftCases;
    
    @JsonProperty("violenceCases")
    private int violenceCases;
    
    @JsonProperty("population")
    private int population;
}
```

#### C. 교통사고 API 호출 구현

```java
/**
 * TAAS 교통사고분석시스템 API 호출
 */
@Component
public class TaasApiClient {
    
    private final RestTemplate restTemplate;
    
    @Value("${taas.api.service-key}")
    private String serviceKey;
    
    public TaasApiClient() {
        this.restTemplate = new RestTemplate();
    }
    
    /**
     * 사망교통사고 정보 조회
     */
    public List<TrafficAccidentResponse> getTrafficAccidents(String areaCode, String year) {
        String url = "http://apis.data.go.kr/B552061/AccidentDeath/getRestTrafficAccidentDeath";
        
        UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url)
                .queryParam("serviceKey", serviceKey)
                .queryParam("searchYear", year)
                .queryParam("siDo", extractSiDoFromAreaCode(areaCode))
                .queryParam("guGun", extractGuGunFromAreaCode(areaCode))
                .queryParam("type", "json")
                .queryParam("numOfRows", "1000")
                .queryParam("pageNo", "1");
        
        try {
            ResponseEntity<TaasApiResponse> response = restTemplate.getForEntity(
                    builder.toUriString(), TaasApiResponse.class);
            
            if (response.getStatusCode().is2xxSuccessful() && response.getBody() != null) {
                return response.getBody().getItems();
            }
            
            return Collections.emptyList();
            
        } catch (Exception e) {
            log.error("TAAS API 호출 실패", e);
            return Collections.emptyList();
        }
    }
}

/**
 * TAAS API 응답 모델
 */
@Data
@JsonIgnoreProperties(ignoreUnknown = true)
public class TrafficAccidentResponse {
    @JsonProperty("occrrncDt")
    private String accidentDate;
    
    @JsonProperty("dthDnvCnt")
    private int deathCount;
    
    @JsonProperty("injpsn_cnt")
    private int injuryCount;
    
    @JsonProperty("lo_crd")
    private double longitude;
    
    @JsonProperty("la_crd")
    private double latitude;
    
    @JsonProperty("acc_ty_cd")
    private String accidentType;
    
    @JsonProperty("dmgCas_cd")
    private String vehicleType;
}
```

#### D. 데이터 업데이트 스케줄 관리

```java
/**
 * 안전성 데이터 업데이트 스케줄러
 */
@Component
@EnableScheduling
public class SafetyDataScheduler {
    
    @Autowired
    private CrimeStatsApiClient crimeStatsApiClient;
    
    @Autowired
    private TaasApiClient taasApiClient;
    
    /**
     * 범죄 통계 데이터 업데이트 (월 1회)
     */
    @Scheduled(cron = "0 2 1 * *") // 매월 1일 새벽 2시
    public void updateCrimeStatistics() {
        log.info("범죄 통계 데이터 업데이트 시작");
        
        try {
            List<String> areaCodes = getAllAreaCodes();
            String currentYear = String.valueOf(LocalDate.now().getYear());
            
            for (String areaCode : areaCodes) {
                CrimeStatsResponse crimeData = crimeStatsApiClient.getCrimeStatistics(areaCode, currentYear);
                saveCrimeStatistics(areaCode, crimeData);
            }
            
            log.info("범죄 통계 데이터 업데이트 완료");
            
        } catch (Exception e) {
            log.error("범죄 통계 데이터 업데이트 실패", e);
        }
    }
    
    /**
     * 교통사고 데이터 업데이트 (주 1회)
     */
    @Scheduled(cron = "0 3 * * 1") // 매주 월요일 새벽 3시
    public void updateTrafficAccidentData() {
        log.info("교통사고 데이터 업데이트 시작");
        
        try {
            List<String> areaCodes = getAllAreaCodes();
            String currentYear = String.valueOf(LocalDate.now().getYear());
            
            for (String areaCode : areaCodes) {
                List<TrafficAccidentResponse> accidents = taasApiClient.getTrafficAccidents(areaCode, currentYear);
                saveTrafficAccidentData(areaCode, accidents);
            }
            
            log.info("교통사고 데이터 업데이트 완료");
            
        } catch (Exception e) {
            log.error("교통사고 데이터 업데이트 실패", e);
        }
    }
    
    /**
     * 안전성 점수 재계산 (월 1회)
     */
    @Scheduled(cron = "0 4 1 * *") // 매월 1일 새벽 4시
    public void recalculateSafetyScores() {
        log.info("안전성 점수 재계산 시작");
        
        List<String> areaCodes = getAllAreaCodes();
        for (String areaCode : areaCodes) {
            // 각 지역별로 안전성 점수 계산 로직 호출
            updateSafetyScoreForArea(areaCode);
        }
        
        log.info("안전성 점수 재계산 완료");
    }
}