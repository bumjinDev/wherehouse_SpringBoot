# 부동산 추천 시스템 데이터 연동 및 안전성 점수 구현 계획서

**프로젝트명:** Phase 2 추천 엔진 비즈니스 로직 설계 - 데이터 연동 부문  
**버전:** 2.1  
**작성일:** 2025.08.20  
**기반 문서:** 프로젝트 개선 기획서 3.1항목 (사용자 입력 데이터 처리 설계)  

---

## 📋 목차

1. [데이터 연동 전략 개요](#1-데이터-연동-전략-개요)
2. [부동산 데이터 소스 구현](#2-부동산-데이터-소스-구현)
3. [안전성 점수 계산 시스템](#3-안전성-점수-계산-시스템)
4. [2단계 폴백 시스템 데이터 연동](#4-2단계-폴백-시스템-데이터-연동)
5. [API 연동 세부 명세](#5-api-연동-세부-명세)
6. [개발 일정 및 우선순위](#6-개발-일정-및-우선순위)

---

## 1. 데이터 연동 전략 개요

### 1.1 현재 상황 분석

기존 프로젝트 기획서 3.1항목에서 설계된 **2단계 폴백 시스템**의 핵심 비즈니스 로직 구현을 위해 다음 데이터가 필수적으로 요구됨:

```
1단계: 기본 조건 매물 확보
├── 매물 데이터 (가격, 평수, 지역, 건물유형)
├── 실거래가 정보
└── 기본 필터링 조건

2단계: 우선순위별 점수 계산
├── 가격우선: 가성비 점수 (시세 대비 가격)
├── 안전우선: 안전도 점수 (종합 안전 지표)
└── 평수우선: 공간효율 점수 (평당 활용도)
```

### 1.2 데이터 연동 원칙

| 원칙 | 내용 | 구현 방법 |
|------|------|-----------|
| **신뢰성 우선** | 공공데이터 중심, 민간데이터 보조 | 국토교통부 API 메인, 크롤링 최소화 |
| **단계적 구현** | 1순위→2순위→3순위 순차 개발 | MVP → 확장형 구조 |
| **성능 최적화** | 캐싱 전략 + 비동기 처리 | Redis + 병렬 API 호출 |
| **장애 대응** | 폴백 메커니즘 내장 | 기본값 + 대체 데이터 소스 |

---

## 2. 부동산 데이터 소스 구현

### 2.1 1순위: 국토교통부 실거래가 API

#### A. 기본 매물 데이터 수집
```javascript
// 국토교통부 아파트 실거래가 API
const MOLIT_APIs = {
  apartmentSale: 'http://apis.data.go.kr/1613000/RTMSDataSvcAptTradeDev/getRTMSDataSvcAptTradeDev',
  apartmentRent: 'http://apis.data.go.kr/1613000/RTMSDataSvcRentDev/getRTMSDataSvcRentDev',
  officetelSale: 'http://apis.data.go.kr/1613000/RTMSDataSvcOffiTradeDev/getRTMSDataSvcOffiTradeDev',
  officetelRent: 'http://apis.data.go.kr/1613000/RTMSDataSvcOffiRentDev/getRTMSDataSvcOffiRentDev'
};
```

#### B. 제공 데이터 항목 (실거래가 API)
| 항목 | 필드명 | 활용 용도 | 비고 |
|------|--------|----------|------|
| **아파트명** | 아파트 | 매물 식별 | 필수 |
| **거래금액** | 거래금액 | 가격우선 점수 계산 | 쉼표 제거 필요 |
| **전용면적** | 전용면적 | 평수우선 점수 계산 | 평수 변환 (÷3.3) |

#### C. 월세 데이터 처리
```javascript
// 전월세 데이터 표준화
function normalizeRentData(rentData) {
  const { 보증금, 월세, 전용면적 } = rentData;
  
  // 전월세 전환율 적용 (지역별 차등)
  const conversionRate = getRegionalConversionRate(rentData.법정동);
  const equivalent전세 = parseInt(보증금) + (parseInt(월세) * 12 * conversionRate);
  
  return {
    매물유형: '전월세',
    환산가격: equivalent전세,
    월세: parseInt(월세),
    보증금: parseInt(보증금),
    평수: parseFloat(전용면적) / 3.3
  };
}
```

### 2.2 2순위: 한국부동산원 통계 API

#### A. 가격 동향 및 시세 정보
```javascript
const REB_APIs = {
  priceIndex: 'https://www.reb.or.kr/r-one/portal/openapi/priceIndex',
  marketTrend: 'https://www.reb.or.kr/r-one/portal/openapi/marketTrend',
  transactionVolume: 'https://www.reb.or.kr/r-one/portal/openapi/volume'
};

// 활용 목적: 지역별 시세 기준 설정, 가성비 점수 계산
```

#### B. 지역별 시세 정보 활용
| 정보 유형 | API 제공 내용 | 활용 방안 |
|----------|---------------|----------|
| **가격지수** | 전국/지역별 주택가격 동향 | 지역 평균 시세 산출 |
| **거래량** | 월별 거래 건수 | 시장 활성도 반영 |
| **전월세율** | 지역별 전월세 전환율 | 월세→전세 환산 |

### 2.3 3순위: 서울시 열린데이터 (지역 특화)

#### A. 서울시 부동산 특화 데이터
```javascript
const SEOUL_APIs = {
  realEstate: 'http://openapi.seoul.go.kr:8088/[키]/json/서울시부동산실거래가정보',
  apartmentInfo: 'http://openapi.seoul.go.kr:8088/[키]/json/서울시공동주택아파트정보',
  brokerInfo: 'http://openapi.seoul.go.kr:8088/[키]/json/서울시부동산중개업소정보'
};
```

#### B. 서울시 데이터 활용 계획
- **세부 지역 정보**: 동별 상세 매물 정보
- **중개업소 정보**: 신뢰도 있는 매물 검증
- **실시간 전월세**: 국토부 데이터 보완

---

## 3. 안전성 점수 계산 시스템

### 3.1 안전성 점수 구성 요소

기존 기획서 **"안전우선형 확장 전략"**에서 요구하는 안전도 점수를 다음과 같이 구성:

```javascript
const safetyScoreWeights = {
  crimeRate: 0.40,        // 범죄율 40% (경찰청 데이터)
  trafficSafety: 0.25,    // 교통안전 25% (TAAS 데이터)
  cctvDensity: 0.15,      // CCTV밀도 15% (행안부 데이터)
  infrastructure: 0.20    // 공공시설 접근성 20% (복합)
};
```

### 3.2 범죄 안전도 데이터 소스

#### A. 경찰청 범죄통계 API
```javascript
const CRIME_APIs = {
  regionalStats: 'https://www.data.go.kr/data/3074462/fileData.do',
  bigdataPolicing: 'https://www.bigdata-policing.kr/api',
  crimeDensity: 'https://www.data.go.kr/dataset/15013094'
};

// 제공 데이터: 5대 범죄(살인, 강도, 강간, 절도, 폭력) 시군구별 통계
```

#### B. 범죄율 점수 계산 로직
```javascript
function calculateCrimeScore(lawdCd) {
  const crimeData = await fetchCrimeStatistics(lawdCd);
  
  // 인구 10만명당 범죄율 계산
  const crimeRate = (crimeData.totalCrimes / crimeData.population) * 100000;
  const nationalAverage = 2500; // 전국 평균
  
  // 상대적 안전도 (낮을수록 안전)
  const relativeRate = crimeRate / nationalAverage;
  let score = Math.max(0, 100 - (relativeRate * 50));
  
  // 강력범죄 가중치 적용
  if (crimeData.violentCrimeRate > 100) score -= 10;
  
  return Math.max(0, Math.min(100, score));
}
```

### 3.3 교통안전 데이터 소스

#### A. 교통사고분석시스템 (TAAS) API
```javascript
const TRAFFIC_APIs = {
  accidentStats: 'https://taas.koroad.or.kr/web/api/accident-stats',
  hotspots: 'https://www.data.go.kr/data/15003493/openapi.do',
  schoolZone: 'https://taas.koroad.or.kr/web/api/school-zone-safety'
};

// 제공 데이터: 지역별 교통사고 발생률, 사고다발지역, 스쿨존 안전도
```

#### B. 교통안전 점수 계산
| 지표 | 가중치 | 데이터 소스 | 계산 방법 |
|------|--------|-------------|----------|
| **사고발생률** | 60% | TAAS | km당 사고수 / 전국평균 |
| **사망사고율** | 25% | TAAS | 사망사고 비율 |
| **사고다발지역** | 10% | TAAS | 반경 500m 내 다발지역 여부 |
| **스쿨존안전** | 5% | TAAS | 어린이보호구역 안전도 |

### 3.4 CCTV 밀도 데이터 소스

#### A. 전국 CCTV 표준데이터 API
```javascript
const CCTV_APIs = {
  nationalCCTV: 'https://www.data.go.kr/data/15013094/standard.do',
  seoulCCTV: 'https://data.seoul.go.kr/dataList/OA-2734/F/1/datasetView.do'
};

// 제공 데이터: 설치위치(위경도), 설치목적, 관리기관, 카메라대수
```

#### B. CCTV 점수 계산 로직
```javascript
function calculateCCTVScore(coordinates) {
  const cctvData = await fetchCCTVData(coordinates, 500); // 반경 500m
  
  // 용도별 가중치 적용
  let weightedCount = 0;
  cctvData.forEach(cctv => {
    switch(cctv.purpose) {
      case '범죄예방': weightedCount += 1.5; break;
      case '교통정보': weightedCount += 1.0; break;
      case '시설보안': weightedCount += 0.8; break;
    }
  });
  
  // 최적 밀도: 반경 500m당 8-15대
  if (weightedCount >= 8 && weightedCount <= 15) return 100;
  if (weightedCount > 15) return 90; // 과밀도
  return Math.max(30, weightedCount * 10);
}
```

### 3.5 공공시설 접근성 데이터 소스

#### A. 공공시설 위치정보 API
```javascript
const FACILITY_APIs = {
  fireStations: 'https://www.data.go.kr/data/15048243/fileData.do',
  hospitals: 'https://www.data.go.kr/api/hospital-finder',
  schools: 'https://schoolzone.emac.kr/publicData/dataInfo.do',
  police: 'https://www.data.go.kr/data/police-stations'
};
```

#### B. 접근성 점수 매트릭스
| 시설 유형 | 가중치 | 최적거리 | 점수 기준 |
|----------|--------|----------|----------|
| **소방서** | 40% | 1km 이내 | 1km(100점) / 2km(80점) / 3km(60점) |
| **병원** | 40% | 500m 이내 | 500m(100점) / 1km(80점) / 2km(60점) |
| **학교** | 20% | 300m 이내 | 300m(100점) / 800m(80점) / 1.5km(60점) |

---

## 4. 2단계 폴백 시스템 데이터 연동

### 4.1 1단계: 기본 조건 매물 확보

#### A. 통합 검색 조건 처리
```javascript
class BasicSearchCondition {
  constructor(userInput) {
    this.minBudget = userInput.minBudget;
    this.maxBudget = userInput.maxBudget;
    this.minArea = userInput.minArea;
    this.maxArea = userInput.maxArea;
    this.district = userInput.district;
    this.propertyType = userInput.propertyType; // 아파트/오피스텔
    this.rentalType = userInput.rentalType;     // 매매/전세/월세
  }
  
  async findBasicMatches() {
    // 국토교통부 API 호출
    const lawdCd = this.getLawdCode(this.district);
    const dealYmd = this.getRecentMonths(3); // 최근 3개월
    
    const properties = await Promise.all([
      this.fetchApartmentData(lawdCd, dealYmd),
      this.fetchOfficetelData(lawdCd, dealYmd)
    ]);
    
    return this.filterByConditions(properties.flat());
  }
}
```

### 4.2 우선순위별 점수 계산 데이터 연동

#### A. 가격우선형 점수 계산
```javascript
async function calculatePriceScore(property) {
  // 1. 지역 평균 시세 조회 (한국부동산원 API)
  const marketData = await fetchMarketTrend(property.lawdCd);
  const regionAverage = marketData.averagePrice;
  
  // 2. 가성비 점수 계산
  const pricePerArea = property.price / property.area;
  const avgPricePerArea = regionAverage / property.area;
  const costEfficiency = avgPricePerArea / pricePerArea;
  
  return Math.min(100, costEfficiency * 50);
}
```

#### B. 안전우선형 점수 계산
```javascript
async function calculateSafetyScore(property) {
  const coordinates = await getCoordinates(property.address);
  
  const [crime, traffic, cctv, infrastructure] = await Promise.all([
    getCrimeScore(property.lawdCd),
    getTrafficSafetyScore(property.lawdCd),
    getCCTVScore(coordinates),
    getInfrastructureScore(coordinates)
  ]);
  
  return (crime * 0.4) + (traffic * 0.25) + (cctv * 0.15) + (infrastructure * 0.2);
}
```

### 4.3 2단계: 확장 검색 데이터 처리

#### A. 우선순위별 확장 로직
```javascript
async function expandSearchByPriority(originalCondition, priorityType) {
  const expandedCondition = { ...originalCondition };
  
  switch(priorityType) {
    case 'PRICE_PRIORITY':
      // 예산 10% 확장 → 안전 임계값 완화 → 평수 완화
      expandedCondition.maxBudget *= 1.1;
      expandedCondition.minSafetyScore = 40; // 기본 50에서 완화
      break;
      
    case 'SAFETY_PRIORITY':
      // 예산 15% 확장 → 평수 타협 → 지역 확장 (안전 기준 유지)
      expandedCondition.maxBudget *= 1.15;
      expandedCondition.minArea *= 0.9;
      expandedCondition.adjacentDistricts = true;
      expandedCondition.minSafetyScore = 70; // 절대 유지
      break;
      
    case 'AREA_PRIORITY':
      // 예산 12% 확장 → 위치 타협 (절대 최소평수 유지)
      expandedCondition.maxBudget *= 1.12;
      expandedCondition.adjacentDistricts = true;
      // minArea는 절대 변경하지 않음
      break;
  }
  
  return await findPropertiesWithExpandedCondition(expandedCondition);
}
```

---

## 5. API 연동 세부 명세

### 5.1 국토교통부 API 연동 명세

#### A. 아파트 실거래가 API
```javascript
const MOLIT_CONFIG = {
  baseURL: 'http://apis.data.go.kr/1613000/RTMSDataSvcAptTradeDev',
  endpoint: '/getRTMSDataSvcAptTradeDev',
  serviceKey: process.env.DATA_GO_KR_API_KEY,
  rateLimit: '1000/day', // 개발계정 기준
  responseFormat: 'XML'
};

// 요청 파라미터
const requestParams = {
  LAWD_CD: '11680',     // 법정동코드 5자리
  DEAL_YMD: '202501',   // 계약년월 6자리
  numOfRows: '1000'     // 한 페이지당 결과 수
};
```

#### B. 응답 데이터 파싱
```javascript
function parseRealEstateXML(xmlData) {
  const items = xmlData.getElementsByTagName('item');
  return Array.from(items).map(item => ({
    아파트명: getTextContent(item, '아파트'),
    거래금액: parseInt(getTextContent(item, '거래금액').replace(/,/g, '')),
    전용면적: parseFloat(getTextContent(item, '전용면적')),
    층: getTextContent(item, '층'),
    건축년도: parseInt(getTextContent(item, '건축년도')),
    법정동: getTextContent(item, '법정동'),
    거래일: buildDateString(item)
  }));
}
```

### 5.2 안전성 데이터 API 연동

#### A. 경찰청 범죄통계 API
```javascript
const CRIME_CONFIG = {
  // 파일 데이터 형태로 제공
  dataSource: 'https://www.data.go.kr/data/3074462/fileData.do',
  updateCycle: 'annual', // 연 1회 업데이트
  format: 'CSV/Excel',
  
  // 처리 방식
  processingMethod: 'batch_download_and_cache'
};

// 데이터 전처리 및 캐싱
async function processCrimeData() {
  const rawData = await downloadCrimeStatistics();
  const processedData = rawData.map(row => ({
    시군구코드: row.lawdCd,
    총범죄수: parseInt(row.totalCrimes),
    강력범죄수: parseInt(row.violentCrimes),
    인구수: parseInt(row.population),
    범죄율: (parseInt(row.totalCrimes) / parseInt(row.population)) * 100000
  }));
  
  await cacheToRedis('crime_stats', processedData, '1year');
}
```

#### B. TAAS 교통사고 API
```javascript
const TAAS_CONFIG = {
  baseURL: 'https://taas.koroad.or.kr/data/rest',
  endpoints: {
    accidentStats: '/statisticsData/getStatistics',
    hotspots: '/frequentzone/getFrequentZone',
    schoolZone: '/schoolzone/getSchoolZoneData'
  },
  authKey: process.env.TAAS_API_KEY,
  rateLimit: '500/day'
};
```

### 5.3 데이터 통합 및 캐싱 전략

#### A. Redis 캐싱 구조
```javascript
const CACHE_STRATEGY = {
  // 실거래가 데이터 (월 1회 업데이트)
  'real_estate:{lawdCd}:{yearMonth}': {
    ttl: '30days',
    data: 'compressed_property_list'
  },
  
  // 안전성 점수 (주 1회 업데이트)
  'safety_score:{lawdCd}': {
    ttl: '7days',
    data: 'calculated_safety_metrics'
  },
  
  // 시세 정보 (일 1회 업데이트)
  'market_trend:{lawdCd}': {
    ttl: '1day',
    data: 'price_index_and_trends'
  }
};
```

#### B. 데이터 동기화 스케줄
```javascript
const SYNC_SCHEDULE = {
  // 매일 새벽 2시: 시세 정보 업데이트
  '0 2 * * *': 'updateMarketTrends()',
  
  // 매주 일요일 새벽 3시: 안전성 데이터 업데이트
  '0 3 * * 0': 'updateSafetyData()',
  
  // 매월 1일 새벽 4시: 실거래가 데이터 업데이트
  '0 4 1 * *': 'updateRealEstateData()',
  
  // 매년 1월 1일: 법정동코드 매핑 업데이트
  '0 5 1 1 *': 'updateLawdCodeMapping()'
};
```

---

## 6. 개발 일정 및 우선순위

### 6.1 2주 개발 일정 (상세)

#### Week 1: 핵심 데이터 연동 (1순위)

| 일차 | 작업 내용 | 담당자 | 산출물 |
|------|-----------|--------|--------|
| **Day 1-2** | 국토교통부 API 연동 | 백엔드 | 실거래가 데이터 수집 모듈 |
| **Day 3** | 법정동코드 매핑 구축 | 백엔드 | 지역 코드 변환 시스템 |
| **Day 4-5** | 기본 필터링 로직 구현 | 백엔드 | 1단계 매물 검색 기능 |
| **Day 6-7** | 우선순위별 점수 계산 | 백엔드 | 가격/평수 우선순위 점수 |

#### Week 2: 안전성 시스템 및 확장 기능 (2순위)

| 일차 | 작업 내용 | 담당자 | 산출물 |
|------|-----------|--------|--------|
| **Day 8-9** | 범죄/교통 데이터 연동 | 백엔드 | 안전성 기초 데이터 |
| **Day 10-11** | 안전성 점수 계산 시스템 | 백엔드 | 안전우선 점수 알고리즘 |
| **Day 12-13** | 2단계 확장 검색 구현 | 백엔드 | 폴백 시스템 완성 |
| **Day 14** | 통합 테스트 및 최적화 | 전체 | 완성된 추천 시스템 |

### 6.2 개발 우선순위 매트릭스

| 우선순위 | 기능 | 비즈니스 임팩트 | 기술적 복잡도 | 개발 기간 |
|----------|------|----------------|---------------|----------|
| **P0** | 국토교통부 API 연동 | ⭐⭐⭐⭐⭐ | ⭐⭐ | 2일 |
| **P0** | 기본 매물 필터링 | ⭐⭐⭐⭐⭐ | ⭐⭐ | 2일 |
| **P1** | 가격/평수 우선순위 점수 | ⭐⭐⭐⭐ | ⭐⭐⭐ | 2일 |
| **P1** | 2단계 확장 검색 | ⭐⭐⭐⭐ | ⭐⭐⭐ | 2일 |
| **P2** | 안전성 점수 계산 | ⭐⭐⭐ | ⭐⭐⭐⭐ | 4일 |
| **P3** | 고급 캐싱 시스템 | ⭐⭐ | ⭐⭐⭐ | 2일 |

---

**문서 승인**

| 역할 | 이름 | 서명 | 날짜 |
|------|------|------|------|
| **작성자** | 개발팀 | ✓ | 2025.08.20 |
| **검토자** | PM | ✓ | 2025.08.20 |
| **승인자** | CTO | ✓ | 2025.08.20 |

---

**첨부 자료**
- A. API 연동 상세 코드 예제
- B. 데이터베이스 스키마 설계서  
- C. 성능 테스트 계획서
- D. 법정동코드 매핑 테이블