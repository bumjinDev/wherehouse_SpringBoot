# 상세지도 서비스 성능 개선 프로젝트 실행 계획서
## Performance Improvement Project Execution Plan

**문서 정보**
- 문서 유형: 실행 계획서 (Execution Plan)
- 문서 버전: 1.0
- 작성일: 2025-01-23
- 작성자: 정범진
- 프로젝트: Wherehouse 상세지도 서비스 성능 최적화
- 프로젝트 기간: 2025-01-23 (목) ~ 2025-01-31 (금) (7 평일)

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [전체 일정 요약](#2-전체-일정-요약)
3. [단계별 상세 계획](#3-단계별-상세-계획)
4. [산출물 목록](#4-산출물-목록)
5. [참고 자료](#5-참고-자료)

---

## 1. 프로젝트 개요

### 1.1. 프로젝트 목표

`POST /api/location-analysis` API의 성능 병목을 식별하고 개선하여, 평균 응답 시간 500ms 이하를 달성한다.

### 1.2. 성공 기준

| 지표 | 현재 (추정) | 목표 |
|------|------------|------|
| 평균 응답 시간 | ~2,000ms | ≤ 500ms |
| 95th Percentile | ~2,800ms | ≤ 1,000ms |
| TPS | ~25 | ≥ 50 |

### 1.3. 프로젝트 단계

**1단계: 현상 분석 (As-Is) 및 계측 수립 (Day 1-2)**
- Baseline 성능 측정
- 병목 지점 식별

**2단계: 개선 및 개선 작업 (Refactoring) (Day 3-4)**
- 병목 개선 코드 작성
- 단위 테스트 및 리팩토링

**3단계: 검증 (To-Be) 및 보고서 작성 (Day 5-7)**
- 개선 효과 검증
- 최종 보고서 작성 및 정리

---

## 2. 전체 일정 요약

| Day | 날짜 | 단계 | 주요 작업 | 산출물 |
|-----|------|------|----------|--------|
| **Day 1** | 01/23 (목) | As-Is 분석 (1/2) | 테스트 환경 구성, Python 스크립트 작성 | performance_analyzer.py, JMeter 테스트 계획 |
| **Day 2** | 01/24 (금) | As-Is 분석 (2/2) | Baseline 측정, 병목 식별 | As-Is performance.log, 병목 분석 자료 (CSV/Excel) |
| **Day 3** | 01/27 (월) | 개선 (1/2) | 최우선 병목 개선 + 추가 개선 시작 | DB 최적화 코드, 캐시 개선 코드 (일부) |
| **Day 4** | 01/28 (화) | 개선 (2/2) | 나머지 개선 완료 + 리팩토링 + 통합 테스트 | 최종 Service 코드, 통합 테스트 로그 |
| **Day 5** | 01/29 (수) | To-Be 검증 + 문서화 (1/3) | To-Be 측정, 비교 분석, 보고서 기본 틀 작성 | To-Be 로그, 비교 차트, 보고서 뼈대 |
| **Day 6** | 01/30 (목) | 문서화 (2/3) | 보고서 본문 작성 (병목 분석 및 개선 내용) | 보고서 초안 (80% 완성) |
| **Day 7** | 01/31 (금) | 문서화 (3/3) + 최종 점검 | 보고서 최종본, 포트폴리오 자료, 코드 정리 | 성능 분석 보고서 최종본, README.md |

**총 기간: 7 평일 (주말 제외)**

---

## 3. 단계별 상세 계획

### Day 1 (2025-01-23, 목): As-Is 분석 (1/2) - 환경 구성

#### 3.1.1. 작업 목표

테스트 환경을 구성하고 성능 측정을 위한 도구를 준비한다.

#### 3.1.2. 세부 작업

**1. JMeter 테스트 계획 수립**
- 시나리오 1 (Cache Miss): 단일 사용자, 50회 반복
- 시나리오 2 (Cache Hit): 단일 사용자, 50회 반복, 동일 좌표
- 시나리오 4 (Mixed Workload): 10명 사용자, 5분 지속
- JMeter .jmx 파일 작성

**2. Python 분석 스크립트 작성**
- 로그 파일 파싱 (JSON → DataFrame)
- Step별 집계 (평균, 중앙값, 95th percentile)
- Action별 상세 분석
- 시각화 차트 생성 (Matplotlib)

**파일명:** `performance_analyzer.py`

**주요 기능:**
```python
# 1. 로그 파싱
def parse_performance_log(log_file_path)

# 2. Step별 분석
def analyze_by_step(df)

# 3. Action별 분석 (특정 Step 내부)
def analyze_by_action(df, step)

# 4. 시각화
def plot_step_duration(df)
def plot_before_after_comparison(df_before, df_after)
```

**3. 스크립트 검증**
- 샘플 로그로 스크립트 동작 확인
- JSON 파싱 오류 수정
- 차트 생성 테스트

#### 3.1.3. 산출물

- `performance_test_plan.jmx` (JMeter 테스트 계획)
- `performance_analyzer.py` (Python 분석 스크립트)
- `requirements.txt` (pandas, matplotlib 등 의존성)

#### 3.1.4. 완료 기준

- JMeter에서 단일 요청 실행 가능
- Python 스크립트로 샘플 로그 분석 가능
- 차트 생성 확인

---

### Day 2 (2025-01-24, 금): As-Is 분석 (2/2) - Baseline 측정

#### 3.2.1. 작업 목표

현재 시스템(As-Is)의 성능을 측정하고 병목 지점을 식별한다.

#### 3.2.2. 세부 작업

**1. 시나리오 1 (Cache Miss) 실행**
- Redis FLUSHALL로 캐시 초기화
- JMeter로 50회 요청 실행
- `performance.log` 수집
- 로그 백업: `logs/as-is/scenario1_cache_miss.log`

**2. 시나리오 2 (Cache Hit) 실행**
- 동일 좌표로 50회 요청
- 로그 수집 및 백업

**3. 시나리오 4 (Mixed) 실행**
- 100개 랜덤 좌표 CSV 준비
- 10명 사용자, 5분 지속
- 로그 수집 및 백업

**4. Python 분석 실행**
```bash
python performance_analyzer.py \
  --input logs/as-is/scenario1_cache_miss.log \
  --output results/as-is/
```

**생성 파일:**
- `step_summary.csv` (Step별 평균/중앙/95th)
- `action_detail.csv` (Action별 상세)
- `step_duration_chart.png` (막대 그래프)
- `step_ratio_pie.png` (비율 파이 차트)

**5. 병목 식별**
- Step별 데이터 검토 및 비율 분석
- 가장 높은 비율을 차지하는 Step 식별
- 해당 Step 내부 Action 상세 분석
- 병목 지점 확정 (예상: B-01, B-03, B-04 등)

**6. 보고서 초안 데이터 입력**
- Baseline 측정 결과를 엑셀에 정리
- 주요 수치 기록 (평균, 95th, TPS 등)

#### 3.2.3. 산출물

- `logs/as-is/` 폴더 (3개 시나리오 로그)
- `results/as-is/` 폴더 (CSV, 차트)
- `baseline_summary.xlsx` (병목 분석 요약)

#### 3.2.4. 완료 기준

- 3개 시나리오 모두 50개 이상 요청 로그 수집
- Step별 평균 시간 산출 완료
- 병목 지점 식별 및 우선순위 결정

---

### Day 3 (2025-01-27, 월): 개선 (1/2) - 주요 병목 개선

#### 3.3.1. 작업 목표

식별된 최우선 순위 병목을 개선하고, 추가 병목 개선을 시작한다.

#### 3.3.2. 세부 작업

**파트 1: 최우선 병목 개선**

**1. DB 최적화 방안 결정**
- Day 2에서 식별된 최우선 병목 쿼리 분석
- 실행 계획(Execution Plan) 확인
- 개선 방안 선택 (인덱스 추가, 쿼리 재작성 등)

**2. DB 스키마 변경**
- 필요시 컬럼 추가 또는 인덱스 생성
- 데이터 업데이트 스크립트 작성
- 통계 정보 갱신

**예시 작업:**
```sql
-- 예시: Geohash 기반 개선 시
ALTER TABLE police_office_geo 
ADD geohash_id VARCHAR2(10);

-- 인덱스 생성
CREATE INDEX idx_police_geo_geohash 
ON police_office_geo(geohash_id);

-- 통계 업데이트
EXEC DBMS_STATS.GATHER_TABLE_STATS('YOUR_SCHEMA', 'POLICE_OFFICE_GEO');
```

**3. Repository/Service 수정**
- 쿼리 최적화 또는 필터링 로직 추가
- 필요시 Native Query 재작성
- Service 레이어 변경 사항 반영

**4. 단위 테스트 및 검증**
- 변경된 메서드 테스트 케이스 작성
- 로컬에서 개선 효과 확인

---

**파트 2: 2차 병목 개선 시작**

**5. 2차 병목 분석 및 개선 방안 수립**
- Day 2에서 식별된 2순위 병목 검토 (예: 캐시 N+1 조회)
- 개선 방안 설계

**6. 캐시 최적화 구현**

**예시: Redis 배치 조회**
```java
// 배치 조회 메서드 추가
public <T> Map<String, T> getMultipleData(List<String> keys) {
    List<Object> results = redisTemplate.executePipelined(
        new SessionCallback<Object>() {
            @Override
            public Object execute(RedisOperations operations) {
                for (String key : keys) {
                    operations.opsForValue().get(key);
                }
                return null;
            }
        }
    );
    // 결과 매핑
}
```

- Service에서 반복 조회 → 배치 조회로 변경
- 단위 테스트 작성

#### 3.3.3. 산출물

- DB 마이그레이션 스크립트 (예: `V1__optimize_query.sql`)
- 수정된 Repository 파일
- 캐시 최적화 Service 코드 (일부)
- 단위 테스트 코드

#### 3.3.4. 완료 기준

- 최우선 병목 개선 완료 (DB 인덱스/쿼리 최적화)
- 2차 병목 개선 50% 이상 진행 (캐시 최적화 시작)
- 단위 테스트 통과
- 로컬 테스트에서 주요 개선 효과 확인

---

### Day 4 (2025-01-28, 화): 개선 (2/2) - 개선 완료 및 리팩토링

#### 3.4.1. 작업 목표

나머지 병목 개선을 완료하고 전체 코드를 리팩토링한 후 통합 테스트를 수행한다.

#### 3.4.2. 세부 작업

**파트 1: 나머지 병목 개선 완료**

**1. Day 3에서 시작한 캐시 최적화 완료**
- Redis 배치 쓰기 메서드 추가
- Service 전체 구간에 배치 처리 적용
- 단위 테스트 작성

**예시: Redis 배치 쓰기**
```java
public <T> void setMultipleData(Map<String, T> dataMap, Duration ttl) {
    redisTemplate.executePipelined(
        new SessionCallback<Object>() {
            @Override
            public Object execute(RedisOperations operations) {
                for (Map.Entry<String, T> entry : dataMap.entrySet()) {
                    operations.opsForValue().set(
                        entry.getKey(), 
                        entry.getValue(), 
                        ttl
                    );
                }
                return null;
            }
        }
    );
}
```

**2. 추가 개선 사항 처리 (필요시)**
- 비동기 처리 검증 및 최적화
- 불필요한 연산 제거

---

**파트 2: 전체 코드 리팩토링**

**3. 코드 품질 개선**
- 주석 정리 및 가독성 향상
- 불필요한 코드 제거
- 메서드 분리 및 책임 명확화
- 변수명 및 메서드명 일관성 확보

**4. 코드 리뷰 준비**
- Commit 메시지 정리
- 변경 사항 문서화

---

**파트 3: 통합 테스트**

**5. 전체 시나리오 테스트**
- 로컬 환경에서 시나리오 1 실행 (Cache Miss)
- 전체 응답 시간 확인
- 각 Step별 시간 로그 검토

**6. 목표 달성 여부 확인**
- 평균 응답 시간이 목표(500ms) 이하인지 확인
- 문제 발견 시 즉시 수정

#### 3.4.3. 산출물

- 최종 Service 구현 파일 (모든 개선 적용)
- 전체 단위 테스트 코드
- 통합 테스트 로그

#### 3.4.4. 완료 기준

- 모든 병목 개선 완료
- 코드 리팩토링 완료
- 단위 테스트 모두 통과
- 통합 테스트에서 목표 응답 시간 달성 (500ms 이하 예상)

---

### Day 5 (2025-01-29, 수): To-Be 검증 및 문서화 (1/3)

#### 3.5.1. 작업 목표

개선된 시스템(To-Be)의 성능을 측정하고 As-Is와 비교 분석한 후, 보고서 작성을 시작한다.

#### 3.5.2. 세부 작업

**파트 1: To-Be 성능 측정**

**1. 시나리오 1 측정 (Cache Miss)**
- Redis FLUSHALL로 캐시 초기화
- JMeter로 50회 요청 실행
- 로그 수집: `logs/to-be/scenario1_cache_miss.log`

**2. 시나리오 2, 4 측정**
- 시나리오 2 (Cache Hit) 실행
- 시나리오 4 (Mixed Workload) 실행
- 로그 수집 및 백업

---

**파트 2: 비교 분석**

**3. Python 분석 실행**
```bash
python performance_analyzer.py \
  --input logs/to-be/scenario1_cache_miss.log \
  --output results/to-be/

python performance_analyzer.py \
  --mode compare \
  --before logs/as-is/scenario1_cache_miss.log \
  --after logs/to-be/scenario1_cache_miss.log \
  --output results/comparison/
```

**4. As-Is vs To-Be 비교 표 작성**
- 주요 지표 비교 (평균, 95th, TPS)
- Step별 개선 효과 분석
- 병목별 개선 시간 계산
- 차트 생성 (before_after_chart.png)

---

**파트 3: 보고서 기본 틀 작성**

**5. 보고서 구조 설계**
- Executive Summary
- 테스트 개요
- Baseline 측정 결과
- 병목 분석 및 개선
- 종합 개선 효과
- 결론 및 권고사항

**6. 데이터 정리**
- 측정 데이터를 보고서 형식으로 정리
- 주요 차트 삽입 준비
- 수치 검증

#### 3.5.3. 산출물

- `logs/to-be/` 폴더 (3개 시나리오 로그)
- `results/comparison/` 폴더 (비교 차트, CSV)
- 보고서 기본 틀 (목차 + Executive Summary)

#### 3.5.4. 완료 기준

- To-Be 측정 데이터 수집 완료
- As-Is vs To-Be 비교 분석 완료
- 목표 달성 여부 확인 (평균 ≤500ms, 95th ≤1000ms, TPS ≥50)
- 보고서 기본 구조 완성

---

### Day 6 (2025-01-30, 목): 문서화 (2/3) - 보고서 본문 작성

#### 3.6.1. 작업 목표

보고서의 핵심 내용인 병목 분석 및 개선 과정을 상세히 작성한다.

#### 3.6.2. 세부 작업

**1. Baseline 측정 결과 작성**
- 전체 성능 지표 표
- Step별 분석 표 및 차트
- Action별 상세 분석
- 병목 정량화

**2. 병목별 분석 및 개선 작성**

**각 병목마다 다음 구조로 작성:**
- 문제 정의 (증상, 측정 데이터)
- 원인 분석 (실행 계획, 로그 분석)
- 개선 방안 선택 (대안 검토, 선택 근거)
- 구현 내용 (코드 스니펫, 주요 변경)
- 효과 검증 (Before/After 수치)

**작성 순서:**
- 최우선 병목 (예: DB 쿼리)
- 2순위 병목 (예: Redis N+1 조회)
- 3순위 병목 (예: Redis N+1 쓰기)

**3. 종합 개선 효과 작성**
- Before/After 비교 표
- Step별 개선 효과
- 병목별 기여도 분석
- 비용 절감 효과

#### 3.6.3. 산출물

- 보고서 초안 (약 80% 완성)
  - 1~5장 완성 (Executive Summary ~ 종합 개선 효과)
  - 6~7장 미완성 (결론 및 권고사항, 부록)

#### 3.6.4. 완료 기준

- 병목 분석 및 개선 챕터 완성
- 모든 차트 및 표 삽입 완료
- 코드 스니펫 포함
- 수치 일관성 확인

---

### Day 7 (2025-01-31, 금): 문서화 (3/3) 및 최종 점검

#### 3.7.1. 작업 목표

보고서를 최종 완성하고 포트폴리오 자료를 준비한 후, 전체 프로젝트를 마무리한다.

#### 3.7.2. 세부 작업

**파트 1: 보고서 나머지 챕터 작성**

**1. 종합 개선 효과 보완**
- Step별 Before/After 시각화 추가
- 병목별 기여도 분석 그래프
- 시나리오별 성능 검증 결과 (Cache Hit/Mixed)
- 비용 절감 효과 계산

**2. 결론 작성**
- 핵심 성과 3가지 요약
- 프로젝트를 통해 배운 점 (Lessons Learned)
  - 측정 기반 의사결정의 중요성
  - 80/20 법칙 (최우선 병목 집중)
  - 계측 인프라의 가치

**3. 향후 개선 방향 (선택)**
- 추가 최적화 검토 항목
- 모니터링 지표 제안
- 확장성 대비 방안

**4. 부록 정리**
- 측정 원본 데이터 샘플 (5~10건)
- 주요 테스트 스크립트 코드
- 용어 정의 (Baseline, TPS, 95th Percentile 등)

**5. 보고서 최종 검토**
- 전체 흐름 점검 (Executive Summary → 결론까지)
- 수치 일관성 확인 (표와 본문의 숫자 일치 여부)
- 차트 품질 및 가독성 확인
- 오타 및 문법 확인
- 목차 및 페이지 번호 자동 생성

---

**파트 2: 포트폴리오 자료 작성**

**6. 프로젝트 요약 문서 (1페이지)**
- 프로젝트 개요
- 핵심 성과 (수치 중심)
- 사용 기술 스택
- 기간 및 역할

**7. GitHub README 작성**
- 프로젝트 소개
- 주요 기능
- 성능 개선 결과 요약
- 기술 스택
- 실행 방법

---

**파트 3: 코드 및 문서 정리**

**8. Git 정리**
- Commit 메시지 정리
- 불필요한 파일 제거
- .gitignore 정리

**9. 최종 체크리스트 확인**
- 모든 산출물 생성 확인
- 문서 버전 관리
- 백업 완료

#### 3.7.3. 산출물

- `성능_분석_보고서_최종본_v1.0.pdf`
- `포트폴리오_요약.pdf` (1페이지)
- `README.md` (GitHub용)

#### 3.7.4. 완료 기준

- 보고서 최종본 완성 (모든 챕터 작성 완료)
- 포트폴리오 요약 자료 준비 완료
- GitHub 리포지토리 정리 완료
- 전체 프로젝트 종료 준비 완료

---

## 4. 산출물 목록

### 4.1. 코드 산출물

| 파일명 | 설명 | 완성 시점 |
|--------|------|-----------|
| `performance_test_plan.jmx` | JMeter 테스트 계획 | Day 1 |
| `performance_analyzer.py` | Python 분석 스크립트 | Day 1 |
| `V1__add_geohash_to_police.sql` | DB 마이그레이션 | Day 3 |
| `PoliceOfficeGeoRepository.java` | 개선된 Repository | Day 3 |
| `RedisSingleDataService.java` | 배치 조회/쓰기 추가 | Day 4-5 |
| `LocationAnalysisServiceImpl.java` | 최종 Service 코드 | Day 5 |

### 4.2. 측정 데이터

| 파일명 | 설명 | 완성 시점 |
|--------|------|-----------|
| `logs/as-is/scenario1_cache_miss.log` | As-Is Cache Miss 로그 | Day 2 |
| `logs/as-is/scenario2_cache_hit.log` | As-Is Cache Hit 로그 | Day 2 |
| `logs/as-is/scenario4_mixed.log` | As-Is Mixed 로그 | Day 2 |
| `logs/to-be/scenario1_cache_miss.log` | To-Be Cache Miss 로그 | Day 5 |
| `logs/to-be/scenario2_cache_hit.log` | To-Be Cache Hit 로그 | Day 5 |
| `logs/to-be/scenario4_mixed.log` | To-Be Mixed 로그 | Day 5 |

### 4.3. 분석 결과

| 파일명 | 설명 | 완성 시점 |
|--------|------|-----------|
| `results/as-is/step_summary.csv` | As-Is Step별 분석 | Day 2 |
| `results/as-is/step_duration_chart.png` | As-Is 막대 그래프 | Day 2 |
| `results/to-be/step_summary.csv` | To-Be Step별 분석 | Day 5 |
| `results/comparison/before_after_chart.png` | 비교 차트 | Day 5 |
| `performance_improvement_summary.xlsx` | 종합 분석 | Day 5 |

### 4.4. 문서

| 파일명 | 설명 | 완성 시점 |
|--------|------|-----------|
| `성능_분석_보고서_v0.8.md` | 보고서 기본 틀 | Day 5 |
| `성능_분석_보고서_v0.9.md` | 보고서 초안 (80%) | Day 6 |
| `성능_분석_보고서_최종본_v1.0.pdf` | 보고서 최종본 | Day 7 |
| `포트폴리오_요약.pdf` | 포트폴리오 요약 | Day 7 |
| `README.md` | GitHub 리포지토리 설명 | Day 7 |

---

## 5. 참고 자료

- 상세지도 서비스 성능 테스트 명세서 v2.1
- 상세지도 서비스 성능 테스트 계획서 v2.0
- JMeter 사용자 가이드
- Python Pandas 공식 문서
- Spring Data Redis 공식 문서
- Geohash 알고리즘 문서

---

**문서 종료**