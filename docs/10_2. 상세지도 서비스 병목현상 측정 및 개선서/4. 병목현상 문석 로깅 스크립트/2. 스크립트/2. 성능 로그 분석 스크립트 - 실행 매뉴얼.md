# 성능 로그 분석 스크립트 - 실행 매뉴얼

## 목차

1. [시작하기 전에](#1-시작하기-전에)
2. [설치 가이드](#2-설치-가이드)
3. [파일 구성](#3-파일-구성)
4. [실행 방법](#4-실행-방법)
5. [출력 파일 확인](#5-출력-파일-확인)
7. [고급 사용법](#7-고급-사용법)

---

## 1. 시작하기 전에

### 1.1 필요한 환경

- **운영체제**: Windows 10/11
- **Python**: 3.8 이상
- **디스크 공간**: 최소 500MB
- **메모리**: 최소 4GB RAM

### 1.2 필요한 파일

**wherehouse.log** 파일이 다음 경로에 존재해야 함:
```
E:\devSpace\SpringBootProjects\wherehouse_SpringBoot-master\wherehouse\log\wherehouse.log
```

**파일 크기 정보**:
- 현재 로그 파일: 약 52KB
- 예상 처리 시간: 단계당 5~10초

---

## 2. 설치 가이드

### 2.1 Python 설치 확인

```bash
# Windows PowerShell 또는 CMD 실행
python --version
```

**예상 출력**:
```
Python 3.11.x
```

### 2.2 필수 라이브러리 설치

```bash
# 한 번만 실행하면 됨
pip install pandas openpyxl
```

**예상 출력**:
```
Successfully installed pandas-2.x.x openpyxl-3.x.x
```

### 2.3 설치 확인

```bash
python -c "import pandas; import openpyxl; print('설치 완료')"
```

**예상 출력**:
```
설치 완료
```

---

## 3. 파일 구성

### 3.1 다운로드한 파일 배치

모든 Python 파일을 **하나의 폴더**에 저장한다.

**권장 구조**:
```
C:\workspace\performance_analysis\
├── extractor_utils.py           # 공통 유틸리티
├── generator_utils.py           # 공통 유틸리티
├── r01_data_extractor.py        # R-01 데이터 추출
├── r01_report_generator.py      # R-01 보고서 생성
├── r02_data_extractor.py        # R-02 데이터 추출
├── r02_report_generator.py      # R-02 보고서 생성
├── r03_data_extractor.py
├── r03_report_generator.py
├── r04_data_extractor.py
├── r04_report_generator.py
├── r05_data_extractor.py
├── r05_report_generator.py
├── r06_data_extractor.py
├── r06_report_generator.py
├── r07_data_extractor.py
├── r07_report_generator.py
├── run_all.bat                  # 전체 실행 스크립트
└── README.md                    # 문서
```

**중요**: 모든 파일이 같은 폴더에 있어야 함.

### 3.2 경로 확인

실행 전에 다음 경로들을 확인한다:

1. **로그 파일 경로**:
   ```
   E:\devSpace\SpringBootProjects\wherehouse_SpringBoot-master\wherehouse\log\wherehouse.log
   ```

2. **결과 저장 경로** (자동 생성됨):
   ```
   E:\devSpace\results\
   ```

---

## 4. 실행 방법

### 4.1 방법 1: 전체 자동 실행 (권장)

가장 간단한 방법이다.

#### Windows 탐색기 사용
1. `run_all.bat` 파일을 **더블클릭**
2. 콘솔 창이 열리며 자동으로 실행됨
3. 완료될 때까지 대기 (약 1~2분)

#### 명령 프롬프트 사용
```bash
# 스크립트가 있는 폴더로 이동
cd C:\workspace\performance_analysis

# 전체 실행
run_all.bat
```

**실행 화면 예시**:
```
======================================================================
성능 로그 분석 스크립트 - 전체 실행
======================================================================

실행 순서: R-01 -> R-02 -> R-03 -> R-04 -> R-05 -> R-06 -> R-07
각 단계마다 Extractor (로그 파싱) -> Generator (Excel 생성)

======================================================================

[R-01] 9-Block 그리드 계산 분석 시작...

======================================================================
R-01 Data Extractor 시작
======================================================================
...
R-01 추출 완료
...
R-01 보고서 생성 완료
[R-01] 완료

[R-02] 캐시 조회 분석 시작...
...
```

### 4.2 방법 2: 단계별 개별 실행

특정 단계만 실행할 때 사용한다.

#### R-01 단계 실행 (9-Block 그리드 계산)
```bash
# 1단계: 데이터 추출
python r01_data_extractor.py

# 2단계: 보고서 생성
python r01_report_generator.py
```

#### R-02 단계 실행 (캐시 조회)
```bash
python r02_data_extractor.py
python r02_report_generator.py
```

#### R-03 단계 실행 (DB 조회)
```bash
python r03_data_extractor.py
python r03_report_generator.py
```

#### R-04 단계 실행 (외부 API 호출)
```bash
python r04_data_extractor.py
python r04_report_generator.py
```

#### R-05 단계 실행 (데이터 통합 및 필터링)
```bash
python r05_data_extractor.py
python r05_report_generator.py
```

#### R-06 단계 실행 (점수 계산)
```bash
python r06_data_extractor.py
python r06_report_generator.py
```

#### R-07 단계 실행 (최종 응답 생성)
```bash
python r07_data_extractor.py
python r07_report_generator.py
```

### 4.3 실행 순서

**중요**: 반드시 순서대로 실행해야 함.

```
올바른 순서:
R-01 Extractor → R-01 Generator → 
R-02 Extractor → R-02 Generator → 
R-03 Extractor → R-03 Generator → 
... (R-04 ~ R-07)

잘못된 순서:
R-01 Generator → R-01 Extractor  (Generator를 먼저 실행하면 오류 발생)
```

---

## 5. 출력 파일 확인

### 5.1 생성되는 파일

각 단계마다 2개의 파일이 생성됨:

| 단계 | 중간 데이터 (JSON) | Excel 보고서 | 위치 |
|------|-------------------|--------------|------|
| R-01 | r01_parsed_data.json | r01_analysis.xlsx | `E:\devSpace\results\r01\` |
| R-02 | r02_parsed_data.json | r02_analysis.xlsx | `E:\devSpace\results\r02\` |
| R-03 | r03_parsed_data.json | r03_analysis.xlsx | `E:\devSpace\results\r03\` |
| R-04 | r04_parsed_data.json | r04_analysis.xlsx | `E:\devSpace\results\r04\` |
| R-05 | r05_parsed_data.json | r05_analysis.xlsx | `E:\devSpace\results\r05\` |
| R-06 | r06_parsed_data.json | r06_analysis.xlsx | `E:\devSpace\results\r06\` |
| R-07 | r07_parsed_data.json | r07_analysis.xlsx | `E:\devSpace\results\r07\` |

**총 14개 파일 생성** (JSON 7개 + Excel 7개)

### 5.2 Excel 파일 구조

각 Excel 파일은 **4개의 시트**로 구성됨:

#### Sheet 1: Step_Summary
- **내용**: 메인 루틴 통계 (Service 레이어)
- **컬럼**: step, action, layer, class, method, avg_ms, median_ms, p95_ms, min_ms, max_ms, std_ms, count

#### Sheet 2: Action_Breakdown
- **내용**: 모든 Action 통계 (세부 분석)
- **컬럼**: step, layer, class, method, action, avg_ms, median_ms, p95_ms, min_ms, max_ms, std_ms, count

#### Sheet 3: ResultData_Analysis
- **내용**: 비즈니스 지표 분석
- **컬럼**: metric_name, avg, median, p95, min, max, description

**단계별 특화 지표**:
- R-01: 9-Block 그리드 개수, 성공률
- R-02: L1/L2 캐시 히트율, 조회 시간
- R-03: DB 쿼리 실행 시간, 조회 행 수, 캐시 쓰기 성공률
- R-04: 3개 API 실행 시간, 캐시 히트율, 응답 크기
- R-05: 필터링 효율, 파출소 조회 시간 (병목)
- R-06: 안전성/편의성/종합 점수
- R-07: 최종 응답 크기, L1 캐시 쓰기, 추천/경고사항 개수

#### Sheet 4: Raw_Data
- **내용**: 원본 JSON 데이터
- **용도**: 세부 분석, 디버깅

### 5.3 결과 확인 방법

#### Windows 탐색기로 확인
```
1. Windows 탐색기 열기
2. 주소창에 입력: E:\devSpace\results
3. r01, r02, ..., r07 폴더 확인
4. Excel 파일 더블클릭하여 열기
```

#### 명령 프롬프트로 확인
```bash
# 결과 폴더로 이동
cd E:\devSpace\results

# 생성된 파일 목록 보기
dir /s *.xlsx

# 특정 폴더 내용 보기
dir r01
```

### 5.4 Excel 파일 열기

```bash
# Excel 파일 직접 열기 (Windows)
start E:\devSpace\results\r01\r01_analysis.xlsx

# 모든 Excel 파일 열기
start E:\devSpace\results\r01\r01_analysis.xlsx
start E:\devSpace\results\r02\r02_analysis.xlsx
start E:\devSpace\results\r03\r03_analysis.xlsx
start E:\devSpace\results\r04\r04_analysis.xlsx
start E:\devSpace\results\r05\r05_analysis.xlsx
start E:\devSpace\results\r06\r06_analysis.xlsx
start E:\devSpace\results\r07\r07_analysis.xlsx
```

---

## 7. 고급 사용법

### 7.1 경로 변경

로그 파일이나 결과 저장 위치를 변경하는 방법은 다음과 같다.

#### Data Extractor 파일 수정

`r01_data_extractor.py` ~ `r07_data_extractor.py` 파일을 열고 다음 부분을 수정한다:

```python
# =========================================================================
# 경로 설정
# =========================================================================
LOG_BASE_PATH = r'변경할\로그\경로'
RESULT_BASE_PATH = r'변경할\결과\경로'
```

#### Report Generator 파일 수정

`r01_report_generator.py` ~ `r07_report_generator.py` 파일을 열고 다음 부분을 수정한다:

```python
# =========================================================================
# 경로 설정
# =========================================================================
RESULT_BASE_PATH = r'변경할\결과\경로'
```

### 7.2 배치 파일 커스터마이징

`run_all.bat` 파일을 수정하여 특정 단계만 실행할 수 있다:

```batch
@echo off
echo 특정 단계만 실행 예제

echo [R-01] 실행...
python r01_data_extractor.py
python r01_report_generator.py

echo [R-02] 실행...
python r02_data_extractor.py
python r02_report_generator.py

echo [R-05] 실행 (R-03, R-04 건너뛰기)
python r05_data_extractor.py
python r05_report_generator.py

echo 완료
pause
```

### 7.3 Python 스크립트로 전체 실행

배치 파일 대신 Python 스크립트로 실행하는 방법:

```python
# run_all.py 생성
import subprocess
import sys

steps = ['r01', 'r02', 'r03', 'r04', 'r05', 'r06', 'r07']

for step in steps:
    print(f"\n{'='*70}")
    print(f"[{step.upper()}] 실행 중...")
    print('='*70)
    
    # Extractor 실행
    result = subprocess.run([sys.executable, f'{step}_data_extractor.py'])
    if result.returncode != 0:
        print(f"{step} Extractor 실패")
        sys.exit(1)
    
    # Generator 실행
    result = subprocess.run([sys.executable, f'{step}_report_generator.py'])
    if result.returncode != 0:
        print(f"{step} Generator 실패")
        sys.exit(1)
    
    print(f"[{step.upper()}] 완료")

print("\n" + "="*70)
print("전체 분석 완료")
print("="*70)
```

**실행**:
```bash
python run_all.py
```

### 7.4 로그 레벨 조정

더 자세한 정보를 출력하려면 스크립트에 다음을 추가한다:

```python
# 각 스크립트의 main() 함수에 추가
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 7.5 여러 로그 파일 일괄 처리

```python
# batch_process.py 생성
import os
import subprocess
import sys

# 처리할 로그 파일 목록
log_files = [
    r'E:\devSpace\logs\wherehouse_2025-01.log',
    r'E:\devSpace\logs\wherehouse_2025-02.log',
    r'E:\devSpace\logs\wherehouse_2025-03.log',
]

for log_file in log_files:
    if not os.path.exists(log_file):
        print(f"파일 없음: {log_file}")
        continue
    
    # 로그 파일명에서 날짜 추출
    base_name = os.path.basename(log_file).replace('.log', '')
    output_dir = f'E:\\devSpace\\results\\{base_name}'
    
    print(f"\n{'='*70}")
    print(f"처리 중: {log_file}")
    print(f"출력: {output_dir}")
    print('='*70)
    
    # TODO: 각 스크립트 실행하면서 경로 전달
    # (스크립트 수정 필요)
```

### 7.6 결과 파일 자동 백업

```batch
REM backup_results.bat
@echo off
echo 결과 파일 백업 중...

set TIMESTAMP=%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%%time:~6,2%
set TIMESTAMP=%TIMESTAMP: =0%

set SOURCE=E:\devSpace\results
set BACKUP=E:\devSpace\results_backup\backup_%TIMESTAMP%

xcopy /E /I /Y "%SOURCE%" "%BACKUP%"

echo 백업 완료: %BACKUP%
pause
```

---

**버전**: 2.0  
**최종 업데이트**: 2025-10-24