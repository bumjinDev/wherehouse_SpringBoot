package com.wherehouse.logger.result.R06;

import lombok.Builder;
import lombok.Data;

/**
 * R-06 서브 루틴: 안전성 점수 계산 결과
 *
 * 파출소 거리, CCTV 수, 검거율 3가지 요소를 기반으로
 * 안전성 점수를 계산한 결과를 기록한다.
 *
 * 계산 공식:
 * 1. 파출소 거리 점수 = (800 - 거리) / 800 × 100
 *    - 800m 이하: 거리에 비례하여 점수 부여
 *    - 800m 초과: 0점
 *
 * 2. CCTV 점수 = CCTV수 / 30 × 100
 *    - 최대 100점
 *
 * 3. 검거율 점수 = 검거율 × 100
 *    - 검거율은 0.0~1.0 범위
 *
 * 최종 점수 = (파출소 점수 × 0.3) + (CCTV 점수 × 0.4) + (검거율 점수 × 0.3)
 */
@Data
@Builder
public class R06SafetyScoreResult {

    // ============================================
    // 파출소 거리 점수
    // ============================================

    /**
     * 파출소 거리 점수 (0-100)
     *
     * 계산: (800 - 거리) / 800 × 100
     *
     * 예시:
     * - 거리 0m: 100점
     * - 거리 400m: 50점
     * - 거리 800m: 0점
     * - 거리 800m 초과: 0점
     */
    private double policeDistanceScore;

    /**
     * 가장 가까운 파출소까지의 거리 (미터)
     *
     * 예시: 523.7
     *
     * 파출소가 없을 경우: Double.MAX_VALUE
     */
    private double policeDistance;

    // ============================================
    // CCTV 점수
    // ============================================

    /**
     * CCTV 점수 (0-100)
     *
     * 계산: CCTV수 / 30 × 100 (최대 100점)
     *
     * 예시:
     * - CCTV 0개: 0점
     * - CCTV 15개: 50점
     * - CCTV 30개 이상: 100점
     */
    private double cctvScore;

    /**
     * 반경 내 CCTV 개수
     *
     * 예시: 89개
     *
     * R-05에서 필터링된 CCTV 리스트의 크기
     */
    private int cctvCount;

    // ============================================
    // 검거율 점수
    // ============================================

    /**
     * 검거율 점수 (0-100)
     *
     * 계산: 검거율 × 100
     *
     * 예시:
     * - 검거율 0.8669: 86.69점
     * - 검거율 0.92: 92점
     */
    private double arrestRateScore;

    /**
     * 해당 구의 검거율 (0.0 ~ 1.0)
     *
     * 예시: 0.866910799 (86.69%)
     *
     * R-04에서 내부 DB(ArrestRateRepository)에서 조회
     */
    private double arrestRate;

    // ============================================
    // 가중치
    // ============================================

    /**
     * 파출소 거리 가중치
     *
     * 고정값: 0.3 (30%)
     */
    private double policeWeight;

    /**
     * CCTV 가중치
     *
     * 고정값: 0.4 (40%)
     */
    private double cctvWeight;

    /**
     * 검거율 가중치
     *
     * 고정값: 0.3 (30%)
     */
    private double arrestWeight;

    // ============================================
    // 최종 점수
    // ============================================

    /**
     * 안전성 최종 점수 (0-100)
     *
     * 계산:
     * (policeDistanceScore × 0.3) + (cctvScore × 0.4) + (arrestRateScore × 0.3)
     *
     * 예시: 73.45
     *
     * 이 점수는 R-06 메인에서 종합 점수 계산 시 사용됨
     */
    private double finalScore;

    /**
     * 안전성 점수 계산 성공 여부
     * - true: 정상 계산
     * - false: 예외 발생 (거의 발생하지 않음)
     */
    private boolean isSuccess;
}